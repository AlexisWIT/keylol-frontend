!function(){"use strict";var t=angular.module("KeylolApp",["ngRoute","ngAnimate","angularMoment","ngStorage","ngFileUpload","ab-base64","angulartics"]);t.config(["$routeProvider","$locationProvider","utilsProvider","pageTitleProvider","$localStorageProvider","$httpProvider","$compileProvider","$analyticsProvider",function(t,e,n,i,r,o,s,a){e.html5Mode(!0),t.when("/home",{templateUrl:"components/pages/home.html",controller:"HomeController"}).when("/",{templateUrl:"components/pages/alpha-entrance.html",controller:"AlphaEntranceController"}).when("/article/:author/:article",{templateUrl:"components/pages/article.html",controller:"ArticleController"}).when("/point/:pointIdCode",{templateUrl:"components/pages/point.html",controller:"PointController"}).when("/user/:userIdCode",{templateUrl:"components/pages/point.html",controller:"PointController"}).when("/user/:userIdCode/publications",{templateUrl:"components/pages/point.html",controller:"PointController"}).when("/subscriptions",{templateUrl:"components/pages/search-results.html",controller:"SubscriptionsController"}).when("/readers",{templateUrl:"components/pages/search-results.html",controller:"ReadersController"}).when("/post",{templateUrl:"components/pages/post.html",controller:"PostController"}).when("/comments",{templateUrl:"components/pages/comments.html",controller:"CommentsController"}).when("/acknowledgements",{templateUrl:"components/pages/acknowledgements.html",controller:"AcknowledgementsController"}).when("/search/:searchType/:keyword",{templateUrl:"components/pages/search-results.html",controller:"SearchResultsController"}).otherwise({templateUrl:"components/pages/not-found.html",controller:"NotFoundController"}),i.setLoadingTitle("载入中 - 其乐"),n.config({geetestId:"0c002064ef8f602ced7bccec08b8e10b"}),r.setKeyPrefix("keylol-"),o.defaults.withCredentials=!0,s.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|steam):/),window._czc=[],_czc.push(["_setAutoPageview",!1]),a.registerPageTrack(function(t){_czc.push(["_trackPageview",t])}),a.registerEventTrack(function(t,e){_czc.push(["_trackEvent",e.category||"未分类",t,e.label,e.value,e.nodeid])})}]),t.constant("amTimeAgoConfig",{fullDateThreshold:1,fullDateFormat:"YYYY-MM-DD HH:mm",titleFormat:"YYYY-MM-DD HH:mm:ss"}),t.constant("angularMomentConfig",{timezone:"+0800"}),window.keylolApp=t}(),function(){"use strict";keylolApp.config(["apiEndpointProvider",function(t){t.setEndPoint("https://api.keylol.com/")}]),window.apiEndpoint="https://api.keylol.com/"}(),function(){"use strict";keylolApp.controller("RootController",["$scope","pageTitle","union","$http","apiEndpoint","notification","$location","$rootScope",function(t,e,n,i,r,o,s,a){function l(){i.get(r+"user/"+n.$localStorage.login.UserId,{params:{includeClaims:!0,includeStats:!0,includeSubscribeCount:!0,includeCommentLike:!0}}).then(function(t){n.$localStorage.user=t.data,_czc.push(["_setCustomVar","登录用户",t.data.IdCode+"-"+t.data.UserName,1])},function(){i["delete"](r+"login/current"),delete n.$localStorage.login,o.error("登录失效，请重新登录。")})}e.loading(),t.$watch(function(){return n.$localStorage.login},function(t){if(t)l();else{_czc.push(["_setCustomVar","登录用户","游客",1]);for(var e in n.$localStorage)n.$localStorage.hasOwnProperty(e)&&0!==e.indexOf("$")&&delete n.$localStorage[e];for(var i in n.$sessionStorage)n.$sessionStorage.hasOwnProperty(i)&&0!==i.indexOf("$")&&delete n.$sessionStorage[i];s.url("/")}});var u=!0;a.$on("$routeChangeSuccess",function(){return u?void(u=!1):void(n.$localStorage.login&&l())})}])}(),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Quill=t()}}(function(){var t;return function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,n,i){(function(e){(function(){function r(t,e,n){for(var i=t.length,r=n?i:-1;n?r--:++r<i;)if(e(t[r],r,t))return r;return-1}function o(t,e,n){if(e!==e)return l(t,n);for(var i=n-1,r=t.length;++i<r;)if(t[i]===e)return i;return-1}function s(t){return"function"==typeof t||!1}function a(t){return"string"==typeof t?t:null==t?"":t+""}function l(t,e,n){for(var i=t.length,r=e+(n?0:-1);n?r--:++r<i;){var o=t[r];if(o!==o)return r}return-1}function u(t){return!!t&&"object"==typeof t}function c(t,e){for(var n=-1,i=t.length,r=-1,o=[];++n<i;)t[n]===e&&(t[n]=we,o[++r]=n);return o}function d(){}function f(){}function h(t){this.__wrapped__=t,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=On,this.__views__=null}function p(t){var e=t?t.length:0;for(this.data={hash:Ln(null),set:new Sn};e--;)this.push(t[e])}function m(t,e){var n=t.data,i="string"==typeof e||Wt(e)?n.set.has(e):n.hash[e];return i?0:-1}function g(t){var e=this.data;"string"==typeof t||Wt(t)?e.set.add(t):e.hash[t]=!0}function v(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}function y(t,e){for(var n=-1,i=t.length;++n<i&&e(t[n],n,t)!==!1;);return t}function b(t,e){for(var n=-1,i=t.length;++n<i;)if(!e(t[n],n,t))return!1;return!0}function A(t,e){for(var n=-1,i=t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r}function C(t,e,n,i){var r=-1,o=t.length;for(i&&o&&(n=t[++r]);++r<o;)n=e(n,t[r],r,t);return n}function k(t,e){for(var n=-1,i=t.length;++n<i;)if(e(t[n],n,t))return!0;return!1}function T(t,e){return t===ce?e:t}function w(t,e,n){for(var i=-1,r=hi(e),o=r.length;++i<o;){var s=r[i],a=t[s],l=n(a,e[s],s,t,e);(l===l?l===a:a!==a)&&(a!==ce||s in t)||(t[s]=l)}return t}function S(t,e){return null==e?t:E(e,hi(e),t)}function E(t,e,n){n||(n={});for(var i=-1,r=e.length;++i<r;){var o=e[i];n[o]=t[o]}return n}function I(t,e,n){var i=typeof t;return"function"==i?e===ce?t:X(t,e,n):null==t?oe:"object"==i?F(t):e===ce?le(t):H(t,e)}function N(t,e,n,i,r,o,s){var a;if(n&&(a=r?n(t,i,r):n(t)),a!==ce)return a;if(!Wt(t))return t;var l=li(t);if(l){if(a=At(t),!e)return v(t,a)}else{var u=bn.call(t),c=u==xe;if(u!=$e&&u!=Se&&(!c||r))return on[u]?kt(t,u,e):r?t:{};if(a=Ct(c?{}:t),!e)return S(a,t)}o||(o=[]),s||(s=[]);for(var d=o.length;d--;)if(o[d]==t)return s[d];return o.push(t),s.push(a),(l?y:O)(t,function(i,r){a[r]=N(i,e,n,r,t,o,s)}),a}function L(t,e,n){if("function"!=typeof t)throw new TypeError(Te);return setTimeout(function(){t.apply(ce,n)},e)}function x(t,e){var n=t?t.length:0,i=[];if(!n)return i;var r=-1,s=vt(),a=s==o,l=a&&e.length>=200?Wn(e):null,u=e.length;l&&(s=m,a=!1,e=l);t:for(;++r<n;){var c=t[r];if(a&&c===c){for(var d=u;d--;)if(e[d]===c)continue t;i.push(c)}else s(e,c,0)<0&&i.push(c)}return i}function _(t,e){var n=!0;return Kn(t,function(t,i,r){return n=!!e(t,i,r)}),n}function P(t,e,n,i){var r;return n(t,function(t,n,o){return e(t,n,o)?(r=i?n:t,!1):void 0}),r}function $(t,e,n){for(var i=-1,r=t.length,o=-1,s=[];++i<r;){var a=t[i];if(u(a)&&wt(a)&&(n||li(a)||Kt(a))){e&&(a=$(a,e,n));for(var l=-1,c=a.length;++l<c;)s[++o]=a[l]}else n||(s[++o]=a)}return s}function q(t,e){return Vn(t,e,Jt)}function O(t,e){return Vn(t,e,hi)}function U(t,e,n){if(null!=t){n!==ce&&n in Dt(t)&&(e=[n]);for(var i=0,r=e.length;null!=t&&r>i;)t=t[e[i++]];return i&&i==r?t:ce}}function D(t,e,n,i,r,o){return t===e?!0:null==t||null==e||!Wt(t)&&!u(e)?t!==t&&e!==e:R(t,e,D,n,i,r,o)}function R(t,e,n,i,r,o,s){var a=li(t),l=li(e),u=Ee,c=Ee;a||(u=bn.call(t),u==Se?u=$e:u!=$e&&(a=Zt(t))),l||(c=bn.call(e),c==Se?c=$e:c!=$e&&(l=Zt(e)));var d=u==$e,f=c==$e,h=u==c;if(h&&!a&&!d)return ht(t,e,u);if(!r){var p=d&&vn.call(t,"__wrapped__"),m=f&&vn.call(e,"__wrapped__");if(p||m)return n(p?t.value():t,m?e.value():e,i,r,o,s)}if(!h)return!1;o||(o=[]),s||(s=[]);for(var g=o.length;g--;)if(o[g]==t)return s[g]==e;o.push(t),s.push(e);var v=(a?ft:pt)(t,e,n,i,r,o,s);return o.pop(),s.pop(),v}function M(t,e,n){var i=e.length,r=i,o=!n;if(null==t)return!r;for(t=Dt(t);i--;){var s=e[i];if(o&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<r;){s=e[i];var a=s[0],l=t[a],u=s[1];if(o&&s[2]){if(l===ce&&!(a in t))return!1}else{var c=n?n(l,u,a):ce;if(!(c===ce?D(u,l,n,!0):c))return!1}}return!0}function B(t,e){var n=-1,i=wt(t)?Array(t.length):[];return Kn(t,function(t,r,o){i[++n]=e(t,r,o)}),i}function F(t){var e=yt(t);if(1==e.length&&e[0][2]){var n=e[0][0],i=e[0][1];return function(t){return null==t?!1:t[n]===i&&(i!==ce||n in Dt(t))}}return function(t){return M(t,e)}}function H(t,e){var n=li(t),i=It(t)&&xt(e),r=t+"";return t=Rt(t),function(o){if(null==o)return!1;var s=r;if(o=Dt(o),(n||!i)&&!(s in o)){if(o=1==t.length?o:U(o,V(t,0,-1)),null==o)return!1;s=Bt(t),o=Dt(o)}return o[s]===e?e!==ce||s in o:D(e,o[s],ce,!0)}}function G(t){return function(e){return null==e?ce:e[t]}}function j(t){var e=t+"";return t=Rt(t),function(n){return U(n,t,e)}}function K(t,e,n,i,r){return r(t,function(t,r,o){n=i?(i=!1,t):e(n,t,r,o)}),n}function V(t,e,n){var i=-1,r=t.length;e=null==e?0:+e||0,0>e&&(e=-e>r?0:r+e),n=n===ce||n>r?r:+n||0,0>n&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(r);++i<r;)o[i]=t[i+e];return o}function z(t,e){for(var n=-1,i=e.length,r=Array(i);++n<i;)r[n]=t[e[n]];return r}function W(t,e,n){var i=0,r=t?t.length:i;if("number"==typeof e&&e===e&&Rn>=r){for(;r>i;){var o=i+r>>>1,s=t[o];(n?e>=s:e>s)&&null!==s?i=o+1:r=o}return r}return Y(t,e,oe,n)}function Y(t,e,n,i){e=n(e);for(var r=0,o=t?t.length:0,s=e!==e,a=null===e,l=e===ce;o>r;){var u=Tn((r+o)/2),c=n(t[u]),d=c!==ce,f=c===c;if(s)var h=f||i;else h=a?f&&d&&(i||null!=c):l?f&&(i||d):null==c?!1:i?e>=c:e>c;h?r=u+1:o=u}return $n(o,Dn)}function X(t,e,n){if("function"!=typeof t)return oe;if(e===ce)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)};case 5:return function(n,i,r,o,s){return t.call(e,n,i,r,o,s)}}return function(){return t.apply(e,arguments)}}function Q(t){return kn.call(t,0)}function Z(t,e,n){for(var i=n.length,r=-1,o=Pn(t.length-i,0),s=-1,a=e.length,l=Array(o+a);++s<a;)l[s]=e[s];for(;++r<i;)l[n[r]]=t[r];for(;o--;)l[s++]=t[r++];return l}function J(t,e,n){for(var i=-1,r=n.length,o=-1,s=Pn(t.length-r,0),a=-1,l=e.length,u=Array(s+l);++o<s;)u[o]=t[o];for(var c=o;++a<l;)u[c+a]=e[a];for(;++i<r;)u[c+n[i]]=t[o++];return u}function tt(t){return Gt(function(e,n){var i=-1,r=null==e?0:n.length,o=r>2?n[r-2]:ce,s=r>2?n[2]:ce,a=r>1?n[r-1]:ce;for("function"==typeof o?(o=X(o,a,5),r-=2):(o="function"==typeof a?a:ce,r-=o?1:0),s&&Et(n[0],n[1],s)&&(o=3>r?ce:o,r=1);++i<r;){var l=n[i];l&&t(e,l,o)}return e})}function et(t,e){return function(n,i){var r=n?Xn(n):0;if(!Lt(r))return t(n,i);for(var o=e?r:-1,s=Dt(n);(e?o--:++o<r)&&i(s[o],o,s)!==!1;);return n}}function nt(t){return function(e,n,i){for(var r=Dt(e),o=i(e),s=o.length,a=t?s:-1;t?a--:++a<s;){var l=o[a];if(n(r[l],l,r)===!1)break}return e}}function it(t,e){function n(){var r=this&&this!==hn&&this instanceof n?i:t;return r.apply(e,arguments)}var i=rt(t);return n}function rt(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4])}var n=jn(t.prototype),i=t.apply(n,e);return Wt(i)?i:n}}function ot(t,e){return function(n,i,o){if(i=mt(i,o,3),li(n)){var s=r(n,i,e);return s>-1?n[s]:ce}return P(n,i,t)}}function st(t,e){return function(n,i,r){return"function"==typeof i&&r===ce&&li(n)?t(n,i):e(n,X(i,r,3))}}function at(t){var e=Gt(function(n,i){var r=c(i,e.placeholder);return dt(n,t,null,i,r)});return e}function lt(t,e){return function(n,i,r,o){var s=arguments.length<3;return"function"==typeof i&&o===ce&&li(n)?t(n,i,r,s):K(n,mt(i,o,4),r,s,e)}}function ut(t,e,n,i,r,o,s,a,l,u){function d(){for(var A=arguments.length,C=A,k=Array(A);C--;)k[C]=arguments[C];if(i&&(k=Z(k,i,r)),o&&(k=J(k,o,s)),m||y){var T=d.placeholder,w=c(k,T);if(A-=w.length,u>A){var S=a?v(a):null,E=Pn(u-A,0),I=m?w:null,N=m?null:w,L=m?k:null,x=m?null:k;e|=m?ve:ye,e&=~(m?ye:ve),g||(e&=~(fe|he));var _=[t,e,n,L,I,x,N,S,l,E],P=ut.apply(ce,_);return Nt(t)&&Qn(P,_),P.placeholder=T,P}}var $=h?n:this,q=p?$[t]:t;return a&&(k=qt(k,a)),f&&l<k.length&&(k.length=l),this&&this!==hn&&this instanceof d&&(q=b||rt(t)),q.apply($,k)}var f=e&be,h=e&fe,p=e&he,m=e&me,g=e&pe,y=e&ge,b=p?null:rt(t);return d}function ct(t,e,n,i){function r(){for(var e=-1,a=arguments.length,l=-1,u=i.length,c=Array(a+u);++l<u;)c[l]=i[l];for(;a--;)c[l++]=arguments[++e];var d=this&&this!==hn&&this instanceof r?s:t;return d.apply(o?n:this,c)}var o=e&fe,s=rt(t);return r}function dt(t,e,n,i,r,o,s,a){var l=e&he;if(!l&&"function"!=typeof t)throw new TypeError(Te);var u=i?i.length:0;if(u||(e&=~(ve|ye),i=r=null),u-=r?r.length:0,e&ye){var c=i,d=r;i=r=null}var f=l?null:Yn(t),h=[t,e,n,i,r,c,d,o,s,a];if(f&&(_t(h,f),e=h[1],a=h[9]),h[9]=null==a?l?0:t.length:Pn(a-u,0)||0,e==fe)var p=it(h[0],h[2]);else p=e!=ve&&e!=(fe|ve)||h[4].length?ut.apply(ce,h):ct.apply(ce,h);var m=f?zn:Qn;return m(p,h)}function ft(t,e,n,i,r,o,s){var a=-1,l=t.length,u=e.length;if(l!=u&&!(r&&u>l))return!1;for(;++a<l;){var c=t[a],d=e[a],f=i?i(r?d:c,r?c:d,a):ce;if(f!==ce){if(f)continue;return!1}if(r){if(!k(e,function(t){return c===t||n(c,t,i,r,o,s)}))return!1}else if(c!==d&&!n(c,d,i,r,o,s))return!1}return!0}function ht(t,e,n){switch(n){case Ie:case Ne:return+t==+e;case Le:return t.name==e.name&&t.message==e.message;case Pe:return t!=+t?e!=+e:t==+e;case qe:case Ue:return t==e+""}return!1}function pt(t,e,n,i,r,o,s){var a=hi(t),l=a.length,u=hi(e),c=u.length;if(l!=c&&!r)return!1;for(var d=l;d--;){var f=a[d];if(!(r?f in e:vn.call(e,f)))return!1}for(var h=r;++d<l;){f=a[d];var p=t[f],m=e[f],g=i?i(r?m:p,r?p:m,f):ce;if(!(g===ce?n(p,m,i,r,o,s):g))return!1;h||(h="constructor"==f)}if(!h){var v=t.constructor,y=e.constructor;if(v!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y))return!1}return!0}function mt(t,e,n){var i=d.callback||ie;return i=i===ie?I:i,n?i(t,e,n):i}function gt(t){for(var e=t.name,n=Hn[e],i=n?n.length:0;i--;){var r=n[i],o=r.func;if(null==o||o==t)return r.name}return e}function vt(t,e,n){var i=d.indexOf||Mt;return i=i===Mt?o:i,t?i(t,e,n):i}function yt(t){for(var e=te(t),n=e.length;n--;)e[n][2]=xt(e[n][1]);return e}function bt(t,e){var n=null==t?ce:t[e];return Yt(n)?n:ce}function At(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&vn.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Ct(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Object),new e}function kt(t,e,n){var i=t.constructor;switch(e){case Re:return Q(t);case Ie:case Ne:return new i(+t);case Me:case Be:case Fe:case He:case Ge:case je:case Ke:case Ve:case ze:var r=t.buffer;return new i(n?Q(r):r,t.byteOffset,t.length);case Pe:case Ue:return new i(t);case qe:var o=new i(t.source,tn.exec(t));o.lastIndex=t.lastIndex}return o}function Tt(t,e,n){null==t||It(e,t)||(e=Rt(e),t=1==e.length?t:U(t,V(e,0,-1)),e=Bt(e));var i=null==t?t:t[e];return null==i?ce:i.apply(t,n)}function wt(t){return null!=t&&Lt(Xn(t))}function St(t,e){return t="number"==typeof t||nn.test(t)?+t:-1,e=null==e?Bn:e,t>-1&&t%1==0&&e>t}function Et(t,e,n){if(!Wt(n))return!1;var i=typeof e;if("number"==i?wt(n)&&St(e,n.length):"string"==i&&e in n){var r=n[e];return t===t?t===r:r!==r}return!1}function It(t,e){var n=typeof t;if("string"==n&&Ye.test(t)||"number"==n)return!0;if(li(t))return!1;var i=!We.test(t);return i||null!=e&&t in Dt(e)}function Nt(t){var e=gt(t);if(!(e in h.prototype))return!1;var n=d[e];if(t===n)return!0;var i=Yn(n);return!!i&&t===i[0]}function Lt(t){return"number"==typeof t&&t>-1&&t%1==0&&Bn>=t}function xt(t){return t===t&&!Wt(t)}function _t(t,e){var n=t[1],i=e[1],r=n|i,o=be>r,s=i==be&&n==me||i==be&&n==Ae&&t[7].length<=e[8]||i==(be|Ae)&&n==me;if(!o&&!s)return t;i&fe&&(t[2]=e[2],r|=n&fe?0:pe);var a=e[3];if(a){var l=t[3];t[3]=l?Z(l,a,e[4]):v(a),t[4]=l?c(t[3],we):v(e[4])}return a=e[5],a&&(l=t[5],t[5]=l?J(l,a,e[6]):v(a),t[6]=l?c(t[5],we):v(e[6])),a=e[7],a&&(t[7]=v(a)),i&be&&(t[8]=null==t[8]?e[8]:$n(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=r,t}function Pt(t,e){t=Dt(t);for(var n=-1,i=e.length,r={};++n<i;){var o=e[n];o in t&&(r[o]=t[o])}return r}function $t(t,e){var n={};return q(t,function(t,i,r){e(t,i,r)&&(n[i]=t)}),n}function qt(t,e){for(var n=t.length,i=$n(e.length,n),r=v(t);i--;){var o=e[i];t[i]=St(o,n)?r[o]:ce}return t}function Ot(t){var e;d.support;if(!u(t)||bn.call(t)!=$e||!vn.call(t,"constructor")&&(e=t.constructor,"function"==typeof e&&!(e instanceof e)))return!1;var n;return q(t,function(t,e){n=e}),n===ce||vn.call(t,n)}function Ut(t){for(var e=Jt(t),n=e.length,i=n&&t.length,r=!!i&&Lt(i)&&(li(t)||Kt(t)),o=-1,s=[];++o<n;){var a=e[o];(r&&St(a,i)||vn.call(t,a))&&s.push(a)}return s}function Dt(t){return Wt(t)?t:Object(t)}function Rt(t){if(li(t))return t;var e=[];return a(t).replace(Xe,function(t,n,i,r){e.push(i?r.replace(Je,"$1"):n||t)}),e}function Mt(t,e,n){var i=t?t.length:0;if(!i)return-1;if("number"==typeof n)n=0>n?Pn(i+n,0):n;else if(n){var r=W(t,e),s=t[r];return(e===e?e===s:s!==s)?r:-1}return o(t,e,n||0)}function Bt(t){var e=t?t.length:0;return e?t[e-1]:ce}function Ft(t,e,n){var i=li(t)?b:_;return n&&Et(t,e,n)&&(e=null),("function"!=typeof e||n!==ce)&&(e=mt(e,n,3)),i(t,e)}function Ht(t,e,n){var i=li(t)?A:B;return e=mt(e,n,3),i(t,e)}function Gt(t,e){if("function"!=typeof t)throw new TypeError(Te);return e=Pn(e===ce?t.length-1:+e||0,0),function(){for(var n=arguments,i=-1,r=Pn(n.length-e,0),o=Array(r);++i<r;)o[i]=n[e+i];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,n[0],o);case 2:return t.call(this,n[0],n[1],o)}var s=Array(e+1);for(i=-1;++i<e;)s[i]=n[i];return s[e]=o,t.apply(this,s)}}function jt(t,e,n,i){return e&&"boolean"!=typeof e&&Et(t,e,n)?e=!1:"function"==typeof e&&(i=n,n=e,e=!1),"function"==typeof n?N(t,e,X(n,i,1)):N(t,e)}function Kt(t){return u(t)&&wt(t)&&bn.call(t)==Se}function Vt(t){return!!t&&1===t.nodeType&&u(t)&&bn.call(t).indexOf("Element")>-1}function zt(t,e,n,i){n="function"==typeof n?X(n,i,3):ce;var r=n?n(t,e):ce;return r===ce?D(t,e,n):!!r}function Wt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Yt(t){return null==t?!1:bn.call(t)==xe?An.test(gn.call(t)):u(t)&&en.test(t)}function Xt(t){return"number"==typeof t||u(t)&&bn.call(t)==Pe}function Qt(t){return"string"==typeof t||u(t)&&bn.call(t)==Ue}function Zt(t){return u(t)&&Lt(t.length)&&!!rn[bn.call(t)]}function Jt(t){if(null==t)return[];Wt(t)||(t=Object(t));var e=t.length;e=e&&Lt(e)&&(li(t)||Kt(t))&&e||0;for(var n=t.constructor,i=-1,r="function"==typeof n&&n.prototype===t,o=Array(e),s=e>0;++i<e;)o[i]=i+"";for(var a in t)s&&St(a,e)||"constructor"==a&&(r||!vn.call(t,a))||o.push(a);return o}function te(t){t=Dt(t);for(var e=-1,n=hi(t),i=n.length,r=Array(i);++e<i;){var o=n[e];r[e]=[o,t[o]]}return r}function ee(t){return z(t,hi(t))}function ne(t){return t=a(t),t&&Ze.test(t)?t.replace(Qe,"\\$&"):t}function ie(t,e,n){return n&&Et(t,e,n)&&(e=null),u(t)?se(t):I(t,e)}function re(t){return function(){return t}}function oe(t){return t}function se(t){return F(N(t,!0))}function ae(){}function le(t){return It(t)?G(t):j(t)}function ue(t){var e=++yn;return a(t)+e}var ce,de="3.9.3",fe=1,he=2,pe=4,me=8,ge=16,ve=32,ye=64,be=128,Ae=256,Ce=150,ke=16,Te="Expected a function",we="__lodash_placeholder__",Se="[object Arguments]",Ee="[object Array]",Ie="[object Boolean]",Ne="[object Date]",Le="[object Error]",xe="[object Function]",_e="[object Map]",Pe="[object Number]",$e="[object Object]",qe="[object RegExp]",Oe="[object Set]",Ue="[object String]",De="[object WeakMap]",Re="[object ArrayBuffer]",Me="[object Float32Array]",Be="[object Float64Array]",Fe="[object Int8Array]",He="[object Int16Array]",Ge="[object Int32Array]",je="[object Uint8Array]",Ke="[object Uint8ClampedArray]",Ve="[object Uint16Array]",ze="[object Uint32Array]",We=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,Ye=/^\w*$/,Xe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,Qe=/[.*+?^${}()|[\]\/\\]/g,Ze=RegExp(Qe.source),Je=/\\(\\)?/g,tn=/\w*$/,en=/^\[object .+?Constructor\]$/,nn=/^\d+$/,rn={};rn[Me]=rn[Be]=rn[Fe]=rn[He]=rn[Ge]=rn[je]=rn[Ke]=rn[Ve]=rn[ze]=!0,rn[Se]=rn[Ee]=rn[Re]=rn[Ie]=rn[Ne]=rn[Le]=rn[xe]=rn[_e]=rn[Pe]=rn[$e]=rn[qe]=rn[Oe]=rn[Ue]=rn[De]=!1;var on={};on[Se]=on[Ee]=on[Re]=on[Ie]=on[Ne]=on[Me]=on[Be]=on[Fe]=on[He]=on[Ge]=on[Pe]=on[$e]=on[qe]=on[Ue]=on[je]=on[Ke]=on[Ve]=on[ze]=!0,on[Le]=on[xe]=on[_e]=on[Oe]=on[De]=!1;var sn={"function":!0,object:!0},an=sn[typeof i]&&i&&!i.nodeType&&i,ln=sn[typeof n]&&n&&!n.nodeType&&n,un=an&&ln&&"object"==typeof e&&e&&e.Object&&e,cn=sn[typeof self]&&self&&self.Object&&self,dn=sn[typeof window]&&window&&window.Object&&window,fn=ln&&ln.exports===an&&an,hn=un||dn!==(this&&this.window)&&dn||cn||this,pn=Object.prototype,mn=(mn=hn.window)?mn.document:null,gn=Function.prototype.toString,vn=pn.hasOwnProperty,yn=0,bn=pn.toString,An=RegExp("^"+ne(gn.call(vn)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Cn=bt(hn,"ArrayBuffer"),kn=bt(Cn&&new Cn(0),"slice"),Tn=Math.floor,wn=bt(Object,"getPrototypeOf"),Sn=bt(hn,"Set"),En=bt(hn,"Uint8Array"),In=bt(hn,"WeakMap"),Nn=function(){try{var t=bt(hn,"Float64Array"),e=new t(new Cn(10),0,1)&&t}catch(n){}return e||null}(),Ln=bt(Object,"create"),xn=bt(Array,"isArray"),_n=bt(Object,"keys"),Pn=Math.max,$n=Math.min,qn=bt(Date,"now"),On=Number.POSITIVE_INFINITY,Un=4294967295,Dn=Un-1,Rn=Un>>>1,Mn=Nn?Nn.BYTES_PER_ELEMENT:0,Bn=9007199254740991,Fn=In&&new In,Hn={},Gn=d.support={};!function(t){var e=function(){this.x=t},n=[];e.prototype={valueOf:t,y:t};for(var i in new e)n.push(i);try{Gn.dom=11===mn.createDocumentFragment().nodeType}catch(r){Gn.dom=!1}}(1,0);var jn=function(){function t(){}return function(e){if(Wt(e)){t.prototype=e;var n=new t;t.prototype=null}return n||{}}}(),Kn=et(O),Vn=nt(),zn=Fn?function(t,e){return Fn.set(t,e),t}:oe;kn||(Q=Cn&&En?function(t){var e=t.byteLength,n=Nn?Tn(e/Mn):0,i=n*Mn,r=new Cn(e);if(n){var o=new Nn(r,0,n);o.set(new Nn(t,0,n))}return e!=i&&(o=new En(r,i),o.set(new En(t,i))),r}:re(null));var Wn=Ln&&Sn?function(t){return new p(t)}:re(null),Yn=Fn?function(t){return Fn.get(t)}:ae,Xn=G("length"),Qn=function(){var t=0,e=0;return function(n,i){var r=ri(),o=ke-(r-e);if(e=r,o>0){if(++t>=Ce)return n}else t=0;return zn(n,i)}}(),Zn=Gt(function(t,e){return wt(t)?x(t,$(e,!1,!0)):[]}),Jn=Gt(function(t){for(var e=t.length,n=e,i=Array(d),r=vt(),s=r==o,a=[];n--;){var l=t[n]=wt(l=t[n])?l:[];i[n]=s&&l.length>=120?Wn(n&&l):null}var u=t[0],c=-1,d=u?u.length:0,f=i[0];t:for(;++c<d;)if(l=u[c],(f?m(f,l):r(a,l,0))<0){for(var n=e;--n;){var h=i[n];if((h?m(h,l):r(t[n],l,0))<0)continue t}f&&f.push(l),a.push(l)}return a}),ti=ot(Kn),ei=st(y,Kn),ni=Gt(function(t,e,n){var i=-1,r="function"==typeof e,o=It(e),s=wt(t)?Array(t.length):[];return Kn(t,function(t){var a=r?e:o&&null!=t?t[e]:null;s[++i]=a?a.apply(t,n):Tt(t,e,n)}),s}),ii=lt(C,Kn),ri=qn||function(){return(new Date).getTime()},oi=Gt(function(t,e,n){var i=fe;if(n.length){var r=c(n,oi.placeholder);i|=ve}return dt(t,i,e,n,r)}),si=Gt(function(t,e){return L(t,1,e)}),ai=at(ve),li=xn||function(t){return u(t)&&Lt(t.length)&&bn.call(t)==Ee};Gn.dom||(Vt=function(t){return!!t&&1===t.nodeType&&u(t)&&!ci(t)});var ui=s(/x/)||En&&!s(En)?function(t){return bn.call(t)==xe}:s,ci=wn?function(t){if(!t||bn.call(t)!=$e)return!1;var e=bt(t,"valueOf"),n=e&&(n=wn(e))&&wn(n);return n?t==n||wn(t)==n:Ot(t)}:Ot,di=tt(function(t,e,n){return n?w(t,e,n):S(t,e)}),fi=Gt(function(t){var e=t[0];return null==e?e:(t.push(T),di.apply(ce,t))}),hi=_n?function(t){var e=null==t?null:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&wt(t)?Ut(t):Wt(t)?_n(t):[]}:Ut,pi=Gt(function(t,e){if(null==t)return{};if("function"!=typeof e[0]){var e=A($(e),String);return Pt(t,x(Jt(t),e))}var n=X(e[0],e[1],3);return $t(t,function(t,e,i){return!n(t,e,i)})});h.prototype=jn(f.prototype),h.prototype.constructor=h,p.prototype.push=g,d.assign=di,d.bind=oi,d.callback=ie,d.constant=re,d.defaults=fi,d.defer=si,d.difference=Zn,d.forEach=ei,d.intersection=Jn,d.invoke=ni,d.keys=hi,d.keysIn=Jt,d.map=Ht,d.matches=se,d.omit=pi,d.pairs=te,d.partial=ai,d.property=le,d.restParam=Gt,d.values=ee,d.collect=Ht,d.each=ei,d.extend=di,d.iteratee=ie,d.clone=jt,d.escapeRegExp=ne,d.every=Ft,d.find=ti,d.identity=oe,d.indexOf=Mt,d.isArguments=Kt,d.isArray=li,d.isElement=Vt,d.isEqual=zt,d.isFunction=ui,d.isNative=Yt,d.isNumber=Xt,d.isObject=Wt,d.isPlainObject=ci,d.isString=Qt,d.isTypedArray=Zt,d.last=Bt,d.noop=ae,d.now=ri,d.reduce=ii,d.uniqueId=ue,d.all=Ft,d.eq=zt,d.detect=ti,d.foldl=ii,d.inject=ii,d.VERSION=de,y(["bind","partial"],function(t){d[t].placeholder=d}),"function"==typeof t&&"object"==typeof t.amd&&t.amd?(hn._=d,t(function(){return d})):an&&ln?fn?(ln.exports=d)._=d:an._=d:hn._=d}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,n,i){!function(e){function n(){this._events={},this._conf&&r.call(this,this._conf)}function r(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners&&(this._events.maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),this.wildcard&&(this.listenerTree={}))}function o(t){this._events={},this.newListener=!1,r.call(this,t)}function s(t,e,n,i){if(!n)return[];var r,o,a,l,u,c,d,f=[],h=e.length,p=e[i],m=e[i+1];if(i===h&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(r=0,o=n._listeners.length;o>r;r++)t&&t.push(n._listeners[r]);return[n]}if("*"===p||"**"===p||n[p]){if("*"===p){for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&(f=f.concat(s(t,e,n[a],i+1)));return f}if("**"===p){d=i+1===h||i+2===h&&"*"===m,d&&n._listeners&&(f=f.concat(s(t,e,n,h)));for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&("*"===a||"**"===a?(n[a]._listeners&&!d&&(f=f.concat(s(t,e,n[a],h))),f=f.concat(s(t,e,n[a],i))):f=a===m?f.concat(s(t,e,n[a],i+2)):f.concat(s(t,e,n[a],i)));return f}f=f.concat(s(t,e,n[p],i+1))}if(l=n["*"],l&&s(t,e,l,i+1),u=n["**"])if(h>i){u._listeners&&s(t,e,u,h);for(a in u)"_listeners"!==a&&u.hasOwnProperty(a)&&(a===m?s(t,e,u[a],i+2):a===p?s(t,e,u[a],i+1):(c={},c[a]=u[a],s(t,e,{"**":c},i+1)))}else u._listeners?s(t,e,u,h):u["*"]&&u["*"]._listeners&&s(t,e,u["*"],h);return f}function a(t,e){t="string"==typeof t?t.split(this.delimiter):t.slice();for(var n=0,i=t.length;i>n+1;n++)if("**"===t[n]&&"**"===t[n+1])return;for(var r=this.listenerTree,o=t.shift();o;){if(r[o]||(r[o]={}),r=r[o],0===t.length){if(r._listeners){if("function"==typeof r._listeners)r._listeners=[r._listeners,e];else if(l(r._listeners)&&(r._listeners.push(e),!r._listeners.warned)){var s=u;"undefined"!=typeof this._events.maxListeners&&(s=this._events.maxListeners),s>0&&r._listeners.length>s&&(r._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",r._listeners.length),console.trace())}}else r._listeners=e;return!0}o=t.shift()}return!0}var l=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},u=10;o.prototype.delimiter=".",o.prototype.setMaxListeners=function(t){this._events||n.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t},o.prototype.event="",o.prototype.once=function(t,e){return this.many(t,1,e),this},o.prototype.many=function(t,e,n){function i(){0===--e&&r.off(t,i),n.apply(this,arguments)}var r=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return i._origin=n,this.on(t,i),r},o.prototype.emit=function(){this._events||n.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var e=arguments.length,i=new Array(e-1),r=1;e>r;r++)i[r-1]=arguments[r];for(r=0,e=this._all.length;e>r;r++)this.event=t,this._all[r].apply(this,i)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var o;if(this.wildcard){o=[];var a="string"==typeof t?t.split(this.delimiter):t.slice();s.call(this,o,a,this.listenerTree,0)}else o=this._events[t];if("function"==typeof o){if(this.event=t,1===arguments.length)o.call(this);else if(arguments.length>1)switch(arguments.length){case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(var e=arguments.length,i=new Array(e-1),r=1;e>r;r++)i[r-1]=arguments[r];o.apply(this,i)}return!0}if(o){for(var e=arguments.length,i=new Array(e-1),r=1;e>r;r++)i[r-1]=arguments[r];for(var l=o.slice(),r=0,e=l.length;e>r;r++)this.event=t,l[r].apply(this,i);return l.length>0||!!this._all}return!!this._all},o.prototype.on=function(t,e){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof e)throw new Error("on only accepts instances of Function");if(this._events||n.call(this),this.emit("newListener",t,e),this.wildcard)return a.call(this,t,e),this;if(this._events[t]){if("function"==typeof this._events[t])this._events[t]=[this._events[t],e];else if(l(this._events[t])&&(this._events[t].push(e),!this._events[t].warned)){var i=u;"undefined"!=typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}}else this._events[t]=e;return this},o.prototype.onAny=function(t){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(t),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");var n,i=[];if(this.wildcard){var r="string"==typeof t?t.split(this.delimiter):t.slice();i=s.call(this,null,r,this.listenerTree,0)}else{if(!this._events[t])return this;n=this._events[t],i.push({_listeners:n})}for(var o=0;o<i.length;o++){var a=i[o];if(n=a._listeners,l(n)){for(var u=-1,c=0,d=n.length;d>c;c++)if(n[c]===e||n[c].listener&&n[c].listener===e||n[c]._origin&&n[c]._origin===e){u=c;break}if(0>u)continue;return this.wildcard?a._listeners.splice(u,1):this._events[t].splice(u,1),0===n.length&&(this.wildcard?delete a._listeners:delete this._events[t]),this}(n===e||n.listener&&n.listener===e||n._origin&&n._origin===e)&&(this.wildcard?delete a._listeners:delete this._events[t])}return this},o.prototype.offAny=function(t){var e,n=0,i=0;if(t&&this._all&&this._all.length>0){for(e=this._all,n=0,i=e.length;i>n;n++)if(t===e[n])return e.splice(n,1),this}else this._all=[];return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||n.call(this),this;if(this.wildcard)for(var e="string"==typeof t?t.split(this.delimiter):t.slice(),i=s.call(this,null,e,this.listenerTree,0),r=0;r<i.length;r++){var o=i[r];o._listeners=null}else{if(!this._events[t])return this;this._events[t]=null}return this},o.prototype.listeners=function(t){if(this.wildcard){var e=[],i="string"==typeof t?t.split(this.delimiter):t.slice();return s.call(this,e,i,this.listenerTree,0),e}return this._events||n.call(this),this._events[t]||(this._events[t]=[]),l(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},o.prototype.listenersAny=function(){
return this._all?this._all:[]},"function"==typeof t&&t.amd?t(function(){return o}):"object"==typeof i?i.EventEmitter2=o:window.EventEmitter2=o}()},{}],3:[function(t,e,n){var i=t("fast-diff"),r=t("./is"),o=t("./op"),s=String.fromCharCode(0),a=function(t){r.array(t)?this.ops=t:r.object(t)&&r.array(t.ops)?this.ops=t.ops:this.ops=[]};a.prototype.insert=function(t,e){var n={};return 0===t.length?this:(n.insert=t,r.object(e)&&Object.keys(e).length>0&&(n.attributes=e),this.push(n))},a.prototype["delete"]=function(t){return 0>=t?this:this.push({"delete":t})},a.prototype.retain=function(t,e){if(0>=t)return this;var n={retain:t};return r.object(e)&&Object.keys(e).length>0&&(n.attributes=e),this.push(n)},a.prototype.push=function(t){var e=this.ops.length,n=this.ops[e-1];if(t=o.clone(t),r.object(n)){if(r.number(t["delete"])&&r.number(n["delete"]))return this.ops[e-1]={"delete":n["delete"]+t["delete"]},this;if(r.number(n["delete"])&&null!=t.insert&&(e-=1,n=this.ops[e-1],!r.object(n)))return this.ops.unshift(t),this;if(r.equal(t.attributes,n.attributes)){if(r.string(t.insert)&&r.string(n.insert))return this.ops[e-1]={insert:n.insert+t.insert},r.object(t.attributes)&&(this.ops[e-1].attributes=t.attributes),this;if(r.number(t.retain)&&r.number(n.retain))return this.ops[e-1]={retain:n.retain+t.retain},r.object(t.attributes)&&(this.ops[e-1].attributes=t.attributes),this}}return e===this.ops.length?this.ops.push(t):this.ops.splice(e,0,t),this},a.prototype.chop=function(){var t=this.ops[this.ops.length-1];return t&&t.retain&&!t.attributes&&this.ops.pop(),this},a.prototype.length=function(){return this.ops.reduce(function(t,e){return t+o.length(e)},0)},a.prototype.slice=function(t,e){t=t||0,r.number(e)||(e=1/0);for(var n=new a,i=o.iterator(this.ops),s=0;e>s&&i.hasNext();){var l;t>s?l=i.next(t-s):(l=i.next(e-s),n.push(l)),s+=o.length(l)}return n},a.prototype.compose=function(t){for(var e=o.iterator(this.ops),n=o.iterator(t.ops),i=new a;e.hasNext()||n.hasNext();)if("insert"===n.peekType())i.push(n.next());else if("delete"===e.peekType())i.push(e.next());else{var s=Math.min(e.peekLength(),n.peekLength()),l=e.next(s),u=n.next(s);if(r.number(u.retain)){var c={};r.number(l.retain)?c.retain=s:c.insert=l.insert;var d=o.attributes.compose(l.attributes,u.attributes,r.number(l.retain));d&&(c.attributes=d),i.push(c)}else r.number(u["delete"])&&r.number(l.retain)&&i.push(u)}return i.chop()},a.prototype.diff=function(t){var e=new a;if(this.ops===t.ops)return e;var n=[this.ops,t.ops].map(function(e){return e.map(function(n){if(null!=n.insert)return r.string(n.insert)?n.insert:s;var i=e===t.ops?"on":"with";throw new Error("diff() called "+i+" non-document")}).join("")}),l=i(n[0],n[1]),u=o.iterator(this.ops),c=o.iterator(t.ops);return l.forEach(function(t){for(var n=t[1].length;n>0;){var s=0;switch(t[0]){case i.INSERT:s=Math.min(c.peekLength(),n),e.push(c.next(s));break;case i.DELETE:s=Math.min(n,u.peekLength()),u.next(s),e["delete"](s);break;case i.EQUAL:s=Math.min(u.peekLength(),c.peekLength(),n);var a=u.next(s),l=c.next(s);r.equal(a.insert,l.insert)?e.retain(s,o.attributes.diff(a.attributes,l.attributes)):e.push(l)["delete"](s)}n-=s}}),e.chop()},a.prototype.transform=function(t,e){if(e=!!e,r.number(t))return this.transformPosition(t,e);for(var n=o.iterator(this.ops),i=o.iterator(t.ops),s=new a;n.hasNext()||i.hasNext();)if("insert"!==n.peekType()||!e&&"insert"===i.peekType())if("insert"===i.peekType())s.push(i.next());else{var l=Math.min(n.peekLength(),i.peekLength()),u=n.next(l),c=i.next(l);if(u["delete"])continue;c["delete"]?s.push(c):s.retain(l,o.attributes.transform(u.attributes,c.attributes,e))}else s.retain(o.length(n.next()));return s.chop()},a.prototype.transformPosition=function(t,e){e=!!e;for(var n=o.iterator(this.ops),i=0;n.hasNext()&&t>=i;){var r=n.peekLength(),s=n.peekType();n.next(),"delete"!==s?("insert"===s&&(t>i||!e)&&(t+=r),i+=r):t-=Math.min(r,t-i)}return t},e.exports=a},{"./is":4,"./op":5,"fast-diff":6}],4:[function(t,e,n){e.exports={equal:function(t,e){if(t===e)return!0;if(null==t&&null==e)return!0;if(null==t||null==e)return!1;if(!this.object(t)||!this.object(e))return!1;if(Object.keys(t).length!=Object.keys(e).length)return!1;for(var n in t)if(t[n]!==e[n])return!1;return!0},array:function(t){return Array.isArray(t)},number:function(t){return"number"==typeof t?!0:"object"==typeof t&&"[object Number]"===Object.prototype.toString.call(t)?!0:!1},object:function(t){return t?"function"==typeof t||"object"==typeof t:!1},string:function(t){return"string"==typeof t?!0:"object"==typeof t&&"[object String]"===Object.prototype.toString.call(t)?!0:!1}}},{}],5:[function(t,e,n){function i(t){this.ops=t,this.index=0,this.offset=0}var r=t("./is"),o={attributes:{clone:function(t,e){return r.object(t)?Object.keys(t).reduce(function(n,i){return void 0===t[i]||null===t[i]&&!e||(n[i]=t[i]),n},{}):{}},compose:function(t,e,n){r.object(t)||(t={}),r.object(e)||(e={});var i=this.clone(e,n);for(var o in t)void 0!==t[o]&&void 0===e[o]&&(i[o]=t[o]);return Object.keys(i).length>0?i:void 0},diff:function(t,e){r.object(t)||(t={}),r.object(e)||(e={});var n=Object.keys(t).concat(Object.keys(e)).reduce(function(n,i){return t[i]!==e[i]&&(n[i]=void 0===e[i]?null:e[i]),n},{});return Object.keys(n).length>0?n:void 0},transform:function(t,e,n){if(!r.object(t))return e;if(!r.object(e))return void 0;if(!n)return e;var i=Object.keys(e).reduce(function(n,i){return void 0===t[i]&&(n[i]=e[i]),n},{});return Object.keys(i).length>0?i:void 0}},clone:function(t){var e=this.attributes.clone(t);return r.object(e.attributes)&&(e.attributes=this.attributes.clone(e.attributes,!0)),e},iterator:function(t){return new i(t)},length:function(t){return r.number(t["delete"])?t["delete"]:r.number(t.retain)?t.retain:r.string(t.insert)?t.insert.length:1}};i.prototype.hasNext=function(){return this.peekLength()<1/0},i.prototype.next=function(t){t||(t=1/0);var e=this.ops[this.index];if(e){var n=this.offset,i=o.length(e);if(t>=i-n?(t=i-n,this.index+=1,this.offset=0):this.offset+=t,r.number(e["delete"]))return{"delete":t};var s={};return e.attributes&&(s.attributes=e.attributes),r.number(e.retain)?s.retain=t:r.string(e.insert)?s.insert=e.insert.substr(n,t):s.insert=e.insert,s}return{retain:1/0}},i.prototype.peekLength=function(){return this.ops[this.index]?o.length(this.ops[this.index])-this.offset:1/0},i.prototype.peekType=function(){return this.ops[this.index]?r.number(this.ops[this.index]["delete"])?"delete":r.number(this.ops[this.index].retain)?"retain":"insert":"retain"},e.exports=o},{"./is":4}],6:[function(t,e,n){function i(t,e){if(t==e)return t?[[h,t]]:[];var n=a(t,e),i=t.substring(0,n);t=t.substring(n),e=e.substring(n),n=l(t,e);var o=t.substring(t.length-n);t=t.substring(0,t.length-n),e=e.substring(0,e.length-n);var s=r(t,e);return i&&s.unshift([h,i]),o&&s.push([h,o]),c(s),s}function r(t,e){var n;if(!t)return[[f,e]];if(!e)return[[d,t]];var r=t.length>e.length?t:e,s=t.length>e.length?e:t,a=r.indexOf(s);if(-1!=a)return n=[[f,r.substring(0,a)],[h,s],[f,r.substring(a+s.length)]],t.length>e.length&&(n[0][0]=n[2][0]=d),n;if(1==s.length)return[[d,t],[f,e]];var l=u(t,e);if(l){var c=l[0],p=l[1],m=l[2],g=l[3],v=l[4],y=i(c,m),b=i(p,g);return y.concat([[h,v]],b)}return o(t,e)}function o(t,e){for(var n=t.length,i=e.length,r=Math.ceil((n+i)/2),o=r,a=2*r,l=new Array(a),u=new Array(a),c=0;a>c;c++)l[c]=-1,u[c]=-1;l[o+1]=0,u[o+1]=0;for(var h=n-i,p=h%2!=0,m=0,g=0,v=0,y=0,b=0;r>b;b++){for(var A=-b+m;b-g>=A;A+=2){var C,k=o+A;C=A==-b||A!=b&&l[k-1]<l[k+1]?l[k+1]:l[k-1]+1;for(var T=C-A;n>C&&i>T&&t.charAt(C)==e.charAt(T);)C++,T++;if(l[k]=C,C>n)g+=2;else if(T>i)m+=2;else if(p){var w=o+h-A;if(w>=0&&a>w&&-1!=u[w]){var S=n-u[w];if(C>=S)return s(t,e,C,T)}}}for(var E=-b+v;b-y>=E;E+=2){var S,w=o+E;S=E==-b||E!=b&&u[w-1]<u[w+1]?u[w+1]:u[w-1]+1;for(var I=S-E;n>S&&i>I&&t.charAt(n-S-1)==e.charAt(i-I-1);)S++,I++;if(u[w]=S,S>n)y+=2;else if(I>i)v+=2;else if(!p){var k=o+h-E;if(k>=0&&a>k&&-1!=l[k]){var C=l[k],T=o+C-k;if(S=n-S,C>=S)return s(t,e,C,T)}}}}return[[d,t],[f,e]]}function s(t,e,n,r){var o=t.substring(0,n),s=e.substring(0,r),a=t.substring(n),l=e.substring(r),u=i(o,s),c=i(a,l);return u.concat(c)}function a(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,i=Math.min(t.length,e.length),r=i,o=0;r>n;)t.substring(o,r)==e.substring(o,r)?(n=r,o=n):i=r,r=Math.floor((i-n)/2+n);return r}function l(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,i=Math.min(t.length,e.length),r=i,o=0;r>n;)t.substring(t.length-r,t.length-o)==e.substring(e.length-r,e.length-o)?(n=r,o=n):i=r,r=Math.floor((i-n)/2+n);return r}function u(t,e){function n(t,e,n){for(var i,r,o,s,u=t.substring(n,n+Math.floor(t.length/4)),c=-1,d="";-1!=(c=e.indexOf(u,c+1));){var f=a(t.substring(n),e.substring(c)),h=l(t.substring(0,n),e.substring(0,c));d.length<h+f&&(d=e.substring(c-h,c)+e.substring(c,c+f),i=t.substring(0,n-h),r=t.substring(n+f),o=e.substring(0,c-h),s=e.substring(c+f))}return 2*d.length>=t.length?[i,r,o,s,d]:null}var i=t.length>e.length?t:e,r=t.length>e.length?e:t;if(i.length<4||2*r.length<i.length)return null;var o,s=n(i,r,Math.ceil(i.length/4)),u=n(i,r,Math.ceil(i.length/2));if(!s&&!u)return null;o=u?s&&s[4].length>u[4].length?s:u:s;var c,d,f,h;t.length>e.length?(c=o[0],d=o[1],f=o[2],h=o[3]):(f=o[0],h=o[1],c=o[2],d=o[3]);var p=o[4];return[c,d,f,h,p]}function c(t){t.push([h,""]);for(var e,n=0,i=0,r=0,o="",s="";n<t.length;)switch(t[n][0]){case f:r++,s+=t[n][1],n++;break;case d:i++,o+=t[n][1],n++;break;case h:i+r>1?(0!==i&&0!==r&&(e=a(s,o),0!==e&&(n-i-r>0&&t[n-i-r-1][0]==h?t[n-i-r-1][1]+=s.substring(0,e):(t.splice(0,0,[h,s.substring(0,e)]),n++),s=s.substring(e),o=o.substring(e)),e=l(s,o),0!==e&&(t[n][1]=s.substring(s.length-e)+t[n][1],s=s.substring(0,s.length-e),o=o.substring(0,o.length-e))),0===i?t.splice(n-r,i+r,[f,s]):0===r?t.splice(n-i,i+r,[d,o]):t.splice(n-i-r,i+r,[d,o],[f,s]),n=n-i-r+(i?1:0)+(r?1:0)+1):0!==n&&t[n-1][0]==h?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,r=0,i=0,o="",s=""}""===t[t.length-1][1]&&t.pop();var u=!1;for(n=1;n<t.length-1;)t[n-1][0]==h&&t[n+1][0]==h&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),u=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),u=!0)),n++;u&&c(t)}var d=-1,f=1,h=0,p=i;p.INSERT=f,p.DELETE=d,p.EQUAL=h,e.exports=p},{}],7:[function(t,e,n){e.exports={version:"0.20.0"}},{}],8:[function(t,e,n){var i,r,o,s,a,l,u,c;u=t("lodash"),i=t("rich-text/lib/delta"),c=t("../lib/dom"),o=t("./format"),s=t("./line"),a=t("../lib/linked-list"),l=t("./normalizer"),r=function(){function t(t,e){this.root=t,null==e&&(e={}),this.normalizer=new l,this.formats={},u.each(e.formats,u.bind(this.addFormat,this)),this.setHTML(this.root.innerHTML)}return t.prototype.addFormat=function(t,e){return u.isObject(e)||(e=o.FORMATS[t]),null!=this.formats[t]&&console.warn("Overwriting format",t,this.formats[t]),this.formats[t]=new o(e),this.normalizer.addFormat(e)},t.prototype.appendLine=function(t){return this.insertLineBefore(t,null)},t.prototype.findLeafAt=function(t,e){var n,i,r;return r=this.findLineAt(t),n=r[0],i=r[1],null!=n?n.findLeafAt(i,e):[void 0,i]},t.prototype.findLine=function(t){for(var e;null!=t&&null==c.BLOCK_TAGS[t.tagName];)t=t.parentNode;return e=null!=t?c(t).data(s.DATA_KEY):void 0,(null!=e?e.node:void 0)===t?e:void 0},t.prototype.findLineAt=function(t){var e,n;if(!(this.lines.length>0))return[void 0,t];if(n=this.toDelta().length(),t===n)return[this.lines.last,this.lines.last.length];if(t>n)return[void 0,t-n];for(e=this.lines.first;null!=e;){if(t<e.length)return[e,t];t-=e.length,e=e.next}return[void 0,t]},t.prototype.getHTML=function(){return this.root.innerHTML.replace(/\>\s+\</g,">&nbsp;<")},t.prototype.insertLineBefore=function(t,e){var n;return n=new s(this,t),null!=e?(c(t.parentNode).isElement()||this.root.insertBefore(t,e.node),this.lines.insertAfter(e.prev,n)):(c(t.parentNode).isElement()||this.root.appendChild(t),this.lines.append(n)),n},t.prototype.mergeLines=function(t,e){return e.length>1&&(1===t.length&&c(t.leaves.last.node).remove(),u.each(c(e.node).childNodes(),function(e){return e.tagName!==c.DEFAULT_BREAK_TAG?t.node.appendChild(e):void 0})),this.removeLine(e),t.rebuild()},t.prototype.optimizeLines=function(){return u.each(this.lines.toArray(),function(t,e){return t.optimize(),!0})},t.prototype.rebuild=function(){var t,e,n;for(e=this.lines.toArray(),t=this.root.firstChild,null!=t&&null!=c.LIST_TAGS[t.tagName]&&(t=t.firstChild),u.each(e,function(e){return function(n,i){for(var r,o;n.node!==t;){if(n.node.parentNode!==e.root&&(null!=(o=n.node.parentNode)?o.parentNode:void 0)!==e.root)return e.removeLine(n);t=e.normalizer.normalizeLine(t),r=e.insertLineBefore(t,n),t=c(t).nextLineNode(e.root)}return n.outerHTML!==t.outerHTML&&(n.node=e.normalizer.normalizeLine(n.node),n.rebuild()),t=c(t).nextLineNode(e.root)}}(this)),n=[];null!=t;)t=this.normalizer.normalizeLine(t),this.appendLine(t),n.push(t=c(t).nextLineNode(this.root));return n},t.prototype.removeLine=function(t){return null!=t.node.parentNode&&(c.LIST_TAGS[t.node.parentNode.tagName]&&1===t.node.parentNode.childNodes.length?c(t.node.parentNode).remove():c(t.node).remove()),this.lines.remove(t)},t.prototype.setHTML=function(t){return t=l.stripComments(t),t=l.stripWhitespace(t),this.root.innerHTML=t,this.lines=new a,this.rebuild()},t.prototype.splitLine=function(t,e){var n,i,r,o;return e=Math.min(e,t.length-1),o=c(t.node).split(e,!0),n=o[0],i=o[1],t.node=n,t.rebuild(),r=this.insertLineBefore(i,t.next),r.formats=u.clone(t.formats),r.resetContent(),r},t.prototype.toDelta=function(){var t,e;return e=this.lines.toArray(),t=new i,u.each(e,function(e){return u.each(e.delta.ops,function(e){return t.push(e)})}),t},t}(),e.exports=r},{"../lib/dom":17,"../lib/linked-list":18,"./format":10,"./line":12,"./normalizer":13,lodash:1,"rich-text/lib/delta":3}],9:[function(t,e,n){var i,r,o,s,a,l,u;l=t("lodash"),i=t("rich-text/lib/delta"),u=t("../lib/dom"),r=t("./document"),s=t("./line"),a=t("./selection"),o=function(){function t(t,e,n){this.root=t,this.quill=e,this.options=null!=n?n:{},this.root.setAttribute("id",this.options.id),this.doc=new r(this.root,this.options),this.delta=this.doc.toDelta(),this.length=this.delta.length(),this.selection=new a(this.doc,this.quill),this.timer=setInterval(l.bind(this.checkUpdate,this),this.options.pollInterval),this.savedRange=null,this.quill.on("selection-change",function(t){return function(e){return t.savedRange=e}}(this)),this.options.readOnly||this.enable()}return t.sources={API:"api",SILENT:"silent",USER:"user"},t.prototype.destroy=function(){return clearInterval(this.timer)},t.prototype.disable=function(){return this.enable(!1)},t.prototype.enable=function(t){return null==t&&(t=!0),this.root.setAttribute("contenteditable",t)},t.prototype.applyDelta=function(e,n){var i;return i=this._update(),i&&(e=i.transform(e,!0),i=e.transform(i,!1)),e.ops.length>0&&(e=this._trackDelta(function(t){return function(){var n;return n=0,l.each(e.ops,function(e){return l.isString(e.insert)?(t._insertAt(n,e.insert,e.attributes),n+=e.insert.length):l.isNumber(e.insert)?(t._insertEmbed(n,e.attributes),n+=1):l.isNumber(e["delete"])?t._deleteAt(n,e["delete"]):l.isNumber(e.retain)?(l.each(e.attributes,function(i,r){return t._formatAt(n,e.retain,r,i)}),n+=e.retain):void 0}),t.selection.shiftAfter(0,0,l.bind(t.doc.optimizeLines,t.doc))}}(this)),this.delta=this.doc.toDelta(),this.length=this.delta.length(),this.innerHTML=this.root.innerHTML,e&&n!==t.sources.SILENT&&this.quill.emit(this.quill.constructor.events.TEXT_CHANGE,e,n)),i&&i.ops.length>0&&n!==t.sources.SILENT?this.quill.emit(this.quill.constructor.events.TEXT_CHANGE,i,t.sources.USER):void 0},t.prototype.checkUpdate=function(e){var n;return null==e&&(e="user"),null==this.root.parentNode?clearInterval(this.timer):(n=this._update(),n&&(this.delta=this.delta.compose(n),this.length=this.delta.length(),this.quill.emit(this.quill.constructor.events.TEXT_CHANGE,n,e)),n&&(e=t.sources.SILENT),this.selection.update(e))},t.prototype.focus=function(){return null!=this.selection.range?this.selection.setRange(this.selection.range):this.root.focus()},t.prototype.getBounds=function(t){var e,n,i,r,o,s,a;return this.checkUpdate(),s=this.doc.findLeafAt(t,!0),i=s[0],r=s[1],null==i?null:(n=this.root.parentNode.getBoundingClientRect(),a="left",0===i.length?e=i.node.parentNode.getBoundingClientRect():u.VOID_TAGS[i.node.tagName]?(e=i.node.getBoundingClientRect(),1===r&&(a="right")):(o=document.createRange(),r<i.length?(o.setStart(i.node,r),o.setEnd(i.node,r+1)):(o.setStart(i.node,r-1),o.setEnd(i.node,r),a="right"),e=o.getBoundingClientRect()),{height:e.height,left:e[a]-n.left,top:e.top-n.top})},t.prototype._deleteAt=function(t,e){return 0>=e?void 0:this.selection.shiftAfter(t,-1*e,function(n){return function(){var i,r,o,s,a,l,u;for(u=n.doc.findLineAt(t),o=u[0],l=u[1],i=o,s=o.length-l<=e&&l>0;null!=i&&e>0;)a=i.next,r=Math.min(i.length-l,e),0===l&&e>=i.length?n.doc.removeLine(i):i.deleteText(l,r),e-=r,i=a,l=0;return s&&o.next?n.doc.mergeLines(o,o.next):void 0}}(this))},t.prototype._formatAt=function(t,e,n,i){return this.selection.shiftAfter(t,0,function(r){return function(){var o,s,a,l,u;for(l=r.doc.findLineAt(t),s=l[0],a=l[1],u=[];null!=s&&e>0;)o=Math.min(e,s.length-a-1),s.formatText(a,o,n,i),e-=o,e>0&&s.format(n,i),e-=1,a=0,u.push(s=s.next);return u}}(this))},t.prototype._insertEmbed=function(t,e){return this.selection.shiftAfter(t,1,function(n){return function(){var i,r,o;return o=n.doc.findLineAt(t),i=o[0],r=o[1],i.insertEmbed(r,e)}}(this))},t.prototype._insertAt=function(t,e,n){return null==n&&(n={}),this.selection.shiftAfter(t,e.length,function(i){return function(){var r,o,s,a;return e=e.replace(/\r\n?/g,"\n"),o=e.split("\n"),a=i.doc.findLineAt(t),r=a[0],s=a[1],l.each(o,function(t,e){var a;return null==r||r.length<=s?(e<o.length-1||t.length>0)&&(r=i.doc.appendLine(document.createElement(u.DEFAULT_BLOCK_TAG)),s=0,r.insertText(s,t,n),r.format(n),a=null):(r.insertText(s,t,n),e<o.length-1&&(a=i.doc.splitLine(r,s+t.length),l.each(l.defaults({},n,r.formats),function(t,e){return r.format(e,n[e])}),s=0)),r=a})}}(this))},t.prototype._trackDelta=function(t){var e,n,i,r,o,s,a,u,c,d;s=null!=(c=this.savedRange)?c.start:void 0,t(),n=this.doc.toDelta(),this.savedRange=this.selection.getRange(),i=null!=(d=this.savedRange)?d.start:void 0;try{if(null!=s&&null!=i&&s<=this.delta.length()&&i<=n.length()&&(u=this.delta.slice(s),o=n.slice(i),l.isEqual(u.ops,o.ops)))return a=this.delta.slice(0,s),r=n.slice(0,i),a.diff(r)}catch(f){e=f}return this.delta.diff(n)},t.prototype._update=function(){var t;return this.innerHTML===this.root.innerHTML?!1:(t=this._trackDelta(function(t){return function(){return t.selection.preserve(l.bind(t.doc.rebuild,t.doc)),t.selection.shiftAfter(0,0,l.bind(t.doc.optimizeLines,t.doc))}}(this)),this.innerHTML=this.root.innerHTML,t.ops.length>0?t:!1)},t}(),e.exports=o},{"../lib/dom":17,"./document":8,"./line":12,"./selection":14,lodash:1,"rich-text/lib/delta":3}],10:[function(t,e,n){var i,r,o;r=t("lodash"),o=t("../lib/dom"),i=function(){function t(t){this.config=t}return t.types={LINE:"line",EMBED:"embed"},t.FORMATS={bold:{tag:"B",prepare:"bold"},italic:{tag:"I",prepare:"italic"},underline:{tag:"U",prepare:"underline"},strike:{tag:"S",prepare:"strikeThrough"},color:{style:"color","default":"rgb(0, 0, 0)",prepare:"foreColor"},background:{style:"backgroundColor","default":"rgb(255, 255, 255)",prepare:"backColor"},font:{style:"fontFamily","default":"'Helvetica', 'Arial', sans-serif",prepare:"fontName"},size:{style:"fontSize","default":"13px",prepare:function(t){return document.execCommand("fontSize",!1,o.convertFontSize(t))}},link:{tag:"A",add:function(t,e){return t.setAttribute("href",t.innerText),t},remove:function(t){return t.removeAttribute("href"),t},value:function(t){return!!t.getAttribute("href")}},image:{type:t.types.EMBED,tag:"IMG",attribute:"src"},align:{type:t.types.LINE,style:"textAlign","default":"left"},bullet:{type:t.types.LINE,exclude:"list",parentTag:"UL",tag:"LI"},list:{type:t.types.LINE,exclude:"bullet",parentTag:"OL",tag:"LI"}},t.prototype.add=function(e,n){var i,s,a,l,u;return n?this.value(e)===n?e:(r.isString(this.config.parentTag)&&(a=e.parentNode,a.tagName!==this.config.parentTag&&(a=document.createElement(this.config.parentTag),o(e).wrap(a)),e.parentNode.tagName===(null!=(l=e.parentNode.previousSibling)?l.tagName:void 0)&&o(e.parentNode.previousSibling).merge(e.parentNode),e.parentNode.tagName===(null!=(u=e.parentNode.nextSibling)?u.tagName:void 0)&&o(e.parentNode).merge(e.parentNode.nextSibling)),r.isString(this.config.tag)&&e.tagName!==this.config.tag&&(i=document.createElement(this.config.tag),null!=o.VOID_TAGS[i.tagName]?(null!=e.parentNode&&o(e).replace(i),e=i):this.isType(t.types.LINE)?e=o(e).switchTag(this.config.tag).get():(o(e).wrap(i),e=i)),(r.isString(this.config.style)||r.isString(this.config.attribute)||r.isString(this.config["class"]))&&(r.isString(this.config["class"])&&(e=this.remove(e)),o(e).isTextNode()&&(s=document.createElement(o.DEFAULT_INLINE_TAG),o(e).wrap(s),e=s),r.isString(this.config.style)&&n!==this.config["default"]&&(e.style[this.config.style]=n),r.isString(this.config.attribute)&&e.setAttribute(this.config.attribute,n),r.isString(this.config["class"])&&o(e).addClass(this.config["class"]+n)),r.isFunction(this.config.add)&&(e=this.config.add(e,n)),e):this.remove(e)},t.prototype.isType=function(t){return t===this.config.type},t.prototype.match=function(t){var e,n,i,s,a;if(!o(t).isElement())return!1;if(r.isString(this.config.parentTag)&&(null!=(s=t.parentNode)?s.tagName:void 0)!==this.config.parentTag)return!1;if(r.isString(this.config.tag)&&t.tagName!==this.config.tag)return!1;if(r.isString(this.config.style)&&(!t.style[this.config.style]||t.style[this.config.style]===this.config["default"]))return!1;if(r.isString(this.config.attribute)&&!t.hasAttribute(this.config.attribute))return!1;if(r.isString(this.config["class"])){for(a=o(t).classes(),n=0,i=a.length;i>n;n++)if(e=a[n],0===e.indexOf(this.config["class"]))return!0;return!1}return!0},t.prototype.prepare=function(t){return r.isString(this.config.prepare)?document.execCommand(this.config.prepare,!1,t):r.isFunction(this.config.prepare)?this.config.prepare(t):void 0},t.prototype.remove=function(e){var n,i,s,a;if(!this.match(e))return e;if(r.isString(this.config.style)&&(e.style[this.config.style]="",e.getAttribute("style")||e.removeAttribute("style")),r.isString(this.config.attribute)&&e.removeAttribute(this.config.attribute),r.isString(this.config["class"]))for(a=o(e).classes(),i=0,s=a.length;s>i;i++)n=a[i],0===n.indexOf(this.config["class"])&&o(e).removeClass(n);if(r.isString(this.config.tag))if(this.isType(t.types.LINE))r.isString(this.config.parentTag)&&(null!=e.previousSibling&&o(e).splitBefore(e.parentNode.parentNode),null!=e.nextSibling&&o(e.nextSibling).splitBefore(e.parentNode.parentNode)),e=o(e).switchTag(o.DEFAULT_BLOCK_TAG).get();else{if(this.isType(t.types.EMBED))return void o(e).remove();e=o(e).switchTag(o.DEFAULT_INLINE_TAG).get()}return r.isString(this.config.parentTag)&&o(e.parentNode).unwrap(),r.isFunction(this.config.remove)&&(e=this.config.remove(e)),e.tagName!==o.DEFAULT_INLINE_TAG||e.hasAttributes()||(e=o(e).unwrap()),e},t.prototype.value=function(t){var e,n,i,s;if(!this.match(t))return void 0;if(this.config.value)return this.config.value(t);if(r.isString(this.config.attribute))return t.getAttribute(this.config.attribute)||void 0;if(r.isString(this.config.style))return t.style[this.config.style]||void 0;if(r.isString(this.config["class"])){for(s=o(t).classes(),n=0,i=s.length;i>n;n++)if(e=s[n],0===e.indexOf(this.config["class"]))return e.slice(this.config["class"].length)}else if(r.isString(this.config.tag))return!0;return void 0},t}(),e.exports=i},{"../lib/dom":17,lodash:1}],11:[function(t,e,n){var i,r,o,s,a,l=function(t,e){function n(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("lodash"),a=t("../lib/dom"),i=t("./format"),o=t("../lib/linked-list"),r=function(t){function e(t,n){this.node=t,this.formats=s.clone(n),this.text=a(this.node).text(),this.length=this.text.length,a(this.node).data(e.DATA_KEY,this)}return l(e,t),e.DATA_KEY="leaf",e.isLeafNode=function(t){return a(t).isTextNode()||null==t.firstChild},e.prototype.deleteText=function(t,n){var i;if(n>0)return this.text=this.text.slice(0,t)+this.text.slice(t+n),this.length=this.text.length,null!=a.EMBED_TAGS[this.node.tagName]?(i=document.createTextNode(this.text),a(i).data(e.DATA_KEY,this),this.node=a(this.node).replace(i).get()):a(this.node).text(this.text)},e.prototype.insertText=function(t,n){var i;return this.text=this.text.slice(0,t)+n+this.text.slice(t),a(this.node).isTextNode()?a(this.node).text(this.text):(i=document.createTextNode(n),a(i).data(e.DATA_KEY,this),this.node.tagName===a.DEFAULT_BREAK_TAG?this.node=a(this.node).replace(i).get():(this.node.appendChild(i),this.node=i)),this.length=this.text.length},e}(o.Node),e.exports=r},{"../lib/dom":17,"../lib/linked-list":18,"./format":10,lodash:1}],12:[function(t,e,n){var i,r,o,s,a,l,u,c,d=function(t,e){function n(){this.constructor=t}for(var i in e)f.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("lodash"),i=t("rich-text/lib/delta"),c=t("../lib/dom"),r=t("./format"),o=t("./leaf"),s=t("./line"),a=t("../lib/linked-list"),l=t("./normalizer"),s=function(t){function e(t,n){this.doc=t,this.node=n,this.formats={},this.rebuild(),e.__super__.constructor.call(this,this.node)}return d(e,t),e.DATA_KEY="line",e.prototype.buildLeaves=function(t,e){return u.each(c(t).childNodes(),function(t){return function(n){var i;return n=t.doc.normalizer.normalizeNode(n),i=u.clone(e),u.each(t.doc.formats,function(t,e){return!t.isType(r.types.LINE)&&t.match(n)?i[e]=t.value(n):void 0}),o.isLeafNode(n)?t.leaves.append(new o(n,i)):t.buildLeaves(n,i)}}(this))},e.prototype.deleteText=function(t,e){var n,i,r;if(e>0){for(r=this.findLeafAt(t),i=r[0],t=r[1];null!=i&&e>0;)n=Math.min(e,i.length-t),i.deleteText(t,n),e-=n,i=i.next,t=0;return this.rebuild()}},e.prototype.findLeaf=function(t){return null!=t?c(t).data(o.DATA_KEY):void 0},e.prototype.findLeafAt=function(t,e){var n;if(null==e&&(e=!1),t>=this.length-1)return[this.leaves.last,this.leaves.last.length];for(n=this.leaves.first;null!=n;){if(t<n.length||t===n.length&&e)return[n,t];t-=n.length,n=n.next}return[this.leaves.last,t-this.leaves.last.length]},e.prototype.format=function(t,e){var n;return u.isObject(t)?n=t:(n={},n[t]=e),u.each(n,function(t){return function(e,n){var i,o;return o=t.doc.formats[n],null!=o?(o.isType(r.types.LINE)&&(o.config.exclude&&t.formats[o.config.exclude]&&(i=t.doc.formats[o.config.exclude],null!=i&&(t.node=i.remove(t.node),delete t.formats[o.config.exclude])),t.node=o.add(t.node,e)),e?t.formats[n]=e:delete t.formats[n]):void 0}}(this)),this.resetContent()},e.prototype.formatText=function(t,e,n,i){var o,s,a,l,u,d,f,h,p,m;if(d=this.findLeafAt(t),s=d[0],a=d[1],o=this.doc.formats[n],null!=o&&o.config.type!==r.types.LINE){for(;null!=s&&e>0;){if(u=s.next,i&&s.formats[n]!==i||!i&&null!=s.formats[n]){if(m=s.node,null!=s.formats[n]){for(c(m).splitBefore(this.node);!o.match(m);)m=m.parentNode;c(m).split(s.length)}a>0&&(f=c(m).split(a),l=f[0],m=f[1]),s.length>a+e&&(h=c(m).split(e),m=h[0],p=h[1]),o.add(m,i)}e-=s.length-a,a=0,s=u}return this.rebuild()}},e.prototype._insert=function(t,e,n){var i,r,o,s,a,l;return a=this.findLeafAt(t),i=a[0],r=a[1],e=u.reduce(n,function(t){return function(e,n,i){var r;return r=t.doc.formats[i],null!=r&&(e=r.add(e,n)),e}}(this),e),l=c(i.node).split(r),s=l[0],o=l[1],o&&(o=c(o).splitBefore(this.node).get()),this.node.insertBefore(e,o),this.rebuild()},e.prototype.insertEmbed=function(t,e){var n,i,o,s,a,l,d,f;return d=this.findLeafAt(t),i=d[0],o=d[1],f=c(i.node).split(o),l=f[0],s=f[1],n=u.find(Object.keys(e),function(t){return function(e){return t.doc.formats[e].isType(r.types.EMBED)}}(this)),a=this.doc.formats[n].add({},e[n]),e=u.clone(e),delete e[n],this._insert(t,a,e)},e.prototype.insertText=function(t,e,n){var i,r,o;return null==n&&(n={}),e.length>0?(o=this.findLeafAt(t),i=o[0],r=o[1],u.isEqual(i.formats,n)?(i.insertText(r,e),this.resetContent()):this._insert(t,document.createTextNode(e),n)):void 0},e.prototype.optimize=function(){return l.optimizeLine(this.node),this.rebuild()},e.prototype.rebuild=function(t){return null==t&&(t=!1),!t&&null!=this.outerHTML&&this.outerHTML===this.node.outerHTML&&u.all(this.leaves.toArray(),function(t){return function(e){return c(e.node).isAncestor(t.node)}}(this))?!1:(this.node=this.doc.normalizer.normalizeNode(this.node),0!==c(this.node).length()||this.node.querySelector(c.DEFAULT_BREAK_TAG)||this.node.appendChild(document.createElement(c.DEFAULT_BREAK_TAG)),this.leaves=new a,this.formats=u.reduce(this.doc.formats,function(t){return function(e,n,i){return n.isType(r.types.LINE)&&(n.match(t.node)?e[i]=n.value(t.node):delete e[i]),e}}(this),this.formats),this.buildLeaves(this.node,{}),this.resetContent(),!0)},e.prototype.resetContent=function(){return c(this.node).data(e.DATA_KEY,this),this.outerHTML=this.node.outerHTML,this.length=1,this.delta=new i,u.each(this.leaves.toArray(),function(t){return function(e){return t.length+=e.length,null!=c.EMBED_TAGS[e.node.tagName]?t.delta.insert(1,e.formats):t.delta.insert(e.text,e.formats)}}(this)),this.delta.insert("\n",this.formats)},e}(a.Node),e.exports=s},{"../lib/dom":17,"../lib/linked-list":18,"./format":10,"./leaf":11,"./line":12,"./normalizer":13,lodash:1,"rich-text/lib/delta":3}],13:[function(t,e,n){var i,r,o,s;r=t("lodash"),s=t("../lib/dom"),o=function(t){return t=t.replace(/(?:^|[-_])(\w)/g,function(t,e){return e?e.toUpperCase():""}),t.charAt(0).toLowerCase()+t.slice(1)},i=function(){function t(){this.whitelist={styles:{},tags:{}},this.whitelist.tags[s.DEFAULT_BREAK_TAG]=!0,this.whitelist.tags[s.DEFAULT_BLOCK_TAG]=!0,this.whitelist.tags[s.DEFAULT_INLINE_TAG]=!0}return t.ALIASES={STRONG:"B",EM:"I",DEL:"S",STRIKE:"S"},t.ATTRIBUTES={color:"color",face:"fontFamily",size:"fontSize"},t.prototype.addFormat=function(t){return null!=t.tag&&(this.whitelist.tags[t.tag]=!0),null!=t.parentTag&&(this.whitelist.tags[t.parentTag]=!0),null!=t.style?this.whitelist.styles[t.style]=!0:void 0},t.prototype.normalizeLine=function(e){return e=t.wrapInline(e),e=t.handleBreaks(e),"LI"===e.tagName&&t.flattenList(e),e=t.pullBlocks(e),e=this.normalizeNode(e),t.unwrapText(e),null!=e&&null!=s.LIST_TAGS[e.tagName]&&(e=e.firstChild),e},t.prototype.normalizeNode=function(e){return s(e).isTextNode()?e:(r.each(t.ATTRIBUTES,function(t,n){var i;return e.hasAttribute(n)?(i=e.getAttribute(n),"size"===n&&(i=s.convertFontSize(i)),e.style[t]=i,e.removeAttribute(n)):void 0}),"bold"===e.style.fontWeight&&(e.style.fontWeight="",s(e).wrap(document.createElement("b"))),this.whitelistStyles(e),this.whitelistTags(e))},t.prototype.whitelistStyles=function(t){var e,n;return e=s(t).styles(),n=r.omit(e,function(t){return function(e,n){return null==t.whitelist.styles[o(n)]}}(this)),Object.keys(n).length<Object.keys(e).length?Object.keys(n).length>0?s(t).styles(n,!0):t.removeAttribute("style"):void 0},t.prototype.whitelistTags=function(e){return s(e).isElement()?(null!=t.ALIASES[e.tagName]?e=s(e).switchTag(t.ALIASES[e.tagName]).get():(null==this.whitelist.tags[e.tagName]||"A"===e.tagName&&e.href!==e.innerText)&&(e=null!=s.BLOCK_TAGS[e.tagName]?s(e).switchTag(s.DEFAULT_BLOCK_TAG).get():e.hasAttributes()||null==e.firstChild?s(e).switchTag(s.DEFAULT_INLINE_TAG).get():s(e).unwrap()),e):e},t.flattenList=function(t){var e,n,i;return i=t.nextSibling,e=r.map(t.querySelectorAll("li")),e.forEach(function(e){return t.parentNode.insertBefore(e,i),i=e.nextSibling}),n=r.map(t.querySelectorAll(Object.keys(s.LIST_TAGS).join(","))),
n.forEach(function(t){return s(t).remove()})},t.handleBreaks=function(t){var e;return e=r.map(t.querySelectorAll(s.DEFAULT_BREAK_TAG)),r.each(e,function(e){return function(e){return null==e.nextSibling||s.isIE(10)&&null==e.previousSibling?void 0:s(e.nextSibling).splitBefore(t.parentNode)}}(this)),t},t.optimizeLine=function(t){var e,n,i,o;for(t.normalize(),e=s(t).length(),i=s(t).descendants(),o=[];i.length>0;)n=i.pop(),null!=(null!=n?n.parentNode:void 0)&&null==s.EMBED_TAGS[n.tagName]&&(n.tagName===s.DEFAULT_BREAK_TAG?0!==e?o.push(s(n).remove()):o.push(void 0):0===s(n).length()?(i.push(n.nextSibling),o.push(s(n).unwrap())):null!=n.previousSibling&&n.tagName===n.previousSibling.tagName&&r.isEqual(s(n).attributes(),s(n.previousSibling).attributes())?(i.push(n.firstChild),o.push(s(n.previousSibling).merge(n))):o.push(void 0));return o},t.pullBlocks=function(e){var n;for(n=e.firstChild;null!=n;){if(null!=s.BLOCK_TAGS[n.tagName]&&"LI"!==n.tagName){s(n).isolate(e.parentNode),null!=s.LIST_TAGS[n.tagName]&&n.firstChild?(s(n.parentNode).unwrap(),null==e.parentNode&&(e=n)):(s(n).unwrap(),t.pullBlocks(e));break}n=n.nextSibling}return e},t.stripComments=function(t){return t.replace(/<!--[\s\S]*?-->/g,"")},t.stripWhitespace=function(t){return t=t.trim(),t=t.replace(/(\r?\n|\r)+/g," "),t=t.replace(/\>\s+\</g,"><")},t.wrapInline=function(t){var e,n;if(null!=s.BLOCK_TAGS[t.tagName])return t;for(e=document.createElement(s.DEFAULT_BLOCK_TAG),t.parentNode.insertBefore(e,t);null!=t&&null==s.BLOCK_TAGS[t.tagName];)n=t.nextSibling,e.appendChild(t),t=n;return e},t.unwrapText=function(t){var e;return e=r.map(t.querySelectorAll(s.DEFAULT_INLINE_TAG)),r.each(e,function(t){return t.hasAttributes()?void 0:s(t).unwrap()})},t}(),e.exports=i},{"../lib/dom":17,lodash:1}],14:[function(t,e,n){var i,r,o,s,a,l;a=t("lodash"),l=t("../lib/dom"),i=t("./leaf"),r=t("./normalizer"),o=t("../lib/range"),s=function(){function t(t,e){this.doc=t,this.emitter=e,this.focus=!1,this.range=new o(0,0),this.nullDelay=!1,this.update("silent")}return t.prototype.checkFocus=function(){return document.activeElement===this.doc.root},t.prototype.getRange=function(t){var e,n,i;return null==t&&(t=!1),this.checkFocus()?(n=this._getNativeRange(),null==n?null:(i=this._positionToIndex(n.startContainer,n.startOffset),e=n.startContainer===n.endContainer&&n.startOffset===n.endOffset?i:this._positionToIndex(n.endContainer,n.endOffset),new o(Math.min(i,e),Math.max(i,e)))):t?this.range:null},t.prototype.preserve=function(t){var e,n,i,r,o,s,a,l,u;return i=this._getNativeRange(),null!=i&&this.checkFocus()?(r=this._encodePosition(i.startContainer,i.startOffset),l=r[0],u=r[1],o=this._encodePosition(i.endContainer,i.endOffset),e=o[0],n=o[1],t(),s=this._decodePosition(l,u),l=s[0],u=s[1],a=this._decodePosition(e,n),e=a[0],n=a[1],this._setNativeRange(l,u,e,n)):t()},t.prototype.cursorFocus=function(t){var e=this.doc.root.parentNode.scrollTop;t.focus(),this.doc.root.parentNode.scrollTop=e},t.prototype.setRange=function(t,e){var n,i,r,o,s,a,l;return null!=t?(r=this._indexToPosition(t.start),a=r[0],l=r[1],t.isCollapsed()?(o=[a,l],n=o[0],i=o[1]):(s=this._indexToPosition(t.end),n=s[0],i=s[1]),this._setNativeRange(a,l,n,i)):this._setNativeRange(null),this.update(e)},t.prototype.shiftAfter=function(t,e,n){var i;return i=this.getRange(),n(),null!=i?(i.shift(t,e),this.setRange(i,"silent")):void 0},t.prototype.update=function(t){var e,n,i,r;return n=this.checkFocus(),i=this.getRange(!0),e="silent"!==t&&(!o.compare(i,this.range)||n!==this.focus),r=n?i:null,null!==r||"user"!==t||this.nullDelay?(this.nullDelay=!1,this.range=i,this.focus=n,e?this.emitter.emit(this.emitter.constructor.events.SELECTION_CHANGE,r,t):void 0):this.nullDelay=!0},t.prototype._decodePosition=function(t,e){var n;return l(t).isElement()&&(n=l(t.parentNode).childNodes().indexOf(t),e+=n,t=t.parentNode),[t,e]},t.prototype._encodePosition=function(t,e){for(var n;;){if(l(t).isTextNode()||t.tagName===l.DEFAULT_BREAK_TAG||null!=l.EMBED_TAGS[t.tagName])return[t,e];if(e<t.childNodes.length)t=t.childNodes[e],e=0;else{if(0===t.childNodes.length)return null==this.doc.normalizer.whitelist.tags[t.tagName]&&(n=document.createTextNode(""),t.appendChild(n),t=n),[t,0];if(t=t.lastChild,!l(t).isElement())return[t,l(t).length()];if(t.tagName===l.DEFAULT_BREAK_TAG||null!=l.EMBED_TAGS[t.tagName])return[t,1];e=t.childNodes.length}}},t.prototype._getNativeRange=function(){var t,e;return e=document.getSelection(),(null!=e?e.rangeCount:void 0)>0&&(t=e.getRangeAt(0),l(t.startContainer).isAncestor(this.doc.root,!0)&&(t.startContainer===t.endContainer||l(t.endContainer).isAncestor(this.doc.root,!0)))?t:null},t.prototype._indexToPosition=function(t){var e,n,i;return 0===this.doc.lines.length?[this.doc.root,0]:(i=this.doc.findLeafAt(t,!0),e=i[0],n=i[1],this._decodePosition(e.node,n))},t.prototype._positionToIndex=function(t,e){var n,i,r,o,s,a;if(l.isIE(10)&&"BR"===t.tagName&&1===e&&(e=0),a=this._encodePosition(t,e),i=a[0],e=a[1],o=this.doc.findLine(i),null==o)return 0;for(n=o.findLeaf(i),s=0;null!=o.prev;)o=o.prev,s+=o.length;if(null==n)return s;for(r=0;null!=n.prev;)n=n.prev,r+=n.length;return s+r+e},t.prototype._setNativeRange=function(t,e,n,i){var r,o;if(o=document.getSelection())if(null!=t){if(this.checkFocus()||this.cursorFocus(this.doc.root),r=this._getNativeRange(),null==r||t!==r.startContainer||e!==r.startOffset||n!==r.endContainer||i!==r.endOffset)return o.removeAllRanges(),r=document.createRange(),r.setStart(t,e),r.setEnd(n,i),o.addRange(r)}else if(o.removeAllRanges(),this.doc.root.blur(),l.isIE(11)&&!l.isIE(9))return document.body.focus()},t}(),e.exports=s},{"../lib/dom":17,"../lib/range":20,"./leaf":11,"./normalizer":13,lodash:1}],15:[function(t,e,n){t("./modules/authorship"),t("./modules/image-tooltip"),t("./modules/keyboard"),t("./modules/link-tooltip"),t("./modules/multi-cursor"),t("./modules/paste-manager"),t("./modules/toolbar"),t("./modules/tooltip"),t("./modules/undo-manager"),e.exports=t("./quill")},{"./modules/authorship":21,"./modules/image-tooltip":22,"./modules/keyboard":23,"./modules/link-tooltip":24,"./modules/multi-cursor":25,"./modules/paste-manager":26,"./modules/toolbar":27,"./modules/tooltip":28,"./modules/undo-manager":29,"./quill":30}],16:[function(t,e,n){var i,r,o,s=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=t("./dom"),r=t("./picker"),i=function(t){function e(){e.__super__.constructor.apply(this,arguments),o(this.container).addClass("ql-color-picker")}return s(e,t),e.prototype.buildItem=function(t,n,i){var r;return r=e.__super__.buildItem.call(this,t,n,i),r.style.backgroundColor=n.value,r},e}(r),e.exports=i},{"./dom":17,"./picker":19}],17:[function(t,e,n){var i,r,o,s,a,l=function(t,e){return function(){return t.apply(e,arguments)}},u=function(t,e){function n(){this.constructor=t}for(var i in e)c.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("lodash"),a=null,r=function(){function t(t){this.node=t,this.trigger=l(this.trigger,this)}return t.prototype.addClass=function(t){return this.hasClass(t)?void 0:(null!=this.node.classList?this.node.classList.add(t):null!=this.node.className&&(this.node.className=(this.node.className+" "+t).trim()),this)},t.prototype.attributes=function(t){var e,n,i,r,s,a;if(t)return o.each(t,function(t){return function(e,n){return t.node.setAttribute(n,e)}}(this)),this;if(null==this.node.attributes)return{};for(t={},s=this.node.attributes,n=i=0,r=s.length;r>i;n=++i)a=s[n],e=this.node.attributes[n],t[e.name]=e.value;return t},t.prototype.child=function(t){var e,n;for(e=this.node.firstChild,n=s(e).length();null!=e&&!(n>t);)t-=n,e=e.nextSibling,n=s(e).length();return null==e&&(e=this.node.lastChild,t=s(e).length()),[e,t]},t.prototype.childNodes=function(){return o.map(this.node.childNodes)},t.prototype.classes=function(){return this.node.className.split(/\s+/)},t.prototype.data=function(t,e){var n;return null!=e?(null==this.node["ql-data"]&&(this.node["ql-data"]={}),this.node["ql-data"][t]=e,this):null!=(n=this.node["ql-data"])?n[t]:void 0},t.prototype.descendants=function(){return o.map(this.node.getElementsByTagName("*"))},t.prototype.get=function(){return this.node},t.prototype.hasClass=function(t){return null!=this.node.classList?this.node.classList.contains(t):null!=this.node.className?this.classes().indexOf(t)>-1:!1},t.prototype.isAncestor=function(t,e){var n;if(null==e&&(e=!1),t===this.node)return e;for(n=this.node;n;){if(n===t)return!0;n=n.parentNode}return!1},t.prototype.isElement=function(){var t;return(null!=(t=this.node)?t.nodeType:void 0)===s.ELEMENT_NODE},t.prototype.isTextNode=function(){var t;return(null!=(t=this.node)?t.nodeType:void 0)===s.TEXT_NODE},t.prototype.isolate=function(t){return null!=this.node.nextSibling&&s(this.node.nextSibling).splitBefore(t),this.splitBefore(t),this},t.prototype.length=function(){var t;return null==this.node?0:(t=this.text().length,this.isElement()&&(t+=this.node.querySelectorAll(Object.keys(s.EMBED_TAGS).join(",")).length),t)},t.prototype.merge=function(t){var e;return e=s(t),this.isElement()?(e.moveChildren(this.node),this.normalize()):this.text(this.text()+e.text()),e.remove(),this},t.prototype.moveChildren=function(t){return o.each(this.childNodes(),function(e){return t.appendChild(e)}),this},t.prototype.nextLineNode=function(t){var e;return e=this.node.nextSibling,null==e&&this.node.parentNode!==t&&(e=this.node.parentNode.nextSibling),null!=e&&null!=s.LIST_TAGS[e.tagName]&&(e=e.firstChild),e},t.prototype.normalize=function(){var t,e,n,i;for(e=this.node.firstChild;null!=e;)i=e.nextSibling,t=s(e),null!=i&&s(i).isTextNode()&&(0===t.text().length?t.remove():t.isTextNode()&&(n=i.nextSibling,t.merge(i),i=n)),e=i;return this},t.prototype.on=function(t,e){return this.node.addEventListener(t,function(n){return function(i){var r,o;return r=!a||"keydown"!==t&&"keyup"!==t?i:a,o=e.call(n.node,r),o||(i.preventDefault(),i.stopPropagation()),o}}(this)),this},t.prototype.remove=function(){var t;return null!=(t=this.node.parentNode)&&t.removeChild(this.node),this.node=null,null},t.prototype.removeClass=function(t){var e;if(this.hasClass(t))return null!=this.node.classList?this.node.classList.remove(t):null!=this.node.className&&(e=this.classes(),e.splice(e.indexOf(t),1),this.node.className=e.join(" ")),this.node.getAttribute("class")||this.node.removeAttribute("class"),this},t.prototype.replace=function(t){return this.node.parentNode.replaceChild(t,this.node),this.node=t,this},t.prototype.splitBefore=function(t,e){var n,i,r,o;if(null==e&&(e=!1),this.node===t||this.node.parentNode===t)return this;if(null!=this.node.previousSibling||e){for(r=this.node.parentNode,i=r.cloneNode(!1),r.parentNode.insertBefore(i,r.nextSibling),o=this.node;null!=o;)n=o.nextSibling,i.appendChild(o),o=n;return s(i).splitBefore(t)}return s(this.node.parentNode).splitBefore(t)},t.prototype.split=function(t,e){var n,i,r,o,a,l,u,c,d,f;if(null==e&&(e=!1),u=this.length(),t=Math.max(0,t),t=Math.min(t,u),!e&&0===t)return[this.node.previousSibling,this.node,!1];if(!e&&t===u)return[this.node,this.node.nextSibling,!1];if(this.node.nodeType===s.TEXT_NODE)return n=this.node.splitText(t),[this.node,n,!0];for(a=this.node,f=this.node.cloneNode(!1),this.node.parentNode.insertBefore(f,a.nextSibling),c=this.child(t),i=c[0],t=c[1],d=s(i).split(t),r=d[0],o=d[1];null!==o;)l=o.nextSibling,f.appendChild(o),o=l;return[a,f,!0]},t.prototype.styles=function(t,e){var n,i;return null==e&&(e=!1),t?(e||(t=o.defaults(t,this.styles())),i=o.map(t,function(t,e){return e+": "+t}).join("; ")+";",this.node.setAttribute("style",i),this):(i=this.node.getAttribute("style")||"",n=o.reduce(i.split(";"),function(t,e){var n,i,r;return i=e.split(":"),n=i[0],r=i[1],n&&r&&(n=n.trim(),r=r.trim(),t[n.toLowerCase()]=r),t},{}))},t.prototype.switchTag=function(t){var e,n;return t=t.toUpperCase(),this.node.tagName===t?this:(n=document.createElement(t),e=this.attributes(),null==s.VOID_TAGS[t]&&this.moveChildren(n),this.replace(n),this.node=n,this.attributes(e))},t.prototype.text=function(t){if(null!=t){switch(this.node.nodeType){case s.ELEMENT_NODE:this.node.textContent=t;break;case s.TEXT_NODE:this.node.data=t}return this}switch(this.node.nodeType){case s.ELEMENT_NODE:return this.node.tagName===s.DEFAULT_BREAK_TAG?"":null!=s.EMBED_TAGS[this.node.tagName]?s.EMBED_TEXT:null!=this.node.textContent?this.node.textContent:"";case s.TEXT_NODE:return this.node.data||"";default:return""}},t.prototype.textNodes=function(){var t,e,n;for(n=document.createTreeWalker(this.node,NodeFilter.SHOW_TEXT,null,!1),e=[];t=n.nextNode();)e.push(t);return e},t.prototype.toggleClass=function(t,e){return null==e&&(e=!this.hasClass(t)),e?this.addClass(t):this.removeClass(t),this},t.prototype.trigger=function(t,e){var n,i,r;return null==e&&(e={}),["keypress","keydown","keyup"].indexOf(t)<0?(n=document.createEvent("Event"),n.initEvent(t,e.bubbles,e.cancelable)):(n=document.createEvent("KeyboardEvent"),a=o.clone(e),o.isNumber(e.key)?a.which=e.key:o.isString(e.key)?a.which=e.key.toUpperCase().charCodeAt(0):a.which=0,s.isIE(10)?(r=[],e.altKey&&r.push("Alt"),e.ctrlKey&&r.push("Control"),e.metaKey&&r.push("Meta"),e.shiftKey&&r.push("Shift"),n.initKeyboardEvent(t,e.bubbles,e.cancelable,window,0,0,r.join(" "),null,null)):(i=o.isFunction(n.initKeyboardEvent)?"initKeyboardEvent":"initKeyEvent",n[i](t,e.bubbles,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,0))),this.node.dispatchEvent(n),a=null,this},t.prototype.unwrap=function(){var t,e;return e=this.node.firstChild,t=this.node.nextSibling,o.each(this.childNodes(),function(e){return function(n){return e.node.parentNode.insertBefore(n,t)}}(this)),this.remove(),e},t.prototype.wrap=function(t){var e;for(null!=this.node.parentNode&&this.node.parentNode.insertBefore(t,this.node),e=t;null!=e.firstChild;)e=t.firstChild;return e.appendChild(this.node),this},t}(),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype["default"]=function(){return this.node.querySelector("option[selected]")},e.prototype.option=function(t,e){var n,i,r,s,a,l;if(null==e&&(e=!0),l=o.isElement(t)?t.value:t){for(l=l.replace(/[^\w]+/g,""),a=this.node.children,i=r=0,s=a.length;s>r;i=++r)if(n=a[i],n.value.replace(/[^\w]+/g,"")===l){this.node.selectedIndex=i;break}}else this.node.selectedIndex=-1;return e&&this.trigger("change"),this},e.prototype.reset=function(t){var e;return null==t&&(t=!0),e=this["default"](),null!=e?e.selected=!0:this.node.selectedIndex=0,t&&this.trigger("change"),this},e.prototype.value=function(){return this.node.selectedIndex>-1?this.node.options[this.node.selectedIndex].value:""},e}(r),s=function(t){return"SELECT"===(null!=t?t.tagName:void 0)?new i(t):new r(t)},s=o.extend(s,{ELEMENT_NODE:1,NOBREAK_SPACE:"&nbsp;",TEXT_NODE:3,ZERO_WIDTH_NOBREAK_SPACE:"\ufeff",DEFAULT_BLOCK_TAG:"DIV",DEFAULT_BREAK_TAG:"BR",DEFAULT_INLINE_TAG:"SPAN",EMBED_TEXT:"!",FONT_SIZES:{"10px":1,"13px":2,"16px":3,"18px":4,"24px":5,"32px":6,"48px":7},KEYS:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},BLOCK_TAGS:{ADDRESS:"ADDRESS",ARTICLE:"ARTICLE",ASIDE:"ASIDE",AUDIO:"AUDIO",BLOCKQUOTE:"BLOCKQUOTE",CANVAS:"CANVAS",DD:"DD",DIV:"DIV",DL:"DL",FIGCAPTION:"FIGCAPTION",FIGURE:"FIGURE",FOOTER:"FOOTER",FORM:"FORM",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6",HEADER:"HEADER",HGROUP:"HGROUP",LI:"LI",OL:"OL",OUTPUT:"OUTPUT",P:"P",PRE:"PRE",SECTION:"SECTION",TABLE:"TABLE",TBODY:"TBODY",TD:"TD",TFOOT:"TFOOT",TH:"TH",THEAD:"THEAD",TR:"TR",UL:"UL",VIDEO:"VIDEO"},EMBED_TAGS:{IMG:"IMG"},LINE_TAGS:{DIV:"DIV",LI:"LI"},LIST_TAGS:{OL:"OL",UL:"UL"},VOID_TAGS:{AREA:"AREA",BASE:"BASE",BR:"BR",COL:"COL",COMMAND:"COMMAND",EMBED:"EMBED",HR:"HR",IMG:"IMG",INPUT:"INPUT",KEYGEN:"KEYGEN",LINK:"LINK",META:"META",PARAM:"PARAM",SOURCE:"SOURCE",TRACK:"TRACK",WBR:"WBR"},convertFontSize:function(t){var e,n,i,r;o.isString(t)&&t.indexOf("px")>-1?(i=Object.keys(s.FONT_SIZES),r=o.values(s.FONT_SIZES)):(r=Object.keys(s.FONT_SIZES),i=o.values(s.FONT_SIZES));for(e in i)if(n=i[e],parseInt(t)<=parseInt(n))return r[e];return o.last(r)},isIE:function(t){var e;return e=document.documentMode,e&&t>=e},isIOS:function(){return/iPhone|iPad/i.test(navigator.userAgent)},isMac:function(){return/Mac/i.test(navigator.platform)}}),e.exports=s},{lodash:1}],18:[function(t,e,n){var i,r;r=function(){function t(t){this.data=t,this.prev=this.next=null}return t}(),i=function(){function t(){this.length=0,this.first=this.last=null}return t.Node=r,t.prototype.append=function(t){return null!=this.first?(t.next=null,this.last.next=t):this.first=t,t.prev=this.last,this.last=t,this.length+=1},t.prototype.insertAfter=function(t,e){return e.prev=t,null!=t?(e.next=t.next,null!=t.next&&(t.next.prev=e),t.next=e,t===this.last&&(this.last=e)):(e.next=this.first,this.first.prev=e,this.first=e),this.length+=1},t.prototype.remove=function(t){return this.length>1?(null!=t.prev&&(t.prev.next=t.next),null!=t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)):this.first=this.last=null,t.prev=t.next=null,this.length-=1},t.prototype.toArray=function(){var t,e;for(t=[],e=this.first;null!=e;)t.push(e),e=e.next;return t},t}(),e.exports=i},{}],19:[function(t,e,n){var i,r,o;r=t("lodash"),o=t("./dom"),i=function(){function t(t){this.select=t,this.container=document.createElement("span"),this.buildPicker(),o(this.container).addClass("ql-picker"),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),o(document).on("click",function(t){return function(){return t.close(),!0}}(this)),o(this.label).on("click",function(t){return function(){return r.defer(function(){return o(t.container).toggleClass("ql-expanded")}),!1}}(this)),o(this.select).on("change",function(t){return function(){var e,n;return t.select.selectedIndex>-1&&(e=t.container.querySelectorAll(".ql-picker-item")[t.select.selectedIndex],n=t.select.options[t.select.selectedIndex]),t.selectItem(e,!1),o(t.label).toggleClass("ql-active",n!==o(t.select)["default"]())}}(this))}return t.TEMPLATE='<span class="ql-picker-label"></span><span class="ql-picker-options"></span>',t.prototype.buildItem=function(t,e,n){var i;return i=document.createElement("span"),i.setAttribute("data-value",e.getAttribute("value")),o(i).addClass("ql-picker-item").text(o(e).text()).on("click",function(t){return function(){return t.selectItem(i,!0),t.close()}}(this)),this.select.selectedIndex===n&&this.selectItem(i,!1),i},t.prototype.buildPicker=function(){var e;return r.each(o(this.select).attributes(),function(t){return function(e,n){return t.container.setAttribute(n,e)}}(this)),this.container.innerHTML=t.TEMPLATE,this.label=this.container.querySelector(".ql-picker-label"),e=this.container.querySelector(".ql-picker-options"),r.each(this.select.options,function(t){return function(n,i){var r;return r=t.buildItem(e,n,i),e.appendChild(r)}}(this))},t.prototype.close=function(){return o(this.container).removeClass("ql-expanded")},t.prototype.selectItem=function(t,e){var n,i;return n=this.container.querySelector(".ql-selected"),null!=n&&o(n).removeClass("ql-selected"),null!=t?(i=t.getAttribute("data-value"),o(t).addClass("ql-selected"),o(this.label).text(o(t).text()),o(this.select).option(i,e),this.label.setAttribute("data-value",i)):(this.label.innerHTML="&nbsp;",this.label.removeAttribute("data-value"))},t}(),e.exports=i},{"./dom":17,lodash:1}],20:[function(t,e,n){var i,r;r=t("lodash"),i=function(){function t(t,e){this.start=t,this.end=e}return t.compare=function(t,e){return t===e?!0:null==t||null==e?!1:t.equals(e)},t.prototype.equals=function(t){return null==t?!1:this.start===t.start&&this.end===t.end},t.prototype.shift=function(t,e){var n;return n=r.map([this.start,this.end],function(n){return t>n?n:e>=0?n+e:Math.max(t,n+e)}),this.start=n[0],this.end=n[1],n},t.prototype.isCollapsed=function(){return this.start===this.end},t}(),e.exports=i},{lodash:1}],21:[function(t,e,n){var i,r,o,s,a;o=t("../quill"),s=o.require("lodash"),a=o.require("dom"),r=o.require("delta"),i=function(){function t(t,e){this.quill=t,this.options=e,null!=this.options.button&&this.attachButton(this.options.button),this.options.enabled&&this.enable(),this.quill.addFormat("author",{"class":"author-"}),null!=this.options.authorId&&(this.quill.on(this.quill.constructor.events.PRE_EVENT,function(t){return function(e,n,i){var a,l;return e===t.quill.constructor.events.TEXT_CHANGE&&"user"===i?(a=new r,l={author:t.options.authorId},s.each(n.ops,function(e){return null==e["delete"]?null!=e.insert||null!=e.retain&&null!=e.attributes?(e.attributes||(e.attributes={}),e.attributes.author=t.options.authorId,a.retain(e.retain||e.insert.length||1,l)):a.retain(e.retain):void 0}),t.quill.updateContents(a,o.sources.SILENT)):void 0}}(this)),this.addAuthor(this.options.authorId,this.options.color))}return t.DEFAULTS={authorId:null,color:"transparent",enabled:!1},t.prototype.addAuthor=function(t,e){var n;return n={},n[".authorship .author-"+t]={"background-color":""+e},this.quill.theme.addStyles(n)},t.prototype.attachButton=function(t){var e;return e=a(t),e.on("click",function(t){return function(){return e.toggleClass("ql-on"),t.enable($dom.hasClass("ql-on"))}}(this))},t.prototype.enable=function(t){return null==t&&(t=!0),a(this.quill.root).toggleClass("authorship",t)},t.prototype.disable=function(){return this.enable(!1)},t}(),o.registerModule("authorship",i),e.exports=i},{"../quill":30}],22:[function(t,e,n){var i,r,o,s,a,l,u,c=function(t,e){function n(){this.constructor=t}for(var i in e)d.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;o=t("../quill"),a=t("./tooltip"),l=o.require("lodash"),u=o.require("dom"),i=o.require("delta"),s=o.require("range"),r=function(t){function e(t,n){this.quill=t,this.options=n,this.options=l.defaults(this.options,a.DEFAULTS),e.__super__.constructor.call(this,this.quill,this.options),this.preview=this.container.querySelector(".preview"),this.textbox=this.container.querySelector(".input"),u(this.container).addClass("ql-image-tooltip"),this.initListeners()}return c(e,t),e.DEFAULTS={template:'<input class="input" type="textbox"> <div class="preview"> <span>Preview</span> </div> <a href="javascript:;" class="cancel">Cancel</a> <a href="javascript:;" class="insert">Insert</a>'},e.prototype.initListeners=function(){return u(this.quill.root).on("focus",l.bind(this.hide,this)),u(this.container.querySelector(".insert")).on("click",l.bind(this.insertImage,this)),u(this.container.querySelector(".cancel")).on("click",l.bind(this.hide,this)),u(this.textbox).on("input",l.bind(this._preview,this)),this.initTextbox(this.textbox,this.insertImage,this.hide),this.quill.onModuleLoad("toolbar",function(t){return function(e){return t.toolbar=e,e.initFormat("image",l.bind(t._onToolbar,t))}}(this))},e.prototype.insertImage=function(){var t,e;return e=this._normalizeURL(this.textbox.value),null==this.range&&(this.range=new s(0,0)),this.range&&(this.preview.innerHTML="<span>Preview</span>",this.textbox.value="",t=this.range.end,this.quill.insertEmbed(t,"image",e,"user"),this.quill.setSelection(t+1,t+1)),this.hide()},e.prototype._onToolbar=function(t,e){return e?(this.textbox.value||(this.textbox.value="http://"),this.show(),this.textbox.focus(),l.defer(function(t){return function(){return t.textbox.setSelectionRange(t.textbox.value.length,t.textbox.value.length)}}(this))):(this.quill.deleteText(t,"user"),this.toolbar.setActive("image",!1))},e.prototype._preview=function(){var t;if(this._matchImageURL(this.textbox.value))return"IMG"===this.preview.firstChild.tagName?this.preview.firstChild.setAttribute("src",this.textbox.value):(t=document.createElement("img"),t.setAttribute("src",this.textbox.value),this.preview.replaceChild(t,this.preview.firstChild))},e.prototype._matchImageURL=function(t){return/^https?:\/\/.+\.(jpe?g|gif|png)$/.test(t)},e.prototype._normalizeURL=function(t){return/^https?:\/\//.test(t)||(t="http://"+t),t},e}(a),o.registerModule("image-tooltip",r),e.exports=r},{"../quill":30,"./tooltip":28}],23:[function(t,e,n){var i,r,o,s,a;o=t("../quill"),s=o.require("lodash"),a=o.require("dom"),i=o.require("delta"),r=function(){function t(t,e){this.quill=t,this.hotkeys={},this._initListeners(),this._initHotkeys(),this.quill.onModuleLoad("toolbar",function(t){return function(e){return t.toolbar=e}}(this))}return t.hotkeys={BOLD:{key:"B",metaKey:!0},INDENT:{key:a.KEYS.TAB},ITALIC:{key:"I",metaKey:!0},OUTDENT:{key:a.KEYS.TAB,shiftKey:!0},UNDERLINE:{key:"U",metaKey:!0}},t.prototype.addHotkey=function(t,e){return Array.isArray(t)||(t=[t]),s.each(t,function(t){return function(n){var i,r;return n=s.isObject(n)?s.clone(n):{key:n},n.callback=e,r=s.isNumber(n.key)?n.key:n.key.toUpperCase().charCodeAt(0),null==(i=t.hotkeys)[r]&&(i[r]=[]),t.hotkeys[r].push(n)}}(this))},t.prototype.toggleFormat=function(t,e){var n,i;return n=t.isCollapsed()?this.quill.getContents(Math.max(0,t.start-1),t.end):this.quill.getContents(t),i=0===n.ops.length||!s.all(n.ops,function(t){var n;return null!=(n=t.attributes)?n[e]:void 0}),t.isCollapsed()?this.quill.prepareFormat(e,i,o.sources.USER):this.quill.formatText(t,e,i,o.sources.USER),null!=this.toolbar?this.toolbar.setActive(e,i):void 0},t.prototype._initEnter=function(){var t;return t=[{key:a.KEYS.ENTER},{key:a.KEYS.ENTER,shiftKey:!0}],this.addHotkey(t,function(t){return function(e,n){var r,a,l,u,c,d;return null==e?!0:(c=t.quill.editor.doc.findLineAt(e.start),l=c[0],u=c[1],d=l.findLeafAt(u),a=d[0],u=d[1],r=(new i).retain(e.start).insert("\n",l.formats)["delete"](e.end-e.start),t.quill.updateContents(r,o.sources.USER),s.each(a.formats,function(e,n){t.quill.prepareFormat(n,e),null!=t.toolbar&&t.toolbar.setActive(n,e)}),!1)}}(this))},t.prototype._initDeletes=function(){return this.addHotkey([a.KEYS.DELETE,a.KEYS.BACKSPACE],function(t){return function(e,n){var i,r,s,l;return null!=e&&t.quill.getLength()>0&&(e.start!==e.end?t.quill.deleteText(e.start,e.end,o.sources.USER):n.key===a.KEYS.BACKSPACE?(l=t.quill.editor.doc.findLineAt(e.start),r=l[0],s=l[1],0===s&&(r.formats.bullet||r.formats.list)?(i=r.formats.bullet?"bullet":"list",t.quill.formatLine(e.start,e.start,i,!1)):e.start>0&&t.quill.deleteText(e.start-1,e.start,o.sources.USER)):e.start<t.quill.getLength()-1&&t.quill.deleteText(e.start,e.start+1,o.sources.USER)),!1}}(this))},t.prototype._initHotkeys=function(){return this.addHotkey(t.hotkeys.INDENT,function(t){return function(e){return t._onTab(e,!1),!1}}(this)),this.addHotkey(t.hotkeys.OUTDENT,function(t){return function(t){return!1}}(this)),s.each(["bold","italic","underline"],function(e){return function(n){return e.addHotkey(t.hotkeys[n.toUpperCase()],function(t){return e.toggleFormat(t,n),!1})}}(this)),this._initDeletes(),this._initEnter()},t.prototype._initListeners=function(){return a(this.quill.root).on("keydown",function(t){return function(e){var n;return n=!1,s.each(t.hotkeys[e.which],function(i){var r;return r=a.isMac()?e.metaKey:e.metaKey||e.ctrlKey,!!i.metaKey==!!r&&!!i.shiftKey==!!e.shiftKey&&!!i.altKey==!!e.altKey?(n=i.callback(t.quill.getSelection(),i,e)===!1||n,!0):void 0}),!n}}(this))},t.prototype._onTab=function(t,e){var n;return null==e&&(e=!1),n=(new i).retain(t.start).insert("	")["delete"](t.end-t.start).retain(this.quill.getLength()-t.end),this.quill.updateContents(n,o.sources.USER),this.quill.setSelection(t.start+1,t.start+1)},t}(),o.registerModule("keyboard",r),e.exports=r},{"../quill":30}],24:[function(t,e,n){var i,r,o,s,a,l=function(t,e){function n(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;r=t("../quill"),o=t("./tooltip"),s=r.require("lodash"),a=r.require("dom"),i=function(t){function e(t,n){this.quill=t,this.options=n,this.options=s.defaults(this.options,o.DEFAULTS),e.__super__.constructor.call(this,this.quill,this.options),a(this.container).addClass("ql-link-tooltip"),this.textbox=this.container.querySelector(".input"),this.link=this.container.querySelector(".url"),this.initListeners()}return l(e,t),e.DEFAULTS={maxLength:50,template:'<span class="title">Visit URL:&nbsp;</span> <a href="#" class="url" target="_blank" href="about:blank"></a> <input class="input" type="text"> <span>&nbsp;&#45;&nbsp;</span> <a href="javascript:;" class="change">Change</a> <a href="javascript:;" class="remove">Remove</a> <a href="javascript:;" class="done">Done</a>'},e.hotkeys={LINK:{key:"K",metaKey:!0}},e.prototype.initListeners=function(){return this.quill.on(this.quill.constructor.events.SELECTION_CHANGE,function(t){return function(e){var n;if(null!=e&&e.isCollapsed())return n=t._findAnchor(e),n?(t.setMode(n.href,!1),t.show(n)):t.container.style.left!==o.HIDE_MARGIN?(t.range=null,t.hide()):void 0}}(this)),a(this.container.querySelector(".done")).on("click",s.bind(this.saveLink,this)),a(this.container.querySelector(".remove")).on("click",function(t){return function(){return t.removeLink(t.range)}}(this)),a(this.container.querySelector(".change")).on("click",function(t){return function(){return t.setMode(t.link.href,!0)}}(this)),this.initTextbox(this.textbox,this.saveLink,this.hide),this.quill.onModuleLoad("toolbar",function(t){return function(e){return t.toolbar=e,e.initFormat("link",s.bind(t._onToolbar,t))}}(this)),this.quill.onModuleLoad("keyboard",function(t){return function(n){return n.addHotkey(e.hotkeys.LINK,s.bind(t._onKeyboard,t))}}(this))},e.prototype.saveLink=function(){var t,e,n;return n=this._normalizeURL(this.textbox.value),null!=this.range&&(e=this.range.end,this.range.isCollapsed()?(t=this._findAnchor(this.range),null!=t&&(t.href=n)):this.quill.formatText(this.range,"link",n,"user"),this.quill.setSelection(e,e)),this.setMode(n,!1)},e.prototype.removeLink=function(t){return t.isCollapsed()&&(t=this._expandRange(t)),this.hide(),this.quill.formatText(t,"link",!1,"user"),null!=this.toolbar?this.toolbar.setActive("link",!1):void 0},e.prototype.setMode=function(t,e){var n;return null==e&&(e=!1),e?(this.textbox.value=t,s.defer(function(e){return function(){return e.textbox.focus(),e.textbox.setSelectionRange(0,t.length)}}(this))):(this.link.href=t,t=this.link.href,n=t.length>this.options.maxLength?t.slice(0,this.options.maxLength)+"...":t,a(this.link).text(n)),a(this.container).toggleClass("editing",e)},e.prototype._findAnchor=function(t){var e,n,i,r;for(r=this.quill.editor.doc.findLeafAt(t.start,!0),e=r[0],i=r[1],null!=e&&(n=e.node);null!=n&&n!==this.quill.root;){if("A"===n.tagName)return n;n=n.parentNode}return null},e.prototype._expandRange=function(t){var e,n,i,r,o;return r=this.quill.editor.doc.findLeafAt(t.start,!0),n=r[0],i=r[1],o=t.start-i,e=o+n.length,{start:o,end:e}},e.prototype._onToolbar=function(t,e){return this._toggle(t,e)},e.prototype._onKeyboard=function(){var t;return t=this.quill.getSelection(),this._toggle(t,!this._findAnchor(t))},e.prototype._toggle=function(t,e){var n;if(t)return e?t.isCollapsed()?void 0:(this.setMode(this._suggestURL(t),!0),n=this.quill.editor.selection._getNativeRange(),this.show(n)):this.removeLink(t)},e.prototype._normalizeURL=function(t){return/^(https?:\/\/|mailto:)/.test(t)||(t="http://"+t),t},e.prototype._suggestURL=function(t){var e;return e=this.quill.getText(t),this._normalizeURL(e)},e}(o),r.registerModule("link-tooltip",i),e.exports=i},{"../quill":30,"./tooltip":28}],25:[function(t,e,n){var i,r,o,s,a,l=function(t,e){function n(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=t("../quill"),i=t("eventemitter2").EventEmitter2,s=o.require("lodash"),a=o.require("dom"),r=function(t){function e(t,e){this.quill=t,this.options=e,this.cursors={},this.container=this.quill.addContainer("ql-multi-cursor",!0),this.quill.on(this.quill.constructor.events.TEXT_CHANGE,s.bind(this._applyDelta,this));
}return l(e,t),e.DEFAULTS={template:'<span class="cursor-flag"> <span class="cursor-name"></span> </span> <span class="cursor-caret"></span>',timeout:2500},e.events={CURSOR_ADDED:"cursor-addded",CURSOR_MOVED:"cursor-moved",CURSOR_REMOVED:"cursor-removed"},e.prototype.clearCursors=function(){return s.each(Object.keys(this.cursors),s.bind(this.removeCursor,this)),this.cursors={}},e.prototype.moveCursor=function(t,e){var n;return n=this.cursors[t],n.index=e,a(n.elem).removeClass("hidden"),clearTimeout(n.timer),n.timer=setTimeout(function(t){return function(){return a(n.elem).addClass("hidden"),n.timer=null}}(this),this.options.timeout),this._updateCursor(n),n},e.prototype.removeCursor=function(t){var n;return n=this.cursors[t],this.emit(e.events.CURSOR_REMOVED,n),null!=n&&n.elem.parentNode.removeChild(n.elem),delete this.cursors[t]},e.prototype.setCursor=function(t,n,i,r){var o;return null==this.cursors[t]&&(this.cursors[t]=o={userId:t,index:n,color:r,elem:this._buildCursor(i,r)},this.emit(e.events.CURSOR_ADDED,o)),s.defer(function(e){return function(){return e.moveCursor(t,n)}}(this)),this.cursors[t]},e.prototype.shiftCursors=function(t,e,n){return null==n&&(n=null),s.each(this.cursors,function(i){return function(i,r){return i&&(i.index>t||i.userId===n)?i.index+=Math.max(e,t-i.index):void 0}}(this))},e.prototype.update=function(){return s.each(this.cursors,function(t){return function(e,n){return null!=e?(t._updateCursor(e),!0):void 0}}(this))},e.prototype._applyDelta=function(t){var e;return e=0,s.each(t.ops,function(t){return function(n){var i,r;return i=0,null!=n.insert?(i=n.insert.length||1,t.shiftCursors(e,i,null!=(r=n.attributes)?r.author:void 0)):null!=n["delete"]?t.shiftCursors(e,-1*n["delete"],null):null!=n.retain&&(t.shiftCursors(e,0,null),i=n.retain),e+=i}}(this)),this.update()},e.prototype._buildCursor=function(t,e){var n,i,r,o;return n=document.createElement("span"),a(n).addClass("cursor"),n.innerHTML=this.options.template,r=n.querySelector(".cursor-flag"),o=n.querySelector(".cursor-name"),a(o).text(t),i=n.querySelector(".cursor-caret"),i.style.backgroundColor=o.style.backgroundColor=e,this.container.appendChild(n),n},e.prototype._updateCursor=function(t){var n,i;return n=this.quill.getBounds(t.index),null==n?this.removeCursor(t.userId):(t.elem.style.top=n.top+this.quill.container.scrollTop+"px",t.elem.style.left=n.left+"px",t.elem.style.height=n.height+"px",i=t.elem.querySelector(".cursor-flag"),a(t.elem).toggleClass("top",parseInt(t.elem.style.top)<=i.offsetHeight).toggleClass("left",parseInt(t.elem.style.left)<=i.offsetWidth).toggleClass("right",this.quill.root.offsetWidth-parseInt(t.elem.style.left)<=i.offsetWidth),this.emit(e.events.CURSOR_MOVED,t))},e}(i),o.registerModule("multi-cursor",r),e.exports=r},{"../quill":30,eventemitter2:2}],26:[function(t,e,n){var i,r,o,s,a,l,u=function(t,e){return function(){return t.apply(e,arguments)}};s=t("../quill"),r=t("../core/document"),a=s.require("lodash"),l=s.require("dom"),i=s.require("delta"),o=function(){function t(e,n){var i;this.quill=e,this._onConvert=u(this._onConvert,this),this.container=this.quill.addContainer("ql-paste-manager"),this.container.setAttribute("contenteditable",!0),l(this.quill.root).on("paste",a.bind(this._paste,this)),this.options=a.defaults(n,t.DEFAULTS),null==(i=this.options).onConvert&&(i.onConvert=this._onConvert)}return t.DEFAULTS={onConvert:null},t.prototype._onConvert=function(t){var e,n,o,s;if(n=new r(t,this.quill.options),e=n.toDelta(),o=e.length(),0===o)return e;var a=new i;for(s=0;s<e.ops.length;++s)if("string"==typeof e.ops[s].insert){var l=e.ops[s].insert.split(" ");if(e.ops[s].attributes&&e.ops[s].attributes.link){a.push(e.ops[s]);continue}for(var u=0;u<l.length;++u){var c=$.extend(!0,{},e.ops[s].attributes),d=!1;/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/im.test(l[u])&&(d=!0,c.link=!0),u<l.length-1?d?(a.insert(l[u],c),a.insert(" ",e.ops[s].attributes)):a.insert(l[u]+" ",e.ops[s].attributes):a.insert(l[u],d?c:e.ops[s].attributes)}}else a.push(e.ops[s]);return a.compose((new i).retain(o-1)["delete"](1))},t.prototype._paste=function(t){var e,n;return e=this.quill.getLength(),n=this.quill.getSelection(),null!=n?(this.container.focus(),a.defer(function(t){return function(){var e,i,r,o,s,a,l;return e=t.options.onConvert(t.container),i=e.length(),i>0&&(n.start>0&&e.ops.unshift({retain:n.start}),e["delete"](n.end-n.start),t.quill.updateContents(e,"user")),t.quill.setSelection(n.start+i,n.start+i),a=t.quill.editor.doc.findLineAt(n.start+i),r=a[0],s=a[1],o=r.node.getBoundingClientRect().bottom,l=document.documentElement.clientHeight,o>l&&r.node.scrollIntoView(!1),t.container.innerHTML=""}}(this))):void 0},t}(),s.registerModule("paste-manager",o),e.exports=o},{"../core/document":8,"../quill":30}],27:[function(t,e,n){var i,r,o,s;i=t("../quill"),o=i.require("lodash"),s=i.require("dom"),r=function(){function t(e,n){if(this.quill=e,this.options=n,(o.isString(this.options)||o.isElement(this.options))&&(this.options={container:this.options}),null==this.options.container)throw new Error("container required for toolbar",this.options);this.container=o.isString(this.options.container)?document.querySelector(this.options.container):this.options.container,this.inputs={},this.preventUpdate=!1,this.triggering=!1,o.each(this.quill.options.formats,function(e){return function(n){return null==t.formats.TOOLTIP[n]?e.initFormat(n,o.bind(e._applyFormat,e,n)):void 0}}(this)),this.quill.on(i.events.FORMAT_INIT,function(e){return function(n){return null==t.formats.TOOLTIP[n]?e.initFormat(n,o.bind(e._applyFormat,e,n)):void 0}}(this)),this.quill.on(i.events.SELECTION_CHANGE,function(t){return function(e){return null!=e?t.updateActive(e):void 0}}(this)),this.quill.on(i.events.TEXT_CHANGE,function(t){return function(){return t.updateActive()}}(this)),this.quill.onModuleLoad("keyboard",function(t){return function(e){return e.addHotkey([s.KEYS.BACKSPACE,s.KEYS.DELETE],function(){return o.defer(o.bind(t.updateActive,t))})}}(this)),s(this.container).addClass("ql-toolbar"),s.isIOS()&&s(this.container).addClass("ios")}return t.DEFAULTS={container:null},t.formats={LINE:{align:"align",bullet:"bullet",list:"list",blockquote:"blockquote",subtitle:"subtitle"},SELECT:{align:"align",background:"background",color:"color",font:"font",size:"size"},TOGGLE:{bold:"bold",bullet:"bullet",image:"image",italic:"italic",link:"link",list:"list",strike:"strike",underline:"underline"},TOOLTIP:{image:"image",link:"link"}},t.prototype.initFormat=function(e,n){var i,r,o;return o=".ql-"+e,null!=t.formats.SELECT[e]?(o="select"+o,i="change"):i="click",r=this.container.querySelector(o),null!=r?(this.inputs[e]=r,s(r).on(i,function(t){return function(){var e,o;return o="change"===i?s(r).value():!s(r).hasClass("ql-active"),t.preventUpdate=!0,t.quill.focus(),e=t.quill.getSelection(),null!=e&&n(e,o),t.preventUpdate=!1,!0}}(this))):void 0},t.prototype.setActive=function(t,e){var n,i,r,o;return"image"===t&&(e=!1),i=this.inputs[t],null!=i?(n=s(i),"SELECT"===i.tagName?(this.triggering=!0,o=n.value(i),null==e&&(e=null!=(r=n["default"]())?r.value:void 0),Array.isArray(e)&&(e=""),e!==o&&(null!=e?n.option(e):n.reset()),this.triggering=!1):n.toggleClass("ql-active",e||!1)):void 0},t.prototype.updateActive=function(t,e){var n;return null==e&&(e=null),t||(t=this.quill.getSelection()),null==t||this.preventUpdate?void 0:(n=this._getActive(t),o.each(this.inputs,function(t){return function(i,r){return(!Array.isArray(e)||e.indexOf(r)>-1)&&t.setActive(r,n[r]),!0}}(this)))},t.prototype._applyFormat=function(e,n,i){return this.triggering?void 0:(n.isCollapsed()?this.quill.prepareFormat(e,i,"user"):null!=t.formats.LINE[e]?this.quill.formatLine(n,e,i,"user"):this.quill.formatText(n,e,i,"user"),o.defer(function(t){return function(){return t.updateActive(n,["bullet","list","subtitle","blockquote"]),t.setActive(e,i)}}(this)))},t.prototype._getActive=function(t){var e,n;return e=this._getLeafActive(t),n=this._getLineActive(t),o.defaults({},e,n)},t.prototype._getLeafActive=function(t){var e,n,i,r,s;return t.isCollapsed()?(s=this.quill.editor.doc.findLineAt(t.start),i=s[0],r=s[1],e=0===r?this.quill.getContents(t.start,t.end+1):this.quill.getContents(t.start-1,t.end)):e=this.quill.getContents(t),n=o.map(e.ops,"attributes"),this._intersectFormats(n)},t.prototype._getLineActive=function(t){var e,n,i,r,s,a;for(n=[],s=this.quill.editor.doc.findLineAt(t.start),e=s[0],r=s[1],a=this.quill.editor.doc.findLineAt(t.end),i=a[0],r=a[1],null!=i&&i===e&&(i=i.next);null!=e&&e!==i;)n.push(o.clone(e.formats)),e=e.next;return this._intersectFormats(n)},t.prototype._intersectFormats=function(e){return o.reduce(e.slice(1),function(e,n){var i,r,s,a,l;return null==n&&(n={}),i=Object.keys(e),s=null!=n?Object.keys(n):{},a=o.intersection(i,s),l=o.difference(i,s),r=o.difference(s,i),o.each(a,function(i){if(null!=t.formats.SELECT[i])if(Array.isArray(e[i])){if(e[i].indexOf(n[i])<0)return e[i].push(n[i])}else if(e[i]!==n[i])return e[i]=[e[i],n[i]]}),o.each(l,function(n){return null!=t.formats.TOGGLE[n]?delete e[n]:null==t.formats.SELECT[n]||Array.isArray(e[n])?void 0:e[n]=[e[n]]}),o.each(r,function(i){return null!=t.formats.SELECT[i]?e[i]=[n[i]]:void 0}),e},e[0]||{})},t}(),i.registerModule("toolbar",r),e.exports=r},{"../quill":30}],28:[function(t,e,n){var i,r,o,s;i=t("../quill"),o=i.require("lodash"),s=i.require("dom"),r=function(){function t(e,n){this.quill=e,this.options=n,this.container=this.quill.addContainer("ql-tooltip"),this.container.innerHTML=this.options.template,this.hide(),this.quill.on(this.quill.constructor.events.TEXT_CHANGE,function(e){return function(n,i){return e.container.style.left!==t.HIDE_MARGIN?(e.range=null,e.hide()):void 0}}(this))}return t.DEFAULTS={offset:10,template:""},t.HIDE_MARGIN="-10000px",t.prototype.initTextbox=function(t,e,n){return s(t).on("keydown",function(t){return function(i){switch(i.which){case s.KEYS.ENTER:return i.preventDefault(),e.call(t);case s.KEYS.ESCAPE:return i.preventDefault(),n.call(t);default:return!0}}}(this))},t.prototype.hide=function(){return this.container.style.left=t.HIDE_MARGIN,this.range&&this.quill.setSelection(this.range),this.range=null},t.prototype.position=function(t){var e,n,i,r,o,s,a;return null!=t?(s=t.getBoundingClientRect(),o=this.quill.container.getBoundingClientRect(),i=s.left-o.left,r=s.top-o.top,n=s.bottom-o.bottom,e=i+s.width/2-this.container.offsetWidth/2,a=r+s.height+this.options.offset,a+this.container.offsetHeight>this.quill.container.offsetHeight&&(a=r-this.container.offsetHeight-this.options.offset),e=Math.max(0,Math.min(e,this.quill.container.offsetWidth-this.container.offsetWidth)),a=Math.max(0,Math.min(a,this.quill.container.offsetHeight-this.container.offsetHeight))):(e=this.quill.container.offsetWidth/2-this.container.offsetWidth/2,a=this.quill.container.offsetHeight/2-this.container.offsetHeight/2),a+=this.quill.container.scrollTop,[e,a]},t.prototype.show=function(t){var e,n,i;return this.range=this.quill.getSelection(),n=this.position(t),e=n[0],i=n[1],this.container.style.left=e+"px",this.container.style.top=i+"px",this.container.focus()},t}(),i.registerModule("tooltip",r),e.exports=r},{"../quill":30}],29:[function(t,e,n){var i,r,o,s;r=t("../quill"),s=r.require("lodash"),i=r.require("delta"),o=function(){function t(t,e){this.quill=t,this.options=null!=e?e:{},this.lastRecorded=0,this.ignoreChange=!1,this.clear(),this.initListeners()}return t.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1},t.hotkeys={UNDO:{key:"Z",metaKey:!0},REDO:{key:"Z",metaKey:!0,shiftKey:!0}},t.prototype.initListeners=function(){return this.quill.onModuleLoad("keyboard",function(e){return function(n){return n.addHotkey(t.hotkeys.UNDO,function(){return e.quill.editor.checkUpdate(),e.undo(),!1}),n.addHotkey(t.hotkeys.REDO,function(){return e.quill.editor.checkUpdate(),e.redo(),!1})}}(this)),this.quill.on(this.quill.constructor.events.TEXT_CHANGE,function(t){return function(e,n){return t.ignoreChange?void 0:(t.options.userOnly&&n!==r.sources.USER?t._transform(e):t.record(e,t.oldDelta),t.oldDelta=t.quill.getContents())}}(this))},t.prototype.clear=function(){return this.stack={undo:[],redo:[]},this.oldDelta=this.quill.getContents()},t.prototype.record=function(t,e){var n,i,r,o;if(t.ops.length>0){this.stack.redo=[];try{if(o=this.quill.getContents().diff(this.oldDelta),r=(new Date).getTime(),this.lastRecorded+this.options.delay>r&&this.stack.undo.length>0?(n=this.stack.undo.pop(),o=o.compose(n.undo),t=n.redo.compose(t)):this.lastRecorded=r,this.stack.undo.push({redo:t,undo:o}),this.stack.undo.length>this.options.maxStack)return this.stack.undo.unshift()}catch(s){return i=s,console.warn("Could not record change... clearing undo stack."),this.clear()}}},t.prototype.redo=function(){return this._change("redo","undo")},t.prototype.undo=function(){return this._change("undo","redo")},t.prototype._getLastChangeIndex=function(t){var e,n;return n=0,e=0,s.each(t.ops,function(t){return null!=t.insert?n=Math.max(e+(t.insert.length||1),n):null!=t["delete"]?n=Math.max(e,n):null!=t.retain?(null!=t.attributes&&(n=Math.max(e+t.retain,n)),e+=t.retain):void 0}),n},t.prototype._change=function(t,e){var n,i;return this.stack[t].length>0?(n=this.stack[t].pop(),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(n[t],r.sources.USER),this.ignoreChange=!1,i=this._getLastChangeIndex(n[t]),this.quill.setSelection(i,i),this.oldDelta=this.quill.getContents(),this.stack[e].push(n)):void 0},t.prototype._transform=function(t){var e,n,i,r,o,s,a,l;for(this.oldDelta=t.transform(this.oldDelta,!0),s=this.stack.undo,n=0,r=s.length;r>n;n++)e=s[n],e.undo=t.transform(e.undo,!0),e.redo=t.transform(e.redo,!0);for(a=this.stack.redo,l=[],i=0,o=a.length;o>i;i++)e=a[i],e.undo=t.transform(e.undo,!0),l.push(e.redo=t.transform(e.redo,!0));return l},t}(),r.registerModule("undo-manager",o),e.exports=o},{"../quill":30}],30:[function(t,e,n){var i,r,o,s,a,l,u,c,d,f,h,p=function(t,e){function n(){this.constructor=t}for(var i in e)m.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},m={}.hasOwnProperty,g=[].slice;d=t("lodash"),h=t("../package.json"),i=t("rich-text/lib/delta"),s=t("eventemitter2").EventEmitter2,f=t("./lib/dom"),r=t("./core/document"),o=t("./core/editor"),a=t("./core/format"),l=t("./core/normalizer"),c=t("./lib/range"),u=function(t){function e(t,n){var i,r,s;if(this.container=t,null==n&&(n={}),d.isString(this.container)&&(this.container=document.querySelector(this.container)),null==this.container)throw new Error("Invalid Quill container");if(r=d.defaults(n.modules||{},e.DEFAULTS.modules),i=this.container.innerHTML,this.container.innerHTML="",this.options=d.defaults(n,e.DEFAULTS),this.options.modules=r,this.options.id=this.id="ql-editor-"+(e.editors.length+1),this.modules={},this.root=this.addContainer("ql-editor"),this.editor=new o(this.root,this,this.options),e.editors.push(this),this.setHTML(i,e.sources.SILENT),s=e.themes[this.options.theme],null==s)throw new Error("Cannot load "+this.options.theme+" theme. Are you sure you registered it?");this.theme=new s(this,this.options),d.each(this.options.modules,function(t){return function(e,n){return t.addModule(n,e)}}(this))}return p(e,t),e.version=h.version,e.editors=[],e.modules=[],e.themes=[],e.DEFAULTS={formats:["align","bold","italic","strike","underline","color","background","font","size","link","image","bullet","list"],modules:{keyboard:!0,"paste-manager":!0,"undo-manager":!0},pollInterval:100,readOnly:!1,styles:{},theme:"base"},e.events={FORMAT_INIT:"format-init",MODULE_INIT:"module-init",POST_EVENT:"post-event",PRE_EVENT:"pre-event",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},e.sources=o.sources,e.registerModule=function(t,n){return null!=e.modules[t]&&console.warn("Overwriting "+t+" module"),e.modules[t]=n},e.registerTheme=function(t,n){return null!=e.themes[t]&&console.warn("Overwriting "+t+" theme"),e.themes[t]=n},e.require=function(t){switch(t){case"lodash":return d;case"delta":return i;case"format":return a;case"normalizer":return l;case"dom":return f;case"document":return r;case"range":return c;default:return null}},e.prototype.destroy=function(){var t;return t=this.getHTML(),d.each(this.modules,function(t,e){return d.isFunction(t.destroy)?t.destroy():void 0}),this.editor.destroy(),this.removeAllListeners(),e.editors.splice(d.indexOf(e.editors,this),1),this.container.innerHTML=t},e.prototype.addContainer=function(t,e){var n,i;return null==e&&(e=!1),i=e?this.root:null,n=document.createElement("div"),f(n).addClass(t),f(n).addClass("article-content"),this.container.insertBefore(n,i),n},e.prototype.addFormat=function(t,n){return this.editor.doc.addFormat(t,n),this.emit(e.events.FORMAT_INIT,t)},e.prototype.addModule=function(t,n){var i;if(i=e.modules[t],null==i)throw new Error("Cannot load "+t+" module. Are you sure you registered it?");return n===!0&&(n={}),n=d.defaults(n,this.theme.constructor.OPTIONS[t]||{},i.DEFAULTS||{}),this.modules[t]=new i(this,n),this.emit(e.events.MODULE_INIT,t,this.modules[t]),this.modules[t]},e.prototype.deleteText=function(t,n,r){var o,s,a;return null==r&&(r=e.sources.API),a=this._buildParams(t,n,{},r),t=a[0],n=a[1],s=a[2],r=a[3],n>t?(o=(new i).retain(t)["delete"](n-t),this.editor.applyDelta(o,r)):void 0},e.prototype.emit=function(){var t,n;return n=arguments[0],t=2<=arguments.length?g.call(arguments,1):[],e.__super__.emit.apply(this,[e.events.PRE_EVENT,n].concat(g.call(t))),e.__super__.emit.apply(this,[n].concat(g.call(t))),e.__super__.emit.apply(this,[e.events.POST_EVENT,n].concat(g.call(t)))},e.prototype.focus=function(){return this.editor.focus()},e.prototype.formatLine=function(t,e,n,i,r){var o,s,a,l,u;return l=this._buildParams(t,e,n,i,r),t=l[0],e=l[1],o=l[2],r=l[3],u=this.editor.doc.findLineAt(e),s=u[0],a=u[1],null!=s&&(e+=s.length-a),this.formatText(t,e,o,r)},e.prototype.formatText=function(t,e,n,r,o){var s,a,l;return l=this._buildParams(t,e,n,r,o),t=l[0],e=l[1],a=l[2],o=l[3],a=d.reduce(a,function(t){return function(e,n,i){var r;return r=t.editor.doc.formats[i],n&&n!==r.config["default"]||(e[i]=null),e}}(this),a),s=(new i).retain(t).retain(e-t,a),this.editor.applyDelta(s,o)},e.prototype.getBounds=function(t){return this.editor.getBounds(t)},e.prototype.getContents=function(t,e){return null==t&&(t=0),null==e&&(e=null),d.isObject(t)&&(e=t.end,t=t.start),this.editor.delta.slice(t,e)},e.prototype.getHTML=function(){return this.editor.doc.getHTML()},e.prototype.getLength=function(){return this.editor.length},e.prototype.getModule=function(t){return this.modules[t]},e.prototype.getSelection=function(){return this.editor.checkUpdate(),this.editor.selection.getRange()},e.prototype.getText=function(t,e){return null==t&&(t=0),null==e&&(e=null),d.map(this.getContents(t,e).ops,function(t){return d.isString(t.insert)?t.insert:""}).join("")},e.prototype.insertEmbed=function(t,e,n,r){var o,s,a,l;return l=this._buildParams(t,0,e,n,r),t=l[0],s=l[1],a=l[2],r=l[3],o=(new i).retain(t).insert(1,a),this.editor.applyDelta(o,r)},e.prototype.insertText=function(t,e,n,r,o){var s,a,l,u;return u=this._buildParams(t,0,n,r,o),t=u[0],a=u[1],l=u[2],o=u[3],e.length>0?(s=(new i).retain(t).insert(e,l),this.editor.applyDelta(s,o)):void 0},e.prototype.onModuleLoad=function(t,n){return this.modules[t]?n(this.modules[t]):this.on(e.events.MODULE_INIT,function(e,i){return e===t?n(i):void 0})},e.prototype.prepareFormat=function(t,n,i){var r,o;return null==i&&(i=e.sources.API),r=this.editor.doc.formats[t],null!=r&&(o=this.getSelection(),null!=o?o.isCollapsed():void 0)?r.isType(a.types.LINE)?this.formatLine(o,t,n,i):r.prepare(n):void 0},e.prototype.setContents=function(t,n){var r;return null==n&&(n=e.sources.API),t=new i(Array.isArray(t)?t.slice():t.ops.slice()),r=d.last(t.slice(t.length()-1).ops),t["delete"](this.getLength()-1),null!=r&&d.isString(r.insert)&&"\n"===d.last(r.insert)&&t["delete"](1),this.updateContents(t,n)},e.prototype.setHTML=function(t,n){return null==n&&(n=e.sources.API),t.trim()||(t="<"+f.DEFAULT_BLOCK_TAG+"><"+f.DEFAULT_BREAK_TAG+"></"+f.DEFAULT_BLOCK_TAG+">"),this.editor.doc.setHTML(t),this.editor.checkUpdate(n)},e.prototype.setSelection=function(t,n,i){var r;return null==i&&(i=e.sources.API),d.isNumber(t)&&d.isNumber(n)?r=new c(t,n):(r=t,i=n||i),this.editor.selection.setRange(r,i)},e.prototype.setText=function(t,n){var r;return null==n&&(n=e.sources.API),r=(new i).insert(t),this.setContents(r,n)},e.prototype.updateContents=function(t,n){return null==n&&(n=e.sources.API),Array.isArray(t)&&(t={ops:t}),this.editor.applyDelta(t,n)},e.prototype._buildParams=function(){var t,n;return n=1<=arguments.length?g.call(arguments,0):[],d.isObject(n[0])&&n.splice(0,1,n[0].start,n[0].end),d.isString(n[2])&&(t={},t[n[2]]=n[3],n.splice(2,2,t)),null==n[3]&&(n[3]=e.sources.API),n},e}(s),u.registerTheme("base",t("./themes/base")),u.registerTheme("snow",t("./themes/snow")),e.exports=u},{"../package.json":7,"./core/document":8,"./core/editor":9,"./core/format":10,"./core/normalizer":13,"./lib/dom":17,"./lib/range":20,"./themes/base":32,"./themes/snow":33,eventemitter2:2,lodash:1,"rich-text/lib/delta":3}],31:[function(t,e,n){e.exports=""},{}],32:[function(t,e,n){var i,r,o,s;r=t("lodash"),s=t("../../lib/dom"),o=t("./base.styl"),i=function(){function t(e,n){var i;this.quill=e,this.options=n,s(this.quill.container).addClass("ql-container"),this.options.styles&&this.addStyles(o+t.objToCss(this.options.styles)),s.isIE(10)&&(i=s.isIE(9)?"9":"10",s(this.quill.root).addClass("ql-ie-"+i))}return t.OPTIONS={},t.objToCss=function(t){return r.map(t,function(t,e){var n;return n=r.map(t,function(t,e){return e+": "+t+";"}).join(" "),e+" { "+n+" }"}).join("\n")},t.prototype.addStyles=function(e){var n;return r.isObject(e)&&(e=t.objToCss(e)),n=document.createElement("style"),n.type="text/css",n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},t}(),e.exports=i},{"../../lib/dom":17,"./base.styl":31,lodash:1}],33:[function(t,e,n){var i,r,o,s,a,l,u=function(t,e){function n(){this.constructor=t}for(var i in e)c.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;a=t("lodash"),r=t("../../lib/color-picker"),i=t("../base"),l=t("../../lib/dom"),o=t("../../lib/picker"),s=function(t){function e(t,n){this.quill=t,this.options=n,e.__super__.constructor.apply(this,arguments),l(this.quill.container).addClass("ql-snow"),this.pickers=[],this.quill.on(this.quill.constructor.events.SELECTION_CHANGE,function(t){return function(e){return null!=e?a.invoke(t.pickers,"close"):void 0}}(this)),this.quill.onModuleLoad("multi-cursor",a.bind(this.extendMultiCursor,this)),this.quill.onModuleLoad("toolbar",a.bind(this.extendToolbar,this))}return u(e,t),e.COLORS=["#000000","#e60000","#ff9900","#ffff00","#008A00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],e.OPTIONS={"multi-cursor":{template:'<span class="cursor-flag"> <span class="cursor-triangle top"></span> <span class="cursor-name"></span> <span class="cursor-triangle bottom"></span> </span> <span class="cursor-caret"></span>'}},e.prototype.extendMultiCursor=function(t){return t.on(t.constructor.events.CURSOR_ADDED,function(t){var e,n;return e=t.elem.querySelector(".cursor-triangle.bottom"),n=t.elem.querySelector(".cursor-triangle.top"),e.style.borderTopColor=n.style.borderBottomColor=t.color})},e.prototype.extendToolbar=function(t){return l(t.container).addClass("ql-snow"),a.each(["color","background","font","size","align"],function(e){return function(n){var i,s;if(s=t.container.querySelector(".ql-"+n),null!=s){switch(n){case"font":case"size":case"align":i=new o(s);break;case"color":case"background":i=new r(s),a.each(i.container.querySelectorAll(".ql-picker-item"),function(t,e){return 7>e?l(t).addClass("ql-primary-color"):void 0})}return null!=i?e.pickers.push(i):void 0}}}(this)),a.each(l(t.container).textNodes(),function(t){return 0===l(t).text().trim().length?l(t).remove():void 0})},e}(i),e.exports=s},{"../../lib/color-picker":16,"../../lib/dom":17,"../../lib/picker":19,"../base":32,lodash:1}]},{},[15])(15)}),function(){Quill.registerModule("click-expand",function(t,e){var n=$(t.container),i=$(t.editor.root);n.dblclick(function(){n.hasClass("ql-auto-expand")?n.removeClass("ql-auto-expand"):(i.css("min-height",n.css("height")),n.addClass("ql-auto-expand"))})})}(),function(){Quill.registerModule("float-toolbar",function(t,e){for(var n=$(t.container),i=$(t.editor.root),r=$(t.modules.toolbar.container),o=r.find(".ql-format-group"),s=r[0];s.offsetParent;)s=s.offsetParent;var a=function(t){t||(t=this);for(var e=t.offsetTop;t=t.offsetParent;)e+=t.offsetTop;return e},l=a(r[0]),u=n.parent();u.css("position","relative"),$(s).scroll(function(){var t=s.scrollTop,e=a(i[0])+i[0].offsetHeight-r[0].offsetHeight;l>t?(r[0].style.position="static",u[0].style.paddingTop=0,o.removeClass("ql-format-group-flying")):(u[0].style.paddingTop=r[0].offsetHeight+"px",r[0].style.width=u[0].offsetWidth+"px",o.addClass("ql-format-group-flying"),e>t?(r[0].style.position="fixed",r[0].style.top=0):(r[0].style.position="absolute",r[0].style.top="calc(100% - "+r[0].offsetHeight+"px)"))})})}(),function(){"use strict";keylolApp.directive("a",function(){return{restrict:"E",link:function(t,e,n){n.$observe("href",function(){var t=e[0];0!==location.host.indexOf(t.hostname)&&(t.target="_blank")})}}})}(),function(){"use strict";keylolApp.directive("bindHtmlCompile",["$compile",function(t){return{restrict:"A",link:function(e,n,i){e.$watch(function(){return e.$eval(i.bindHtmlCompile)},function(r){n.html(r&&r.toString());var o=e;i.bindHtmlScope&&(o=e.$eval(i.bindHtmlScope)),t(n.contents())(o)})}}}])}(),function(){"use strict";keylolApp.directive("captureClick",["$parse",function(t){return{restrict:"A",compile:function(e,n){var i=t(n.captureClick,null,!0);return function(t,e){e[0].addEventListener("click",function(e){t.$apply(function(){i(t,{$event:e})})},!0)}}}}])}(),function(){"use strict";keylolApp.directive("flashingFigure",[function(){return{restrict:"E",templateUrl:"components/directives/flashing-figure.html",scope:{stations:"=",current:"="}}}])}(),function(){"use strict";keylolApp.directive("focusMe",["$parse",function(t){return{link:function(e,n,i){e.$watch(i.focusMe,function(r){r===!0&&(n[0].focus(),t(i.focusMe).assign(e,!1))})}}}])}(),function(){"use strict";keylolApp.directive("inputCode",[function(){return{restrict:"E",templateUrl:"components/directives/input-code.html",scope:{length:"="},require:"ngModel",link:function(t,e,n,i){t.repeats=new Array(t.length),t.text={},t.focus={},t.keydown=function(e,n){8===n.keyCode?(t.text={},t.focus[0]=!0):37===n.keyCode?t.focus[e-1]=!0:39===n.keyCode&&(t.focus[e+1]=!0)},t.focusFirstIfEmpty=function(){for(var e=0;e<t.length;++e)if(t.text[e])return;t.focus[0]=!0},i.$render=function(){for(var e=0;e<t.length;e++)t.text[e]=i.$viewValue[e]};for(var r=0;r<t.length;++r)!function(e){t.$watch("text["+e+"]",function(n,r){for(var o="",s=0;s<t.length;s++)t.text[s]&&(o+=t.text[s][0]);i.$setViewValue(o),n&&(!r||n.length>=r.length)&&(t.focus[e+1]=!0)})}(r)}}}])}(),function(){"use strict";keylolApp.directive("inputPoint",["$window","union","$timeout","$http",function(t,e,n,i){return{restrict:"E",templateUrl:"components/directives/input-point.html",scope:{placeholder:"="},require:"ngModel",link:function(r,o,s,a){a.$render=function(){if(r.pointArray=[],a.$viewValue)for(var t=0;t<a.$viewValue.length;t++)r.pointArray.push(a.$viewValue[t])};var l=function(t){var e=!1;for(var n in r.pointArray)r.pointArray[n].Id===t.Id&&(e=!0);e||r.pointArray.push(t),r.data="",a.$setViewValue(r.pointArray)},u=function(t){r.pointArray.splice(t,1),a.$setViewValue(r.pointArray)},c=function(t){r.$apply(function(){8==t.keyCode&&r.pointArray.length>0&&!r.data&&(r.pointArray.splice(-1,1),a.$setViewValue(r.pointArray))})};r.selectPoint=function(e){r.pointArray[e].selected=!0;var n=function(o){r.$apply(function(){r.pointArray[e].selected=!1,8==o.keyCode&&u(e),t.removeEventListener("click",i,!0),t.removeEventListener("keydown",n,!0),o.stopPropagation(),o.preventDefault()})},i=function(o){r.$apply(function(){r.pointArray[e].selected=!1,t.removeEventListener("click",i,!0),t.removeEventListener("keydown",n,!0)})};t.addEventListener("click",i,!0),t.addEventListener("keydown",n,!0)};var d=o.find(".input");o.click(function(t){t.target===d[0]||$(t.target).is(o.find(".point-title"))||o.children("input").focus()}),d.focus(function(){t.addEventListener("keydown",c,!0),r.disWatchData=r.$watch("data",function(s){r.dataChangeTimeout&&n.cancel(r.dataChangeTimeout),r.dataChangeTimeout=n(function(){r.nowPopup&&r.nowPopup.then(function(t){t.closeNow()}),t.removeEventListener("keydown",e.keydownCallback,!0),s&&i.get(apiEndpoint+"normal-point/keyword/"+encodeURIComponent(s)).then(function(t){var e=t.data;e.length&&(r.nowPopup=r.showSelector({templateUrl:"components/popup/point-selector.html",controller:"PointSelectorController",attachSide:"bottom",event:{type:"click",currentTarget:o},align:"left",offsetX:-8,inputs:{selected:0,pointArray:e}}),r.nowPopup.then(function(t){return t.close}).then(function(t){t&&l(t)}))})},200)})}),d.blur(function(){r.dataChangeTimeout&&n.cancel(r.dataChangeTimeout),t.removeEventListener("keydown",c,!0),r.disWatchData()})}}}])}(),function(){"use strict";keylolApp.directive("pagination",["$location",function(t){return{restrict:"E",templateUrl:"components/directives/pagination.html",scope:{total:"=",current:"=",onPageChanged:"&",pageHref:"&"},link:function(e){e.$watchGroup(["current","total"],function(){if(e.newPage=e.current,e.hasLeftEllipsis=e.current>4,e.hasRightEllipsis=e.total-e.current>4,e.leftPages=[],e.hasLeftEllipsis)e.leftPages.push(e.current-1);else for(var t=1;t<e.current;t++)e.leftPages.push(t);if(e.rightPages=[],e.hasRightEllipsis)e.rightPages.push(e.current+1),e.rightPages.push(e.current+2);else for(var n=e.current+1;n<=e.total;n++)e.rightPages.push(n)}),e.changePage=function(t){t>e.total?e.onPageChanged({oldPage:e.current,newPage:e.total}):1>t?e.onPageChanged({oldPage:e.current,newPage:1}):e.onPageChanged({oldPage:e.current,newPage:t})},e.submit=function(){if(e.newPage!=e.current){var n=e.pageHref(e.newPage);n?t.url(n):e.changePage(parseInt(e.newPage))}}}}}])}(),function(){"use strict";keylolApp.directive("pointLink",[function(){return{restrict:"E",templateUrl:"components/directives/point-link.html",scope:{idCode:"=",pointName:"=",type:"=",avatarUrl:"="},link:function(t,e){t.funcs={},t.linkHover=function(n){if(t.avatarUrl){var i=e.children().children().width();t.cardPopup=t.funcs.showPointCard({templateUrl:"components/popup/point-preview-card.html",controller:"PointPreviewCardController",event:n,attachSide:"bottom",align:"left",offsetX:i/2-37,inputs:{idCode:t.idCode,type:t.type}})}else t.cardPopup=t.funcs.showPointCard({templateUrl:"components/popup/point-preview-card.html",controller:"PointPreviewCardController",event:n,attachSide:"bottom",align:"left",inputs:{idCode:t.idCode,type:t.type}})}}}}])}(),function(){"use strict";keylolApp.directive("popup",["window","$timeout",function(t,e){return{restrict:"A",scope:{showFn:"=popup"},link:function(n,i){var r={},o=[];n.showFn=function(n){var s={attachSide:"top",align:"center",offsetX:0,offsetY:0,showDelay:0,closeDelay:0};if(n&&n.event&&(n.event=$.extend({},n.event),"mouseenter"===n.event.type&&(s.showDelay=350,s.closeDelay=400)),
$.extend(s,n),s.event){var a=o.indexOf(s.event.currentTarget);if(r[a])return void r[a].show(!0)}var l,u,c,d=function(){u?e.cancel(u):c=e(function(){c=null,l.then(function(t){t.closeNow()})},s.closeDelay)},f=function(n){if(c)e.cancel(c);else if(!n){var a,h;return u=e(function(){if(u=null,!$.contains(document,i[0]))return void(s.event&&"mouseenter"===s.event.type&&(delete r[h],$(s.event.currentTarget).off("mouseleave",a)));if(l=t.show({template:s.template,templateUrl:s.templateUrl,controller:s.controller,adjustScrollBar:!1,inputs:s.inputs}),l.then(function(t){var e=t.$element.innerWidth(),n=t.$element.innerHeight();t.$element.hide();var r=i.offset(),o=i.innerWidth(),a=i.innerHeight();if("left"===s.attachSide||"right"===s.attachSide){switch(s.align){case"top":break;case"bottom":r.top=r.top+a-n;break;default:r.top=(2*r.top+a-n)/2}"left"===s.attachSide?r.left-=e:r.left+=o}else{switch(s.align){case"left":break;case"right":r.left=r.left+o-e;break;default:r.left=(2*r.left+o-e)/2}"bottom"===s.attachSide?r.top+=a:r.top-=n}r.left+=s.offsetX,r.top+=s.offsetY,t.$element.css(r),t.$element.show()}),s.event){var e;if("click"===s.event.type)l.then(function(t){return e=function(e){if(e.target===s.event.currentTarget||$.contains(s.event.currentTarget,e.target)){if(s.event.acceptCurrentTarget)return;e.stopPropagation()}e.target===t.$element[0]||$.contains(t.$element[0],e.target)||d()},document.body.addEventListener("click",e,!0),t.close}).then(function(){document.body.removeEventListener("click",e,!0)});else if("mouseenter"===s.event.type){var n=function(){f(!0)},o=function(){d()};l.then(function(t){e=function(e){e.target===t.$element[0]||$.contains(t.$element[0],e.target)||t.closeNow()},document.body.addEventListener("click",e,!0),t.$element.hover(n,o),t.close.then(function(){delete r[h],document.body.removeEventListener("click",e,!0),$(s.event.currentTarget).off("mouseleave",a),t.$element.off("mouseenter",n),t.$element.off("mouseleave",o)})})}}return l},s.showDelay),s.event&&"mouseenter"===s.event.type&&(a=function(){d()},$(s.event.currentTarget).mouseleave(a),h=o.indexOf(s.event.currentTarget),-1===h&&(h=o.push(s.event.currentTarget)-1),r[h]={show:f},u["catch"](function(){delete r[h],$(s.event.currentTarget).off("mouseleave",a)})),u.then(function(t){return t})}};return f()}}}}])}(),function(){"use strict";keylolApp.directive("quill",["upyun","$timeout","$compile",function(t,e,n){return{restrict:"A",require:"ngModel",scope:{content:"=ngModel"},transclude:!0,templateUrl:"components/directives/quill.html",link:function(i,r,o,s){var a={modules:{toolbar:{container:null},"click-expand":!0,"float-toolbar":!0},theme:"snow",formats:["bold","italic","underline","link","image"]};o.quill&&$.extend(a,i.$eval(o.quill));var l=r.find("[quill-toolbar]")[0];l?a.modules.toolbar.container=l:delete a.modules.toolbar;var u=r.find("[quill-content]")[0],c=new Quill(u,a);c.addFormat("blockquote",{tag:"BLOCKQUOTE",type:"line",exclude:"subtitle"}),c.addFormat("subtitle",{tag:"H1",prepare:"heading",type:"line",exclude:"blockquote"}),i.content||s.$setViewValue(c.getHTML()),s.$render=function(){s.$viewValue?(c.setHTML(s.$viewValue),n(r.find(".ql-editor"))(i)):c.setHTML("")},c.on("text-change",function(){s.$setViewValue(c.getHTML())});var d={start:0,end:0};c.on("selection-change",function(t){t&&(d=t)});var f,h=function(t){i.noticeMessage=t,e.cancel(f),f=e(function(){i.noticeMessage=null},3e3)};i.uploadImages=function(e){if(e&&e.length>0){h("图片上传中");var n=d.start,i=t.policy();t.signature(i).then(function(r){for(var o=e.length-1;o>=0;--o)e[o]&&t.upload(e[o],i,r).then(function(t){c.insertEmbed(n,"image","//keylol.b0.upaiyun.com/"+t.data.url+"!article.image")})})}},h("双击文本框扩展/收缩编辑区域")}}}])}(),function(){"use strict";keylolApp.directive("webpBackground",["utils",function(t){return{restrict:"A",priority:98,link:function(e,n,i){i.$observe("webpBackground",function(e){/^(?:http:|https:)?\/\/keylol\.b0\.upaiyun\.com\//i.test(e)?t.supportWebp.then(function(){-1===e.indexOf("!")?n.css("background-image","url("+e+"!webp)"):n.css("background-image","url("+e+".webp)")},function(){n.css("background-image","url("+e+")")}):n.css("background-image","url("+e+")")})}}}])}(),function(){"use strict";keylolApp.directive("webpSrc",["utils",function(t){return{restrict:"A",priority:98,link:function(e,n,i){i.$observe("webpSrc",function(e){/^(?:http:|https:)?\/\/keylol\.b0\.upaiyun\.com\//i.test(e)?t.supportWebp.then(function(){-1===e.indexOf("!")?i.$set("src",e+"!webp"):i.$set("src",e+".webp")},function(){i.$set("src",e)}):i.$set("src",e)})}}}])}(),function(){"use strict";keylolApp.directive("window",["$timeout",function(t){var e;return{restrict:"E",transclude:!0,templateUrl:"components/directives/window.html",scope:{position:"@position"},compile:function(){return{post:function(n,i){e=angular.element(i[0].querySelector(".window-exit-button")),i.on("click",function(n){n.target===i[0]&&(e.hasClass("focused")||(e.addClass("focused"),t(function(){e.removeClass("focused")},900)))})}}}}}])}(),function(){"use strict";keylolApp.filter("avatarUrl",function(){return function(t,e){var n;if(t&&0===t.indexOf("keylol://avatars/")){var i=t.substring(17);switch(e){case"big":n="avatar.big";break;case"small":n="avatar.small";break;default:n="avatar.medium"}return"//keylol.b0.upaiyun.com/"+i+"!"+n}var r;switch(r=t&&0===t.indexOf("steam://avatars/")?t.substring(16):"fef49e7fa7e1997310d705b2a6158ff8dc1cdfeb",e){case"big":n="big";break;case"small":n="small";break;default:n="medium"}return"//keylol-steam-cdn.b0.upaiyun.com/steamcommunity/public/images/avatars/"+r.substring(0,2)+"/"+r+"_full.jpg!"+n}})}(),function(){"use strict";keylolApp.filter("backgroundUrl",function(){return function(t){return t?"//keylol.b0.upaiyun.com/"+t+"!profile.point.background":"//keylol.b0.upaiyun.com/991a9466477b8f5b49dbd034fc93bcd5.jpg!profile.point.background"}})}(),function(){"use strict";keylolApp.filter("maxLength",function(){return function(t,e){var n=t;return n.length>e&&(n=n.slice(0,e-1)+"…"),n}})}(),function(){"use strict";keylolApp.filter("storeUrlToSteamDB",function(){return function(t){var e=t.match(/(?:http:|https:)\/\/store\.steampowered\.com\/app\/(\d+)/i);return e?"https://steamdb.info/app/"+e[1]+"/":void 0}})}(),function(){"use strict";keylolApp.filter("timelineThumbnailUrl",function(){return function(t){var e=t.match(/^(?:http:|https:)?\/\/keylol\.b0\.upaiyun\.com\/(.*?)(?:!.*)?$/i);return e?"//keylol.b0.upaiyun.com/"+e[1]+"!timeline.thumbnail":t}})}(),function(){"use strict";keylolApp.filter("userName",function(){return function(t,e){return e?"@"+t:t}})}(),function(){"use strict";keylolApp.controller("AcknowledgementsController",["pageTitle","$scope","union","$http","notification","utils","$timeout",function(t,e,n,i,r,o,s){function a(t){for(var e=n.timeline.actions,i=0;i<e.length;i++)e[i].active=!1;t.active=!0}function l(t,e){e||(n.timeline.entries.length=0,e=0),i.get(apiEndpoint+"like/my",{params:{type:t,skip:e,take:o.timelineLoadCount}}).then(function(t){n.timeline.noMoreArticle=t.data.length<o.timelineLoadCount;var e;for(var i in t.data){var r=t.data[i],a={isNew:!r.ReadByTargetUser,fromArticle:{id:r.Article.Id,text:r.Article.Title,href:"article/"+r.Article.AuthorIdCode+"/"+r.Article.SequenceNumberForAuthor},datetime:r.Time,author:{username:r.Operator.UserName,avatarUrl:r.Operator.AvatarImage,idCode:r.Operator.IdCode},id:r.Id};r.Comment?(a.commentId=r.Comment.Id,a.types=["评论"],a.fromArticle.fromComment=!0,a.summary="认可你的评论",a.url="article/"+r.Article.AuthorIdCode+"/"+r.Article.SequenceNumberForAuthor+"#"+r.Comment.SequenceNumberForArticle):(a.types=["文章"],a.summary="认可你的文章",a.url="article/"+r.Article.AuthorIdCode+"/"+r.Article.SequenceNumberForAuthor),function(t){e?e=e.then(function(){return n.timeline.entries.push(t),s(function(){},o.timelineInsertDelay)}):(n.timeline.entries.push(t),e=s(function(){},o.timelineInsertDelay))}(a)}e?e.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1},function(t){r.error("未知错误",t),n.timeline.loadingLock=!1})}t.set("认可 - 其乐"),n.summary={actions:[],head:{mainHead:"认可",subHead:"Acknowledgement"},background:"0abeafd8e4c049bce860686bc4c04829.jpg",defaultSum:{text:"文章/评论获得的认可"}},n.timeline={title:{mainTitle:"认可",subTitle:"Acknowledgement"},actions:[{active:!0,text:"全部",onClick:function(){this.active||(a(this),l("All"))}},{active:!1,text:"文章",onClick:function(){this.active||(a(this),l("ArticleLike"))}},{active:!1,text:"评论",onClick:function(){this.active||(a(this),l("CommentLike"))}}],loadAction:function(){n.timeline.loadingLock=!0,n.timeline.actions[0].active?l("All",n.timeline.entries.length):n.timeline.actions[1].active?l("ArticleLike",n.timeline.entries.length):l("CommentLike",n.timeline.entries.length)},datetime:"inBlock",loadingLock:!0,oneLine:!0,hasDeleteButton:!0,clickable:!0,entries:[]},l("All")}])}(),function(){"use strict";keylolApp.controller("AlphaEntranceController",["pageTitle","$scope","$timeout","$rootScope","window","$window","union","$location",function(t,e,n,i,r,o,s,a){t.set("其乐游戏社区"),e.$watch(function(){return s.$localStorage.login},function(t){t&&a.url("home")}),e.showInvitationWindow=function(){r.show({templateUrl:"components/windows/alpha-invitation.html",controller:"AlphaInvitationController"})},e.secondAnimate=!1;var l=0;e.active=0;var u;$(o).scroll(function(){e.$apply(function(){0==e.secondAnimate&&$(o).scrollTop()>=538&&(e.secondAnimate=!0),$(o).scrollTop()<1152?(e.active=0,l=0):$(o).scrollTop()>2077?(e.active=6,l=6):d($(o).scrollTop()<1337?1:$(o).scrollTop()<1522?2:$(o).scrollTop()<1707?3:$(o).scrollTop()<1892?4:5)})});var c=e.$on("$destroy",function(){$(o).unbind("scroll"),c()}),d=function(t){l!=t&&(l=t,u&&n.cancel(u),u=n(function(){e.active=t},100))}}])}(),function(){"use strict";keylolApp.controller("ArticleController",["pageTitle","$scope","union","$routeParams","$http","getAndFlushComments","notification","$location","$timeout",function(t,e,n,i,r,o,s,a,l){e.articleExist=!0,t.set("文章 - 其乐"),n.article={},n.point={},n.summary={},n.pageElements={},n.comments=[],n.hotComments=[],i.author&&i.article&&(r.get(apiEndpoint+"article/"+i.author+"/"+i.article).then(function(u){var c=u.data;c.authorIdCode=i.author,c.sqNumberForAuthor=i.article,t.set(c.Title+" - 其乐");for(var d in c.AttachedPoints)c.AttachedPoints[d].mainName=c.AttachedPoints[d][c.AttachedPoints[d].PreferredName+"Name"];if(c.isMyArticle=n.$localStorage.user.IdCode===i.author,c.canEdit=c.isMyArticle||"operator"===n.$localStorage.user.StaffClaim,c.Vote){switch(e.hasVote=!0,c.Vote){case"Positive":c.VoteText="好评";break;case"Negative":c.VoteText="差评"}r.get(apiEndpoint+"normal-point/"+c.VoteForPointId,{params:{includeVotes:!0}}).then(function(t){var e=t.data;if(e.mainName=e[e.PreferredName+"Name"],e.PositiveArticleCount+e.NegativeArticleCount>0)if(e.votePercent=(10*e.PositiveArticleCount/(e.PositiveArticleCount+e.NegativeArticleCount)).toFixed(1),e.voteCircles=[{},{},{},{},{}],e.votePercent>=8)for(var i in e.voteCircles)e.voteCircles[i].type="awesome";else if(e.votePercent>=6)for(var i=0;4>i;i++)e.voteCircles[i].type="good";else if(e.votePercent>=4)for(var i=0;3>i;i++)e.voteCircles[i].type="not-bad";else if(e.votePercent>=2)for(var i=0;2>i;i++)e.voteCircles[i].type="bad";else e.voteCircles[0].type="terrible";else e.votePercent="N/A",e.voteCircles=[{},{},{},{},{}],e.noVotes=!0;$.extend(n.point,e)},function(t){s.error("未知错误",t)})}$.extend(n.article,c),o(c,null,"hot"),a.hash()?o(c,a.hash(),"sequence",function(){l(function(){$("body").animate({scrollTop:$("#comment-"+a.hash()).offset().top},function(){$("#comment-"+a.hash()).addClass("highlight")})})}):o(c,1,"page"),n.pageElements.changePage=function(t,e){o(c,e,"page")}},function(t){404===t.status&&(e.articleExist=!1),console.error(t)}),r.get(apiEndpoint+"user/"+i.author,{params:{includeSubscribed:i.author!=n.$localStorage.user.IdCode,includeStats:!0,includeProfilePointBackgroundImage:!0,idType:"IdCode"}}).then(function(t){var e=t.data,i={head:{mainHead:e.UserName,subHead:e.GamerTag},avatar:e.AvatarImage,background:e.ProfilePointBackgroundImage,pointSum:{type:"个人",readerNum:e.SubscriberCount,articleNum:e.ArticleCount},id:e.Id,url:"user/"+e.IdCode};$.extend(n.summary,i),e.IdCode!=n.$localStorage.user.IdCode&&(n.summary.subscribed=e.Subscribed)},function(t){s.error("未知错误",t)}))}])}(),function(){"use strict";keylolApp.controller("CommentsController",["pageTitle","$scope","union","$http","notification","utils","$timeout",function(t,e,n,i,r,o,s){function a(t){for(var e=n.timeline.actions,i=0;i<e.length;i++)e[i].active=!1;t.active=!0}function l(t){t||(n.timeline.entries.length=0,t=0),i.get(apiEndpoint+"comment/my",{params:{type:"Sent",skip:t,take:o.timelineLoadCount}}).then(function(t){n.timeline.noMoreArticle=t.data.length<o.timelineLoadCount;var e;for(var i in t.data){var r=t.data[i],a={types:["发出"],fromArticle:{fromComment:!0,text:r.Article.Title,href:"article/"+r.Article.AuthorIdCode+"/"+r.Article.SequenceNumberForAuthor},datetime:r.PublishTime,author:{username:n.$localStorage.user.UserName,avatarUrl:n.$localStorage.user.AvatarImage,idCode:n.$localStorage.user.IdCode},summary:r.Content,url:"article/"+r.Article.AuthorIdCode+"/"+r.Article.SequenceNumberForAuthor+"#"+r.SequenceNumberForArticle};r.ReplyToComment&&r.ReplyToUser&&(a.commentTarget={type:"comment",author:{username:r.ReplyToUser.UserName,idCode:r.ReplyToUser.IdCode},text:r.ReplyToComment.Content,url:"article/"+r.Article.AuthorIdCode+"/"+r.Article.SequenceNumberForAuthor+"#"+r.ReplyToComment.SequenceNumberForArticle}),function(t){e?e=e.then(function(){return n.timeline.entries.push(t),s(function(){},o.timelineInsertDelay)}):(n.timeline.entries.push(t),e=s(function(){},o.timelineInsertDelay))}(a)}e?e.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1},function(t){r.error("未知错误",t),n.timeline.loadingLock=!1})}function u(t){t||(n.timeline.entries.length=0,t=0),i.get(apiEndpoint+"comment/my",{params:{skip:t,take:o.timelineLoadCount}}).then(function(t){n.timeline.noMoreArticle=t.data.length<o.timelineLoadCount;var e;for(var i in t.data){var r=t.data[i],a={types:["收到"],isNew:!r.ReadByTargetUser,fromArticle:{fromComment:!0,text:r.Article.Title,href:"article/"+r.Article.AuthorIdCode+"/"+r.Article.SequenceNumberForAuthor},datetime:r.PublishTime,author:{username:r.Commentator.UserName,avatarUrl:r.Commentator.AvatarImage,idCode:r.Commentator.IdCode},summary:r.Content,url:"article/"+r.Article.AuthorIdCode+"/"+r.Article.SequenceNumberForAuthor+"#"+r.SequenceNumberForArticle};r.ReplyToComment&&(a.commentTarget={type:"comment",author:{username:n.$localStorage.user.UserName,idCode:n.$localStorage.user.IdCode},text:r.ReplyToComment.Content,url:"article/"+r.Article.AuthorIdCode+"/"+r.Article.SequenceNumberForAuthor+"#"+r.ReplyToComment.SequenceNumberForArticle}),function(t){e?e=e.then(function(){return n.timeline.entries.push(t),s(function(){},o.timelineInsertDelay)}):(n.timeline.entries.push(t),e=s(function(){},o.timelineInsertDelay))}(a)}e?e.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1},function(t){r.error("未知错误",t),n.timeline.loadingLock=!1})}t.set("评论 - 其乐"),n.summary={head:{mainHead:"评论",subHead:"Comments"},background:"672a1bab71b9af43215d252471a893e0.jpg",defaultSum:{text:"文章回复中的互动"}},n.timeline={title:{mainTitle:"评论",subTitle:"Comments"},actions:[{active:!0,text:"收到",onClick:function(){this.active||(a(this),u())}},{active:!1,text:"发出",onClick:function(){this.active||(a(this),l())}}],loadAction:function(){n.timeline.loadingLock=!0,n.timeline.actions[0].active?u(n.timeline.entries.length):l(n.timeline.entries.length)},datetime:"inBlock",oneLine:!0,clickable:!0,loadingLock:!0,entries:[]},u()}])}(),function(){"use strict";keylolApp.controller("HomeController",["pageTitle","$scope","union","$http","notification","window","utils","$timeout",function(t,e,n,i,r,o,s,a){t.set("其乐"),e.union=n,n.timeline={title:{mainTitle:"讯息轨道",subTitle:"Timeline"},rightButton:{avatar:"assets/images/edit-pen.png",alt:"发表新文章",text:"文",clickAction:function(){o.show({templateUrl:"components/windows/editor.html",controller:"EditorController",inputs:{vm:null}})}},noArticleText:{main:"从你的游戏兴趣开始，慢慢搭建一条讯息轨道",sub:"订阅一个据点后，其收到的文章投稿会推送到这里。"},datetime:"outBlock",hasExpand:!0,loadingLock:!0,loadAction:function(t,e){i.get(apiEndpoint+"article/subscription",{params:t}).then(function(t){e(t)},function(t){r.error("未知错误",t)})},entries:[]},i.get(apiEndpoint+"article/subscription",{params:{take:s.timelineLoadCount}}).then(function(t){var e=t.data;if(n.timeline.noMoreArticle=e.length<s.timelineLoadCount,e.length>0){var o;for(var l in e){var u=e[l],c={types:[u.TypeName],author:{username:u.Author.UserName,avatarUrl:u.Author.AvatarImage,idCode:u.Author.IdCode},sequenceNumber:u.SequenceNumber,sources:{},datetime:u.PublishTime,title:u.Title,summary:u.Content,thumbnail:u.ThumbnailImage,url:"/article/"+u.Author.IdCode+"/"+u.SequenceNumberForAuthor,count:{like:u.LikeCount,comment:u.CommentCount}};if(u.TimelineReason)switch(u.TimelineReason){case"Like":if(c.sources.type="like",c.sources.userArray=[],u.LikeByUsers)for(var d in u.LikeByUsers)c.sources.userArray.push({name:u.LikeByUsers[d].UserName,idCode:u.LikeByUsers[d].IdCode});else c.sources.userArray.push({name:n.$localStorage.user.UserName,idCode:"/user/"+n.$localStorage.user.IdCode});break;case"Point":c.sources.type="point",c.sources.points=[];for(var d in u.AttachedPoints)c.sources.points.push({name:u.AttachedPoints[d][u.AttachedPoints[d].PreferredName+"Name"],idCode:u.AttachedPoints[d].IdCode});break;case"Publish":c.sources.type="publish"}!function(t){o?o=o.then(function(){return n.timeline.entries.push(t),a(function(){},s.timelineInsertDelay)}):(n.timeline.entries.push(t),o=a(function(){},s.timelineInsertDelay))}(c)}o?o.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1}else i.get(apiEndpoint+"normal-point/active").then(function(t){n.timeline.activePoints=t.data;for(var e in n.timeline.activePoints){var i=n.timeline.activePoints[e];n.timeline.activePoints[e].mainName=s.getPointFirstName(i),n.timeline.activePoints[e].subName=s.getPointSecondName(i),n.timeline.activePoints[e].type=s.getPointType(i.Type)}},function(t){r.error("未知错误",t)}),n.timeline.loadingLock=!1},function(t){r.error("未知错误",t),n.timeline.loadingLock=!1})}])}(),function(){"use strict";keylolApp.controller("NotFoundController",["pageTitle",function(t){t.set("404 Not Found - 其乐")}])}(),function(){"use strict";keylolApp.controller("PointController",["pageTitle","$scope","union","$routeParams","$http","utils","notification","window","$location","$timeout",function(t,e,n,i,r,o,s,a,l,u){e.union=n,e.pointExist=!0,e.isInPoint=!0,n.summary={},n.user={},n.timeline={title:{mainTitle:"讯息轨道",subTitle:"Timeline"},rightButton:{avatar:"assets/images/edit-pen.png",alt:"发表新文章",text:"文",clickAction:function(){a.show({templateUrl:"components/windows/editor.html",controller:"EditorController",inputs:{vm:null}})}},publishOnly:/\/user\/.+\/publications/i.test(l.url()),datetime:"outBlock",hasExpand:!0,loadingLock:!0,entries:[]},n.point={},i.userIdCode&&(n.timeline.noArticleText={main:"这位用户尚未发布或认可任何文章",sub:"订阅并关注即将到来的动态。"},n.timeline.loadAction=function(t,e){r.get(apiEndpoint+"article/user/"+i.userIdCode,{params:t}).then(function(t){e(t)},function(t){s.error("未知错误",t)})},r.get(apiEndpoint+"user/"+i.userIdCode,{params:{includeStats:!0,idType:"IdCode",includeProfilePointBackgroundImage:!0,includeSubscribed:!0}}).then(function(e){var a=e.data,l={head:{mainHead:a.UserName,subHead:a.GamerTag},avatar:a.AvatarImage,background:a.ProfilePointBackgroundImage,pointSum:{type:"个人",readerNum:a.SubscriberCount,articleNum:a.ArticleCount},id:a.Id,url:"user/"+a.IdCode};a.IdCode!=n.$localStorage.user.IdCode&&(n.summary.subscribed=a.Subscribed),o.addRecentBroswe("ProfilePoint",a.UserName,a.IdCode),t.set(a.UserName+" - 其乐"),$.extend(n.user,a),$.extend(n.summary,l),r.get(apiEndpoint+"article/user/"+i.userIdCode,{params:{idType:"IdCode",publishOnly:n.timeline.publishOnly,take:o.timelineLoadCount}}).then(function(t){var e=t.data;if(n.timeline.noMoreArticle=e.length<o.timelineLoadCount,e.length>0){var i;for(var l in e){var c=e[l];c.Author||(c.Author=a);var d={types:[c.TypeName],author:{username:c.Author.UserName,avatarUrl:c.Author.AvatarImage,idCode:c.Author.IdCode},sequenceNumber:c.SequenceNumber,sources:{},datetime:c.PublishTime,title:c.Title,summary:c.Content,thumbnail:c.ThumbnailImage,url:"/article/"+c.Author.IdCode+"/"+c.SequenceNumberForAuthor,count:{like:c.LikeCount,comment:c.CommentCount}};if(c.TimelineReason)switch(c.TimelineReason){case"Like":if(d.sources.type="like",d.sources.userArray=[],c.LikeByUsers)for(var f in c.LikeByUsers)d.sources.userArray.push({name:c.LikeByUsers[f].UserName,idCode:c.LikeByUsers[f].IdCode});else d.sources.userArray.push({name:a.UserName,idCode:a.IdCode});break;case"Point":d.sources.type="point",d.sources.points=[];for(var f in c.AttachedPoints)d.sources.points.push({name:c.AttachedPoints[f][c.AttachedPoints[f].PreferredName+"Name"],idCode:c.AttachedPoints[f].IdCode});break;case"Publish":d.sources.type="publish"}!function(t){i?i=i.then(function(){return n.timeline.entries.push(t),u(function(){},o.timelineInsertDelay)}):(n.timeline.entries.push(t),i=u(function(){},o.timelineInsertDelay))}(d)}i?i.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1}else r.get(apiEndpoint+"normal-point/active").then(function(t){n.timeline.activePoints=t.data;for(var e in n.timeline.activePoints){var i=n.timeline.activePoints[e];n.timeline.activePoints[e].mainName=o.getPointFirstName(i),n.timeline.activePoints[e].subName=o.getPointSecondName(i),n.timeline.activePoints[e].type=o.getPointType(i.Type)}},function(t){s.error("未知错误",t)}),n.timeline.loadingLock=!1},function(t){s.error("未知错误",t),n.timeline.loadingLock=!1})},function(t){e.pointExist=!1,s.error("未知错误",t)})),i.pointIdCode&&(n.timeline.noArticleText={main:"当前据点尚未收到任何文章投稿",sub:"考虑成为首篇文章的作者？"},n.timeline.loadAction=function(t,e){r.get(apiEndpoint+"article/point/"+i.pointIdCode,{params:t}).then(function(t){e(t)},function(t){s.error("未知错误",t)})},r.get(apiEndpoint+"normal-point/"+i.pointIdCode,{params:{includeStats:!0,includeVotes:!0,includeSubscribed:!0,includeAssociated:!0,idType:"IdCode"}}).then(function(i){var r=i.data;n.associatedPoints=r.AssociatedPoints,"Game"===r.Type&&(e.hasVote=!0);var s={head:{},avatar:r.AvatarImage,subscribed:r.Subscribed,background:r.BackgroundImage,pointSum:{type:o.getPointType(r.Type),readerNum:r.SubscriberCount,articleNum:r.ArticleCount},id:r.Id,url:"point/"+r.IdCode};if(r.mainName=o.getPointFirstName(r),s.head.mainHead=o.getPointFirstName(r),s.head.subHead=o.getPointSecondName(r),t.set(r.mainName+" - 其乐"),r.PositiveArticleCount+r.NegativeArticleCount>0)if(r.votePercent=(10*r.PositiveArticleCount/(r.PositiveArticleCount+r.NegativeArticleCount)).toFixed(1),r.voteCircles=[{},{},{},{},{}],r.votePercent>=8)for(var a in r.voteCircles)r.voteCircles[a].type="awesome";else if(r.votePercent>=6)for(var a=0;4>a;a++)r.voteCircles[a].type="good";else if(r.votePercent>=4)for(var a=0;3>a;a++)r.voteCircles[a].type="not-bad";else if(r.votePercent>=2)for(var a=0;2>a;a++)r.voteCircles[a].type="bad";else r.voteCircles[0].type="terrible";else r.votePercent="N/A",r.voteCircles=[{},{},{},{},{}],r.noVotes=!0;o.addRecentBroswe("NormalPoint",r.mainName,r.IdCode),$.extend(n.point,r),$.extend(n.summary,s)},function(t){e.pointExist=!1,s.error("未知错误",t)}),r.get(apiEndpoint+"article/point/"+i.pointIdCode,{params:{idType:"IdCode",take:o.timelineLoadCount}}).then(function(t){var e=t.data;if(n.timeline.noMoreArticle=e.length<o.timelineLoadCount,e.length>0){var i;for(var a in e){var l=e[a],c={types:[l.TypeName],author:{username:l.Author.UserName,avatarUrl:l.Author.AvatarImage,idCode:l.Author.IdCode},sequenceNumber:l.SequenceNumber,datetime:l.PublishTime,title:l.Title,summary:l.Content,thumbnail:l.ThumbnailImage,url:"/article/"+l.Author.IdCode+"/"+l.SequenceNumberForAuthor,count:{like:l.LikeCount,comment:l.CommentCount}};!function(t){i?i=i.then(function(){return n.timeline.entries.push(t),u(function(){},o.timelineInsertDelay)}):(n.timeline.entries.push(t),i=u(function(){},o.timelineInsertDelay))}(c)}i?i.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1}else r.get(apiEndpoint+"normal-point/active").then(function(t){n.timeline.activePoints=t.data;for(var e in n.timeline.activePoints){var i=n.timeline.activePoints[e];n.timeline.activePoints[e].mainName=o.getPointFirstName(i),n.timeline.activePoints[e].subName=o.getPointSecondName(i),n.timeline.activePoints[e].type=o.getPointType(i.Type)}},function(t){s.error("未知错误",t)}),n.timeline.loadingLock=!1},function(t){s.error("未知错误",t),n.timeline.loadingLock=!1}))}])}(),function(){"use strict";keylolApp.controller("PostController",["pageTitle","$scope","union",function(t,e,n){t.set("邮政 - 其乐"),n.summary={actions:[],head:{mainHead:"邮政服务",subHead:"Postal Services"},background:"04be114e21692aa38afe2e4d1bc605b6.png",defaultSum:{text:"社区功能页面"}},n.timeline={title:{mainTitle:"邮政服务",subTitle:"Postal Services"},rightButton:{avatar:"assets/images/message-edit.png",alt:"发送私信"},entries:[{types:["私信"],privateMesNum:{number:1,hasNew:!1},author:{username:"crakyGALU",avatarUrl:"assets/images/exit.svg"},summary:"说起这个警匪死磕的话，相比正玩家们没有不知道那大名鼎鼎的CF啊不对CS，也就是《反恐精英（Counter-Strike）》，这款游戏的出现让警匪对殴的模式风靡全球，至今依然有大批玩家热衷于此，除此之外类似的游戏也有不少，例如《彩虹六号系列》，例如《收获日系列》等等，如今FPS界极其有影响力的战地系列也开始涉及此类题材，眼下BETA版本已经开始测试，本篇评测是根据测试版而来，所以并不代表游戏的最终品质！"}]}}])}(),function(){"use strict";keylolApp.controller("ReadersController",["pageTitle","$scope","union","$http","notification","utils","$timeout",function(t,e,n,i,r,o,s){e.searchExist=!0,n.summary={head:{mainHead:n.$localStorage.user.UserName,subHead:n.$localStorage.user.GamerTag},avatar:n.$localStorage.user.AvatarImage,pointSum:{type:"个人",readerNum:n.$localStorage.user.SubscriberCount,articleNum:n.$localStorage.user.ArticleCount}},t.set(n.$localStorage.user.UserName+" 的读者 - 其乐"),i.get(apiEndpoint+"user/"+n.$localStorage.user.IdCode,{params:{idType:"IdCode",includeProfilePointBackgroundImage:!0}}).then(function(t){n.summary.background=t.data.ProfilePointBackgroundImage},function(t){r.error("未知错误",t)}),n.timeline={title:{mainTitle:"搜索结果",subTitle:"Search Result"},datetime:"outBlock",loadAction:function(){n.timeline.loadingLock=!0,i.get(apiEndpoint+"user/my",{params:{take:o.timelineLoadCount,skip:n.timeline.entries.length}}).then(function(t){n.timeline.noMoreArticle=t.data.length<o.timelineLoadCount;var e;if(t.data.length>0){n.timeline.searchNotFound=!1;for(var i in t.data){var r=t.data[i];n.timeline.searchNotFound=!1;var a={types:["个人"],pointInfo:{reader:r.SubscriberCount,article:r.ArticleCount},title:r.UserName,summary:r.GamerTag,pointAvatar:r.AvatarImage,url:"user/"+r.IdCode,isUser:!0,id:r.Id};!function(t){e?e=e.then(function(){return n.timeline.entries.push(t),s(function(){},o.timelineInsertDelay)}):(n.timeline.entries.push(t),e=s(function(){},o.timelineInsertDelay))}(a)}}else n.timeline.searchNotFound=!0;e?e.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1},function(t){r.error("未知错误",t),n.timeline.loadingLock=!1})},entries:[]},n.timeline.loadAction()}])}(),function(){"use strict";keylolApp.controller("SearchResultsController",["pageTitle","$scope","union","$http","notification","$routeParams","$location","utils","$timeout",function(t,e,n,i,r,o,s,a,l){switch(e.searchExist=!0,o.searchType&&o.keyword||(e.searchExist=!1),t.set(o.keyword+" 的搜索结果 - 其乐"),n.summary={actions:[],head:{mainHead:o.keyword,subHead:"的搜索结果"},background:"18714f31d985cb8e8b59661cabd9d23a.jpg",defaultSum:{text:""}},n.timeline={title:{mainTitle:"搜索结果",subTitle:"Search Result"},actions:[{active:!1,text:"据点",onClick:function(){s.url("search/point/"+encodeURIComponent(o.keyword))}},{active:!1,text:"文章",onClick:function(){s.url("search/article/"+encodeURIComponent(o.keyword))}},{active:!1,text:"用户",onClick:function(){s.url("search/user/"+encodeURIComponent(o.keyword))}},{active:!1,text:"全站",onClick:function(){}}],datetime:"outBlock",entries:[]},o.searchType){case"point":n.timeline.actions[0].active=!0,n.timeline.loadAction=function(){n.timeline.loadingLock=!0;var t=n.timeline.entries.length;i.get(apiEndpoint+"normal-point/keyword/"+encodeURIComponent(o.keyword),{params:{full:!0,skip:t,take:a.timelineLoadCount}}).then(function(e){var i=e.headers("X-Total-Record-Count");n.summary.defaultSum.text="找到 "+i+" 个符合的项目",n.timeline.noMoreArticle=e.data.length<a.timelineLoadCount;var r;if(i>0){t||(n.summary.background=e.data[0].BackgroundImage),n.timeline.searchNotFound=!1;for(var o in e.data){var s=e.data[o],u={types:[a.getPointType(s.Type)],pointInfo:{reader:s.SubscriberCount,article:s.ArticleCount},pointAvatar:s.AvatarImage,url:"point/"+s.IdCode,subscribed:s.Subscribed,id:s.Id};u.title=a.getPointFirstName(s),u.summary=a.getPointSecondName(s),function(t){r?r=r.then(function(){return n.timeline.entries.push(t),l(function(){},a.timelineInsertDelay)}):(n.timeline.entries.push(t),r=l(function(){},a.timelineInsertDelay))}(u)}}else n.timeline.searchNotFound=!0;r?r.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1},function(t){r.error("未知错误",t),n.timeline.loadingLock=!1})},n.timeline.loadAction();break;case"article":n.timeline.actions[1].active=!0,n.timeline.loadAction=function(){n.timeline.loadingLock=!0;var t=n.timeline.entries.length;i.get(apiEndpoint+"article/keyword/"+encodeURIComponent(o.keyword),{params:{full:!0,skip:t,take:a.timelineLoadCount}}).then(function(e){var i=e.headers("X-Total-Record-Count");if(n.summary.defaultSum.text="找到 "+i+" 个符合的项目",n.timeline.noMoreArticle=e.data.length<a.timelineLoadCount,i>0){t||(n.summary.background=e.data[0].AuthorProfilePointBackgroundImage),n.timeline.searchNotFound=!1;var r;for(var o in e.data){var s=e.data[o],u={types:[s.TypeName],author:{username:s.Author.UserName,avatarUrl:s.Author.AvatarImage,idCode:s.Author.IdCode},sequenceNumber:s.SequenceNumber,datetime:s.PublishTime,title:s.Title,summary:s.Content,thumbnail:s.ThumbnailImage,url:"/article/"+s.Author.IdCode+"/"+s.SequenceNumberForAuthor,count:{like:s.LikeCount,comment:s.CommentCount}};!function(t){r?r=r.then(function(){return n.timeline.entries.push(t),l(function(){},a.timelineInsertDelay)}):(n.timeline.entries.push(t),r=l(function(){},a.timelineInsertDelay))}(u)}}else n.timeline.searchNotFound=!0;r?r.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1},function(t){r.error("未知错误",t),n.timeline.loadingLock=!1})},n.timeline.loadAction();break;case"user":n.timeline.loadAction=function(){},n.timeline.loadingLock=!0,n.timeline.noMoreArticle=!0,n.timeline.actions[2].active=!0,i.get(apiEndpoint+"user/"+encodeURIComponent(o.keyword),{params:{idType:"UserName",includeStats:!0,includeSubscribed:!0,includeProfilePointBackgroundImage:!0}}).then(function(t){if(t.data){var e=t.data;n.summary.background=e.ProfilePointBackgroundImage,n.timeline.searchNotFound=!1,n.summary.defaultSum.text="找到 1 个符合的项目",n.timeline.entries.push({types:["个人"],pointInfo:{reader:e.SubscriberCount,article:e.ArticleCount},title:e.UserName,summary:e.GamerTag,pointAvatar:e.AvatarImage,url:"user/"+e.IdCode,isUser:!0,id:e.Id}),e.IdCode!=n.$localStorage.user.IdCode&&(n.timeline.entries[0].subscribed=e.Subscribed)}n.timeline.loadingLock=!1},function(t){404===error.status?n.summary.defaultSum.text="找到 0 个符合的项目":r.error("未知错误",t),n.timeline.loadingLock=!1,n.timeline.searchNotFound=!0})}}])}(),function(){"use strict";keylolApp.controller("SubscriptionsController",["pageTitle","$scope","union","$http","notification","$location","utils","$timeout",function(t,e,n,i,r,o,s,a){e.searchExist=!0,n.summary={head:{mainHead:n.$localStorage.user.UserName,subHead:n.$localStorage.user.GamerTag},avatar:n.$localStorage.user.AvatarImage,pointSum:{type:"个人",readerNum:n.$localStorage.user.SubscriberCount,articleNum:n.$localStorage.user.ArticleCount}},t.set(n.$localStorage.user.UserName+" 的订阅 - 其乐"),i.get(apiEndpoint+"user/"+n.$localStorage.user.IdCode,{params:{idType:"IdCode",includeProfilePointBackgroundImage:!0}}).then(function(t){
n.summary.background=t.data.ProfilePointBackgroundImage},function(t){r.error("未知错误",t)}),n.timeline={title:{mainTitle:"搜索结果",subTitle:"Search Result"},datetime:"outBlock",loadAction:function(){n.timeline.loadingLock=!0,i.get(apiEndpoint+"user-point-subscription/my",{params:{take:s.timelineLoadCount,skip:n.timeline.entries.length}}).then(function(t){n.timeline.noMoreArticle=t.data.length<s.timelineLoadCount;var e;if(t.data.length>0){n.timeline.searchNotFound=!1;var i;for(var r in t.data){if(t.data[r].NormalPoint){var o=t.data[r].NormalPoint;i={types:[s.getPointType(o.Type)],pointInfo:{reader:t.data[r].SubscriberCount,article:t.data[r].ArticleCount},title:s.getPointFirstName(o),summary:s.getPointSecondName(o),pointAvatar:o.AvatarImage,url:"point/"+o.IdCode,subscribed:!0,id:o.Id}}else if(t.data[r].User){var l=t.data[r].User;n.timeline.searchNotFound=!1,i={types:["个人"],pointInfo:{reader:t.data[r].SubscriberCount,article:t.data[r].ArticleCount},subscribed:!0,title:l.UserName,summary:l.GamerTag,pointAvatar:l.AvatarImage,url:"user/"+l.IdCode,isUser:!0,id:l.Id}}!function(t){e?e=e.then(function(){return n.timeline.entries.push(t),a(function(){},s.timelineInsertDelay)}):(n.timeline.entries.push(t),e=a(function(){},s.timelineInsertDelay))}(i)}}else n.timeline.searchNotFound=!0;e?e.then(function(){n.timeline.loadingLock=!1}):n.timeline.loadingLock=!1},function(t){r.error("未知错误",t),n.timeline.loadingLock=!1})},entries:[]},n.timeline.loadAction()}])}(),function(){"use strict";keylolApp.controller("ArticleTypeSelectorController",["$scope","close","selectedIndex","articleTypes",function(t,e,n,i){t.articleTypes=i,t.selectedIndex=n,t.select=function(t){e(t)}}])}(),function(){"use strict";keylolApp.controller("EntryFilterController",["$scope","selectedIndexes","close","types",function(t,e,n,i){e&&(t.selectedIndexes=e.slice()),t.entryTypes=i,t.confirm=function(){n(t.selectedIndexes)}}])}(),function(){"use strict";keylolApp.controller("OperationFeedbackController",["$scope","close","options","$timeout",function(t,e,n,i){t.options=n,"attention"!=t.options.type&&i(function(){e()},3e3),t.close=function(t){e(t)}}])}(),function(){"use strict";keylolApp.controller("PointPreviewCardController",["$scope","idCode","type","$timeout","$http","utils","notification","union",function(t,e,n,i,r,o,s,a){if(t.loading=!0,"point"===n)a.pointCards||(a.pointCards={}),a.pointCards[e]?(t.loading=!1,t.data=a.pointCards[e]):r.get(apiEndpoint+"normal-point/"+e,{params:{includeStats:!0,includeSubscribed:!0,idType:"IdCode"}}).then(function(n){var i=n.data;t.data={id:i.Id,subscribed:i.Subscribed,head:{},avatar:i.AvatarImage,background:i.BackgroundImage,pointSum:{type:o.getPointType(i.Type),readerNum:i.SubscriberCount,articleNum:i.ArticleCount}},t.data.head.mainHead=o.getPointFirstName(i),t.data.head.subHead=o.getPointSecondName(i),a.pointCards&&(a.pointCards[e]=t.data),t.loading=!1},function(t){s.error("据点卡片请求错误",t)});else if(a.userCards||(a.userCards={}),a.userCards[e])t.loading=!1,t.data=a.userCards[e];else{var l=!0;e===a.$localStorage.user.IdCode&&(l=!1),r.get(apiEndpoint+"user/"+e,{params:{includeStats:!0,includeSubscribed:l,includeProfilePointBackgroundImage:!0,idType:"IdCode"}}).then(function(n){var i=n.data;t.data={id:i.Id,subscribed:i.Subscribed,head:{mainHead:i.UserName,subHead:i.GamerTag},avatar:i.AvatarImage,background:i.ProfilePointBackgroundImage,pointSum:{type:"个人",readerNum:i.SubscriberCount,articleNum:i.ArticleCount}},a.userCards[e]=t.data,t.loading=!1},function(t){s.error("据点卡片请求错误",t)})}t.subscribeDisabled=!1,t.subscribe=function(e){t.subscribeDisabled=!0,r.post(apiEndpoint+"user-point-subscription",{},{params:{pointId:e}}).then(function(){s.success("据点已订阅，其今后收到的文章投稿将推送到你的首页"),t.data.subscribed=!0,t.subscribeDisabled=!1,t.data.pointSum.readerNum++,a.$localStorage.user.SubscribedPointCount++},function(t){s.error("未知错误",t)})},t.unsubscribe=function(e){t.subscribeDisabled=!0,s.attention("退订并不再接收此据点的文章推送",[{action:"退订",value:!0},{action:"取消"}]).then(function(n){n?r["delete"](apiEndpoint+"user-point-subscription",{params:{pointId:e}}).then(function(){s.success("据点已退订"),t.data.subscribed=!1,t.data.pointSum.readerNum--,a.$localStorage.user.SubscribedPointCount--},function(t){s.error("未知错误",t)})["finally"](function(){t.subscribeDisabled=!1}):t.subscribeDisabled=!1})}}])}(),function(){"use strict";keylolApp.controller("PointSelectorController",["$scope","$window","close","union","selected","pointArray","utils",function(t,e,n,i,r,o,s){t.pointArray=o,t.utils=s;for(var a in t.pointArray)t.pointArray[a].selected=!1;t.pointArray[r].selected=!0,t.changeSelector=function(e){t.pointArray[r].selected=!1,r=e,t.pointArray[e].selected=!0},t.selectPoint=function(){t.pointArray[r].selected=!1,n(t.pointArray[r])},i.keydownCallback=function(e){t.$apply(function(){40==e.keyCode?r<t.pointArray.length-1?t.changeSelector(r+1):t.changeSelector(0):38==e.keyCode?r>0?t.changeSelector(r-1):t.changeSelector(t.pointArray.length-1):13==e.keyCode&&t.selectPoint(e)})},e.addEventListener("keydown",i.keydownCallback,!0)}])}(),function(){"use strict";keylolApp.controller("SearchSelectorController",["$scope","union","$location","options","$http","notification","utils",function(t,e,n,i,r,o,s){t.onSearching=i.onSearching,t.filterArray=e.searchFilter;var a,l=function(e){if(i.searchText)switch(e){case"据点":r.get(apiEndpoint+"normal-point/keyword/"+encodeURIComponent(i.searchText)).then(function(e){if(e.data.length>0){t.resultArray=[];for(var n in e.data){var i=e.data[n],r={avatar:i.AvatarImage,type:s.getPointType(i.Type),url:"point/"+i.IdCode};r.mainTitle=s.getPointFirstName(i),r.subTitle=s.getPointSecondName(i),t.resultArray.push(r)}}else t.resultArray=void 0,t.notFound=!0},function(t){o.error("未知错误",t)});break;case"文章":r.get(apiEndpoint+"article/keyword/"+encodeURIComponent(i.searchText)).then(function(e){if(e.data.length>0){t.resultArray=[];for(var n in e.data){var i=e.data[n];t.resultArray.push({mainTitle:i.Title,articleInfo:{acknowledgeNum:i.LikeCount,commentNum:i.CommentCount},url:"article/"+i.AuthorIdCode+"/"+i.SequenceNumberForAuthor})}}else t.resultArray=void 0,t.notFound=!0},function(t){o.error("未知错误",t)});break;case"用户":r.get(apiEndpoint+"user/"+encodeURIComponent(i.searchText),{params:{idType:"UserName"}}).then(function(e){if(e.data){t.resultArray=[];var n=e.data;t.resultArray.push({mainTitle:n.UserName,subTitle:n.GamerTag,avatar:n.AvatarImage,type:"个人",url:"user/"+n.IdCode,isUser:!0})}},function(e){404===error.status?(t.resultArray=void 0,t.notFound=!0):o.error("未知错误",e)});break;default:t.resultArray=void 0,t.notFound=!0}};for(var u in t.filterArray)t.filterArray[u].active===!0&&(a=t.filterArray[u].text);t.$watch(function(){return i.searchText},function(){l(a)}),t.changeFilter=function(e){if(!t.filterArray[e].active){for(var n in t.filterArray)t.filterArray[n].active=!1;t.filterArray[e].active=!0,l(t.filterArray[e].text)}},t.jumpTo=function(t){n.url(t)}}])}(),function(){"use strict";keylolApp.provider("apiEndpoint",function(){var t="";return{setEndPoint:function(e){t=e},$get:[function(){return t}]}})}(),function(){"use strict";keylolApp.constant("articleTypes",[{name:"评",description:"感悟、心得、体验、报告",allowVote:!0},{name:"研",description:"攻略、技术、成就、教程",allowVote:!1},{name:"讯",description:"新闻、购物、更新、竞技",allowVote:!1},{name:"谈",description:"聊天、灌水、吐槽、杂文",allowVote:!1},{name:"档",description:"声画、模组、插件、汉化",allowVote:!1}])}(),function(){"use strict";keylolApp.factory("getAndFlushComments",["$http","union","notification","utils",function(t,e,n,i){var r=function(t,n){var r=/^((?:#\d+[ \t]*)+)(?:$|[ \t]+)/gm,o=/#(\d+)/g;return i.escapeHtml(t).replace(r,function(t){return t.replace(o,function(t){var i=parseInt(t.slice(1,t.length));return n>i?'<a href="article/'+e.article.authorIdCode+"/"+e.article.sqNumberForAuthor+"#"+i+'">'+t+"</a>":t})})};return function(i,o,s,a){if(a||(a=function(){}),"hot"==s)t.get(apiEndpoint+"comment",{params:{articleId:i.Id,orderBy:"LikeCount",desc:!0,take:3}}).then(function(t){var n=t.data,o=[];for(var s in n)if(n[s].LikeCount>=5){var a=n[s];a.Commentator.IdCode==i.AuthorIdCode&&(a.Commentator.isAuthor=!0),a.LikeCount>0&&(a.hasLike=!0),a.Commentator.IdCode==e.$localStorage.user.IdCode&&(a.cannotLike=!0),a.Content=r(a.Content,a.SequenceNumberForArticle),o.push(a)}$.extend(e.hotComments,o)},function(t){n.error("未知错误",t)});else if("page"==s){var l=o;t.get(apiEndpoint+"comment",{params:{articleId:i.Id,skip:1==l?0:17+20*(l-2),take:1==l?17:20}}).then(function(t){var n=t.data;for(var o in n)n[o].Commentator.IdCode==i.AuthorIdCode&&(n[o].Commentator.isAuthor=!0),n[o].LikeCount>0&&(n[o].hasLike=!0),n[o].Commentator.IdCode==e.$localStorage.user.IdCode&&(n[o].cannotLike=!0),n[o].Content=r(n[o].Content,n[o].SequenceNumberForArticle);e.article.totalComments=t.headers("X-Total-Record-Count"),e.pageElements.totalPages=e.article.totalComments<=17?1:parseInt((e.article.totalComments-18)/20)+2,e.pageElements.currPage=l,e.comments.length=0,$.extend(e.comments,n)},function(t){n.error("未知错误",t)})}else{var u=o;t.get(apiEndpoint+"comment",{params:{articleId:i.Id,skip:17>=u?0:20*parseInt((u-17)/20)+17,take:17>=u?17:20}}).then(function(t){var n=t.data;for(var o in n)n[o].Commentator.IdCode==i.AuthorIdCode&&(n[o].Commentator.isAuthor=!0),n[o].LikeCount>0&&(n[o].hasLike=!0),n[o].Commentator.IdCode==e.$localStorage.user.IdCode&&(n[o].cannotLike=!0),n[o].Content=r(n[o].Content,n[o].SequenceNumberForArticle);e.article.totalComments=t.headers("X-Total-Record-Count"),e.pageElements.totalPages=e.article.totalComments<=17?1:parseInt((e.article.totalComments-18)/20)+2,e.pageElements.currPage=17>=u?1:parseInt((u-17)/20)+2,e.comments.length=0,$.extend(e.comments,n),a()},function(t){n.error("评论刷新失败",t)})}}}])}(),function(){"use strict";keylolApp.factory("notification",["window",function(t){function e(){var e,n=this;n.show=function(n){var i={templateUrl:"components/popup/operation-feedback.html",controller:"OperationFeedbackController",adjustScrollBar:!1,inputs:{options:n}};e=e?e.then(function(t){return t.close}).then(function(){return t.show(i)}):t.show(i);var r;return e.then(function(t){return r=function(e){e.target===t.$element[0]||$.contains(t.$element[0],e.target)||t.closeNow()},document.body.addEventListener("click",r,!0),t.close}).then(function(){document.body.removeEventListener("click",r,!0)}),e.then(function(t){return t.close})},n.success=function(t){return n.show({type:"success",title:"成功",subtitle:"Success",message:t})},n.process=function(t){return n.show({type:"process",title:"处理中",subtitle:"Processing",message:t})},n.error=function(t,e){if("string"==typeof t)return e&&console.error(e),n.show({type:"error",title:"错误",subtitle:"Error",message:t});for(var e in t.ModelState)if(t.ModelState.hasOwnProperty(e)&&"function"!=typeof e){n.error(t.ModelState[e][0]);break}},n.attention=function(t,e){return n.show({type:"attention",title:"注意",subtitle:"Attention",message:t,actions:e})}}return new e}])}(),function(){"use strict";keylolApp.provider("pageTitle",function(){var t="";return{setLoadingTitle:function(e){return e&&(t=e),t},$get:["$rootScope",function(e){return{set:function(t){e.pageTitle=t},loading:function(){e.pageTitle=t}}}]}})}(),function(){"use strict";keylolApp.factory("union",["$localStorage","$sessionStorage","$rootScope",function(t,e,n){var i={$localStorage:t,$sessionStorage:e};return n.$on("$routeChangeSuccess",function(){for(var n in i)delete i[n];i.$localStorage=t,i.$sessionStorage=e}),i}])}(),function(){"use strict";keylolApp.factory("upyun",["$http","base64","Upload",function(t,e,n){function i(){var i=this;i.policy=function(){var t={bucket:"keylol","save-key":"{filemd5}{.suffix}",expiration:Math.round((new Date).getTime()/1e3)+90,"content-length-range":"0,5242880"};return e.encode(JSON.stringify(t))},i.signature=function(e){return t.post(apiEndpoint+"upload-signature",null,{params:{policy:e}}).then(function(t){return t.data})},i.upload=function(t,e,i){return n.upload({url:"//v0.api.upyun.com/keylol",data:{file:t,policy:e,signature:i},withCredentials:!1})}}return new i}])}(),function(){"use strict";keylolApp.provider("utils",function(){var t={};return{config:function(e){return e&&(t=e),t},$get:["$q","union",function(e,n){function i(){var i=this,r=1;i.supportWebp=e(function(t,e){var n=new Image;n.onload=function(){n.width>0&&n.height>0?t():e()},n.onerror=function(){e()},n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"}),i.byteLength=function(t){for(var e=0,n=t.length-1;n>=0;n--){var i=t.charCodeAt(n);255>=i?e++:i>255&&65535>=i&&(e+=2),i>=56320&&57343>=i&&(n--,e++)}return e},i.createGeetest=function(n,r){"undefined"==typeof window.activateGeetest&&(window.activateGeetest={});var o,s=i.uniqueId(),a=e.defer(),l=e.defer();if(activateGeetest[s]=function(){var e=new Geetest({gt:t.geetestId,product:n,https:"https:"===location.protocol});e.onSuccess(function(){l.resolve(e),o&&o.resolve(e)}),a.resolve(e)},"undefined"==typeof window.Geetest){var u=document.createElement("script");u.src="//api.geetest.com/get.php?callback=activateGeetest["+s+"]",document.body.appendChild(u)}else activateGeetest[s]();return{id:s,ready:a.promise,success:l.promise,refresh:function(){return o=e.defer(),a.promise.then(function(t){t.refresh()}),o.promise}}},i.uniqueId=function(){return r++},i.arrayUnique=function(t){if(0===t.length)return t;t.sort();for(var e=[t[0]],n=1;n<t.length;n++)t[n]!==e[e.length-1]&&e.push(t[n]);return e},i.getPointType=function(t){return"Game"===t?"游戏":"Genre"===t?"类型":"Manufacturer"===t?"厂商":"Platform"===t?"平台":void 0},i.getPointFirstName=function(t){return t[t.PreferredName+"Name"]},i.getPointSecondName=function(t){return"Chinese"===t.PreferredName?t.EnglishName:"English"===t.PreferredName?t.ChineseName:void 0},i.addRecentBroswe=function(t,e,i){n.$localStorage.recentBrowse||(n.$localStorage.recentBrowse=[]);var r=-1;for(var o in n.$localStorage.recentBrowse)n.$localStorage.recentBrowse[o].type===t&&n.$localStorage.recentBrowse[o].idCode===i&&(r=o);for(-1!==r&&n.$localStorage.recentBrowse.splice(r,1),n.$localStorage.recentBrowse.unshift({type:t,idCode:i,name:e});n.$localStorage.recentBrowse.length>5;)n.$localStorage.recentBrowse.pop()},i.modelValidate={steamBindingTokenId:function(t,e,n){return t?!0:(e[n]="SteamBindingTokenId cannot be empty.",!1)},idCode:function(t,e,n){return/^[A-Z0-9]{5}$/.test(t)?!0:(e[n]="Only 5 uppercase letters and digits are allowed in IdCode.",!1)},username:function(t,e,n){var r=i.byteLength(t);return 3>r||r>16?(e[n]="UserName should be 3-16 bytes.",!1):/^[0-9A-Za-z\u4E00-\u9FCC]+$/.test(t)?!0:(e[n]="Only digits, letters and Chinese characters are allowed in UserName.",!1)},password:function(t,e,n){return t.length<6?(e[n]="Passwords must be at least 6 characters.",!1):!0},gamerTag:function(t,e,n){return i.byteLength(t)>40?(e[n]="GamerTag should not be longer than 40 bytes.",!1):!0}},i.modelErrorDetect={steamBindingTokenId:function(t){return/cannot be empty/.test(t)?"empty":"unknown"},idCode:function(t){return/Only.*allowed/.test(t)?"format":/already used/.test(t)?"used":"unknown"},username:function(t){return/should.*bytes/.test(t)?"length":/Only.*allowed/.test(t)?"format":/already.*used/.test(t)?"used":"unknown"},password:function(t){return/least.*characters/.test(t)?"length":/not correct/.test(t)?"incorrect":/cannot be empty/.test(t)?"empty":"unknown"},email:function(t){return/already taken/.test(t)?"used":/is invalid/.test(t)?"malformed":/cannot be empty/.test(t)?"empty":/doesn't exist/.test(t)?"inexistent":/locked out/.test(t)?"lockedout":/Login failed/.test(t)?"failed":"unknown"},gamerTag:function(t){return/not be longer than/.test(t)?"length":"unknown"}},i.escapeHtml=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},i.timelineLoadCount=20,i.timelineInsertDelay=150,i.firefoxLinkFix=function(t){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){var e=window.open($(t.currentTarget).attr("href"),"newwindow","width=300, height=250");e.close(),t.preventDefault()}}}return new i}]}})}(),function(){"use strict";keylolApp.factory("window",["$compile","$controller","$rootScope","$q","$window","$templateRequest","$timeout","$animate",function(t,e,n,i,r,o,s,a){function l(){var l,u=this,c=function(){var t=document.createElement("div");t.className="scrollbar-measure",$(document.body).append(t);var e=t.offsetWidth-t.clientWidth;return $(t).remove(),e},d=function(){var t=$(document.body);if(t.find("> window").length>0){if(!t.hasClass("body-window-open")){l=document.body.style.paddingRight||"";var e=r.innerWidth;if(!e){var n=document.documentElement.getBoundingClientRect();e=n.right-Math.abs(n.left)}if(document.body.clientWidth<e){var i=parseInt(t.css("padding-right")||0,10);t.css("padding-right",i+c()+"px")}t.addClass("body-window-open")}}else t.hasClass("body-window-open")&&(t.css("padding-right",l),t.removeClass("body-window-open"))};u.show=function(r){r=$.extend({adjustScrollBar:!0},r);var l=i.defer(),u=r.controller;r.controllerAs&&(u=u+" as "+r.controllerAs);var c=function(o){var c=n.$new(),f=t(o),h=f(c);r.styles&&h.css(r.styles);var p=i.defer(),m=function(t){p.resolve(t),a.leave(h).then(function(){c.$destroy(),r.adjustScrollBar&&d()})},g={$scope:c,$element:h,close:m};r.inputs&&$.extend(g,r.inputs);var v;u&&(v=e(u,g)),s(function(){a.enter(h,document.body,document.body.lastChild),r.adjustScrollBar&&d(),l.resolve({controller:v,scope:c,$element:h,close:p.promise,closeNow:m})})};return r.template?c(r.template):r.templateUrl&&o(r.templateUrl).then(function(t){c(t)}),l.promise}}return new l}])}(),function(t,e,n){"use strict";function i(e,n){return function(){n.apply(e,t.makeArray(arguments))}}function r(e,n){var r,o,s,a,l;for(r in e)if(e.hasOwnProperty(r)){if(o=e[r],!o.hubName)continue;l=n?o.on:o.off;for(s in o.client)if(o.client.hasOwnProperty(s)){if(a=o.client[s],!t.isFunction(a))continue;l.call(o,s,i(o,a))}}}if("function"!=typeof t.signalR)throw new Error("SignalR: SignalR is not loaded. Please ensure jquery.signalR-x.js is referenced before ~/signalr/js.");var o=t.signalR;t.hubConnection.prototype.createHubProxies=function(){var e={};return this.starting(function(){r(e,!0),this._registerSubscribedHubs()}).disconnected(function(){r(e,!1)}),e.debugInfoHub=this.createHubProxy("debugInfoHub"),e.debugInfoHub.client={},e.debugInfoHub.server={},e.steamBindingHub=this.createHubProxy("steamBindingHub"),e.steamBindingHub.client={},e.steamBindingHub.server={createToken:function(){return e.steamBindingHub.invoke.apply(e.steamBindingHub,t.merge(["CreateToken"],t.makeArray(arguments)))}},e.steamLoginHub=this.createHubProxy("steamLoginHub"),e.steamLoginHub.client={},e.steamLoginHub.server={createToken:function(){return e.steamLoginHub.invoke.apply(e.steamLoginHub,t.merge(["CreateToken"],t.makeArray(arguments)))}},e},o["new"]=function(){var n=t.hubConnection(e.apiEndpoint+"signalr",{useDefaultPath:!1});return t.extend(n,n.createHubProxies()),n}}(window.jQuery,window),function(){"use strict";keylolApp.controller("ActionHubController",["$scope","union","window",function(t,e,n){t.union=e,t.showRegistrationWindow=function(){n.show({templateUrl:"components/windows/registration.html",controller:"RegistrationController"})},t.showLoginSteamWindow=function(){n.show({templateUrl:"components/windows/login-steam.html",controller:"LoginSteamController"})},t.showSettingsWindow=function(){n.show({templateUrl:"components/windows/settings.html",controller:"SettingsController"})}}])}(),function(){"use strict";keylolApp.controller("ArticleCommentsController",["$scope","union","$http","utils","getAndFlushComments","notification",function(t,e,n,i,r,o){t.comments=e.comments,t.article=e.article,t.hotComments=e.hotComments,t.user=e.$localStorage.user,t.pageElements=e.pageElements,t.textFocus=!1,t.submitDisabled=!1,t.doComment=function(){if(t.currentComment){t.submitDisabled=!0;var i=s(t.currentComment);n.post(apiEndpoint+"comment",{Content:t.currentComment,ArticleId:e.article.Id,ReplyToCommentsSN:i}).then(function(n){o.success("评论已发出"),t.submitDisabled=!1,t.currentComment="";var i=n.data.SequenceNumberForArticle;r(e.article,i,"sequence")},function(e){o.error("评论发送失败",e),t.submitDisabled=!1})}},t.reply=function(e){t.currentComment?""==t.currentComment?t.currentComment+="#"+e+" ":t.currentComment+="\n#"+e+" ":t.currentComment="#"+e+" ",t.textFocus=!0},t.acknowledge=function(t){n.post(apiEndpoint+"like",{TargetId:t.Id,Type:"CommentLike"}).then(function(){o.success("认可已生效")},function(t){o.error("认可评论失败",t)}),t.Liked=!0,t.hasLike=!0,t.LikeCount+=1},t.cancelAcknowledge=function(t){n["delete"](apiEndpoint+"like",{params:{targetId:t.Id,type:"CommentLike"}}).then(function(){o.success("此认可已被撤销")},function(t){o.error("取消认可评论失败",t)}),t.Liked=!1,t.LikeCount-=1,t.LikeCount<=0&&(t.hasLike=!1)};var s=function(t){var n=/^((?:#\d+[ \t]*)+)(?:$|[ \t]+)/gm,r=/(\d+)/g,o=t.match(n),s=[];return o&&(s=o.length>1?o.reduce(function(t,e){return"string"==typeof t&&(t=t.match(r)),e=e.match(r),t.concat(e)}):o[0].match(r)),s=i.arrayUnique(s).map(function(t){return parseInt(t)}),s.length>1?s.reduce(function(t,n){return"number"==typeof t&&(t=[t]),n>e.article.totalComments?t:(t.push(n),t)}):1==s.length&&s[0]>e.article.totalComments?[]:s}}])}(),function(){"use strict";keylolApp.controller("ArticleContentController",["$scope","union","$http","notification",function(t,e,n,i){t.article=e.article,t.acknowledge=function(){n.post(apiEndpoint+"like",{TargetId:t.article.Id,Type:"ArticleLike"}).then(function(t){i.success("认可已生效")},function(t){i.error("认可失败",t)}),t.article.Liked=!0,t.article.hasLike=!0,t.article.LikeCount+=1},t.cancelAcknowledge=function(){n["delete"](apiEndpoint+"like",{params:{targetId:t.article.Id,type:"ArticleLike"}}).then(function(t){i.success("此认可已被撤销")},function(t){i.error("取消认可失败",t)}),t.article.Liked=!1,t.article.LikeCount-=1,t.article.LikeCount<=0&&(t.article.hasLike=!1)}}])}(),function(){"use strict";keylolApp.controller("ArticleHeaderController",["$scope","union","window",function(t,e,n){t.article=e.article,t.editArticle=function(){n.show({templateUrl:"components/windows/editor.html",controller:"EditorController",inputs:{vm:t.article}})}}])}(),function(){"use strict";keylolApp.controller("MainNavigationController",["$scope",function(t){t.categories=[{name:"游戏",items:[{name:"刀塔",url:"test"},{name:"晶体管",url:"test"},{name:"使命召唤：现代战争",url:"test"},{name:"战地：硬仗",url:"test"},{name:"军团要塞2",url:"test"}]},{name:"类型",items:[{name:"第一人称射击",url:"test"},{name:"模拟经营",url:"test"},{name:"MOBA",url:"test"},{name:"即时战略",url:"test"},{name:"沙盒",url:"test"}]},{name:"厂商",items:[{name:"威乐",url:"test"},{name:"艺电",url:"test"},{name:"育碧",url:"test"},{name:"Rockstar",url:"test"},{name:"动视",url:"test"}]},{name:"平台",items:[{name:"Steam",url:"test"},{name:"Origin",url:"test"},{name:"PS4",url:"test"},{name:"XBOX1",url:"test"},{name:"3DS",url:"test"}]}]}])}(),function(){"use strict";keylolApp.controller("PointVotesController",["$scope","union",function(t,e){t.point=e.point}])}(),function(){"use strict";keylolApp.controller("PromotedReadingsController",["$scope","$http","apiEndpoint","union",function(t,e,n,i){t.articles=i.$localStorage.promotedReadings,e.get(n+"article/hot").then(function(e){i.$localStorage.promotedReadings=t.articles=e.data})}])}(),function(){"use strict";keylolApp.controller("ReceptionController",["$scope","$http","notification","union","$routeParams",function(t,e,n,i,r){t.quickLinks=[],t.recentLinks=[],$.extend(t.recentLinks,i.$localStorage.recentBrowse);var o=function(e){$.extend(t.quickLinks,e),t.canBeAdd=t.quickLinks.length<5;for(var n in t.quickLinks)switch(t.quickLinks[n].Type){case"Unknown":break;case"NormalPoint":r.pointIdCode===t.quickLinks[n].IdCode&&(t.canBeAdd=!1);break;case"ProfilePoint":r.userIdCode===t.quickLinks[n].IdCode&&(t.canBeAdd=!1)}};i.$localStorage.favorites&&o(i.$localStorage.favorites),e.get(apiEndpoint+"favorite").then(function(t){i.$localStorage.favorites=t.data,o(t.data)},function(t){n.error("未知错误",t)}),t.deleteFavorite=function(i){var o=t.quickLinks[i];e["delete"](apiEndpoint+"favorite/"+o.Id).then(function(){"Unknown"===o.Type||r.pointIdCode!==o.IdCode&&r.userIdCode!==o.IdCode||(t.canBeAdd=!0)},function(t){n.error("未知错误",t)}),t.quickLinks.splice(i,1)},t.addFavorite=function(){r.pointIdCode&&i.point.Id?(t.canBeAdd=!1,e.post(apiEndpoint+"favorite",{},{params:{pointId:i.point.Id}}).then(function(e){t.quickLinks.push({Id:e.data,Type:"NormalPoint",IdCode:i.point.IdCode,Name:i.point.mainName})},function(e){n.error("未知错误",e),t.canBeAdd=!0})):r.userIdCode&&i.user.Id&&(t.canBeAdd=!1,e.post(apiEndpoint+"favorite",{},{params:{pointId:i.user.Id}}).then(function(e){t.quickLinks.push({Id:e.data,Type:"ProfilePoint",IdCode:i.user.IdCode,Name:i.user.UserName})},function(e){n.error("未知错误",e),t.canBeAdd=!0}))},t.deleteRecentBroswe=function(){i.$localStorage.recentBrowse=[],t.recentLinks=[]}}])}(),function(){"use strict";keylolApp.controller("RelatedPointsController",["$scope","union","utils",function(t,e,n){t.union=e,t.utils=n}])}(),function(){"use strict";keylolApp.controller("SearchBoxController",["$scope","union","$timeout","$location",function(t,e,n,i){t.onSearching=function(){var n="";for(var r in e.searchFilter)e.searchFilter[r].active&&(n=e.searchFilter[r].type);t.searchText&&i.url("search/"+n+"/"+encodeURIComponent(t.searchText))};var r=!1,o={onSearching:t.onSearching},s=function(e){r=!0,t.showSearchSelector({templateUrl:"components/popup/search-selector.html",controller:"SearchSelectorController",attachSide:"bottom",event:e,align:"right",inputs:{options:o}}).then(function(t){return t.close}).then(function(){r=!1})};t.getSearchResults=function(e){var n="";void 0!==t.searchText&&(n=t.searchText),o.searchText=n,r||s($.extend(e,{type:"click",acceptCurrentTarget:!0}))},t.$watch("searchText",function(){t.delayGetResult&&n.cancel(t.delayGetResult),void 0!==t.searchText&&(t.delayGetResult=n(function(){o.searchText=t.searchText},200))}),e.searchFilter=[{type:"point",text:"据点",active:!0},{type:"article",text:"文章"},{type:"user",text:"用户"}]}])}(),function(){"use strict";keylolApp.controller("SecretTestsController",["$scope","window",function(t,e){t.showCreatePointWindow=function(){e.show({templateUrl:"components/windows/create-point.html",controller:"CreatePointController",inputs:{vm:null}})},t.showPointListWindow=function(){e.show({templateUrl:"components/windows/point-list.html",controller:"PointListController"})}}])}(),function(){"use strict";keylolApp.controller("SpotlightBannerController",["$scope","notification",function(t,e){t.notification=e}])}(),function(){"use strict";keylolApp.controller("SummaryController",["$scope","union","$http","notification",function(t,e,n,i){t.data=e.summary,t.subscribeDisabled=!1,t.subscribe=function(r){t.subscribeDisabled=!0,n.post(apiEndpoint+"user-point-subscription",{},{params:{pointId:r}}).then(function(){i.success("据点已订阅，其今后收到的文章投稿将推送到你的首页"),t.data.subscribed=!0,t.subscribeDisabled=!1,t.data.pointSum.readerNum++,e.$localStorage.user.SubscribedPointCount++},function(t){i.error("未知错误",t)})},t.unsubscribe=function(r){t.subscribeDisabled=!0,i.attention("退订并不再接收此据点的文章推送",[{action:"退订",value:!0},{action:"取消"}]).then(function(o){o?n["delete"](apiEndpoint+"user-point-subscription",{params:{pointId:r}}).then(function(){i.success("据点已退订"),t.data.subscribed=!1,t.data.pointSum.readerNum--,e.$localStorage.user.SubscribedPointCount--},function(t){i.error("未知错误",t)})["finally"](function(){t.subscribeDisabled=!1}):t.subscribeDisabled=!1})}}])}(),function(){"use strict";keylolApp.controller("TimelineController",["$scope","union","$location","$http","$rootScope","$element","articleTypes","notification","utils","$timeout",function(t,e,n,i,r,o,s,a,l,u){function c(n){t.data.loadingLock=!0;for(var i="",r=0;r<s.length;r++)f[r]&&(0!==r&&(i+=","),i+=s[r].name);if(i){var o=2147483647;n&&(o=t.data.entries[t.data.entries.length-1].sequenceNumber),t.data.loadAction({idType:"IdCode",articleTypeFilter:i,publishOnly:t.data.publishOnly,take:l.timelineLoadCount,beforeSN:o},function(i){var r=i.data;n||(t.data.entries.length=0),t.data.noMoreArticle=r.length<l.timelineLoadCount;var o;for(var s in r){var a=r[s];a.Author||(a.Author=e.user);var c={types:[a.TypeName],author:{username:a.Author.UserName,avatarUrl:a.Author.AvatarImage,idCode:a.Author.IdCode},sequenceNumber:a.SequenceNumber,sources:{},datetime:a.PublishTime,title:a.Title,summary:a.Content,thumbnail:a.ThumbnailImage,url:"/article/"+a.Author.IdCode+"/"+a.SequenceNumberForAuthor,count:{like:a.LikeCount,comment:a.CommentCount}};switch(a.TimelineReason){case"Like":if(c.sources.type="like",c.sources.userArray=[],a.LikeByUsers)for(var d in a.LikeByUsers)c.sources.userArray.push({name:a.LikeByUsers[d].UserName,idCode:a.LikeByUsers[d].IdCode});else c.sources.userArray.push({name:e.$localStorage.user.UserName,idCode:e.$localStorage.user.IdCode});break;case"Point":c.sources.type="point",c.sources.points=[];for(var f in a.AttachedPoints)c.sources.points.push({name:a.AttachedPoints[f][a.AttachedPoints[f].PreferredName+"Name"],idCode:a.AttachedPoints[f].IdCode});break;case"Publish":c.sources.type="publish"}!function(e){o?o=o.then(function(){return t.data.entries.push(e),u(function(){},l.timelineInsertDelay)}):(t.data.entries.push(e),o=u(function(){},l.timelineInsertDelay))}(c)}o?o.then(function(){t.data.loadingLock=!1}):t.data.loadingLock=!1})}else t.data.entries.length=0,t.data.noMoreArticle=!0}t.headingDisplayMode=function(t){return t.source?"source":"title"},t.data=e.timeline,t.clickToSearch=function(){var t=$(".search-box input");t.focus(),t.hasClass("highlight")&&(t.removeClass("highlight"),t[0].offsetWidth),t.addClass("highlight")},t.clickTheBox=function(t){n.url(t.url)},t.ignore=function(e){t.data.entries.splice(t.data.entries.indexOf(e),1),i.put(apiEndpoint+"like/"+e.id,{},{params:{ignore:!0}}).then(function(){a.success("移除记录成功")},function(t){a.error("移除记录失败",t)})},t.noMoreRemind=function(t){t.commentId?i.put(apiEndpoint+"comment/"+t.commentId+"/ignore",{},{params:{ignore:!0}}).then(function(){a.success("评论认可不再提醒成功")},function(t){a.error("评论认可不再提醒失败",t)}):i.put(apiEndpoint+"article/"+t.fromArticle.Id+"/ignore",{},{params:{ignore:!0}}).then(function(){a.success("文章认可不再提醒成功")},function(t){a.error("文章认可不再提醒失败",t)})},t.loadingLock=!1,$(window).scroll(function(){var e=$(window).scrollTop()+$(window).height(),n=o.offset().top+o.height();t.$apply(function(){e>n-60&&!t.data.loadingLock&&!t.data.noMoreArticle&&(t.data.hasExpand?c(!0):t.data.loadAction())})});var d=t.$on("$destroy",function(){$(window).unbind("scroll"),d()});t.expanded=!1;for(var f=[],h=0;h<s.length;++h)f.push(!0);t.expand=function(e){t.expanded=!t.expanded,t.showFilter({templateUrl:"components/popup/entry-filter.html",controller:"EntryFilterController",event:e,attachSide:"bottom",align:"right",offsetX:5,inputs:{types:s,selectedIndexes:f}}).then(function(t){return t.close}).then(function(e){t.expanded=!t.expanded,e&&(f=e,c())})},t.filterText=function(){for(var t=[],e=[],n=0;n<f.length;n++)f[n]?t.push(n):e.push(n);var i;if(t.length==s.length)i="全部";else if(t.length>=Math.floor(s.length/2)+1){i="不看";for(var r in e)i+="『"+s[e[r]].name+"』"}else if(e.length==s.length)i="全部不看";else{i="只看";for(var o in t)i+="『"+s[t[o]].name+"』"}return i},t.subscribe=function(t){t.subscribeDisabled=!0,i.post(apiEndpoint+"user-point-subscription",{},{params:{pointId:t.id}}).then(function(){a.success("据点已订阅，其今后收到的文章投稿将推送到你的首页"),t.subscribed=!0,t.subscribeDisabled=!1,t.pointInfo.reader++,e.$localStorage.user.SubscribedPointCount++},function(t){a.error("未知错误",t)})},t.unsubscribe=function(n){n.subscribeDisabled=!0,a.attention("退订并不再接收此据点的文章推送",[{action:"退订",value:!0},{action:"取消"}]).then(function(r){r?i["delete"](apiEndpoint+"user-point-subscription",{params:{pointId:n.id}}).then(function(){a.success("据点已退订"),n.subscribed=!1,n.pointInfo.reader--,e.$localStorage.user.SubscribedPointCount--},function(t){a.error("未知错误",t)})["finally"](function(){t.subscribeDisabled=!1}):n.subscribeDisabled=!1})}}])}(),
function(){"use strict";keylolApp.controller("AlphaInvitationController",["$scope","close","window","$http","apiEndpoint","notification","union",function(t,e,n,i,r,o,s){t.vm={InvitationCode:""},t.cancel=function(){e()},t.switchToLoginWindow=function(){n.show({templateUrl:"components/windows/login-steam.html",controller:"LoginSteamController"}),e()},t.getInvitationCode=function(){e(),$("body").animate({scrollTop:$("#get-invitation-code").offset().top},3e3)};var a=!1;t.submit=function(){return a?void 0:(a=!0,t.invitationCodeError=null,t.vm.InvitationCode?void i.get(r+"invitation-code/"+t.vm.InvitationCode).then(function(){s.invitationCode=t.vm.InvitationCode,n.show({templateUrl:"components/windows/registration.html",controller:"RegistrationController"}),e()},function(e){404===e.status?t.invitationCodeError="invalid":o.error("未知错误",e),a=!1}):(t.invitationCodeError="empty",void(a=!1)))}}])}(),function(){"use strict";keylolApp.controller("CreatePointController",["$scope","close","$http","apiEndpoint","utils","notification","vm",function(t,e,n,i,r,o,s){t.radioId=[];for(var a=0;6>a;++a)t.radioId.push(r.uniqueId());var l=function(){s?(t.vm=$.extend({},s),t.inline={avatarImageFull:"https://keylol.b0.upaiyun.com/"+s.AvatarImage.match(/keylol:\/\/avatars\/(.*)/i)[1],backgroundImageFull:"https://keylol.b0.upaiyun.com/"+s.BackgroundImage,associatedPoints:s.AssociatedPoints}):(t.vm={Type:"Game",ChineseName:"",EnglishName:"",PreferredName:"Chinese",ChineseAliases:"",EnglishAliases:"",IdCode:"",StoreLink:""},t.inline={avatarImageFull:"",backgroundImageFull:"",associatedPoints:[]})};l(),t.cancel=function(){e()},t.$watchCollection("inline.associatedPoints",function(e){if(t.vm.AssociatedPointsId=[],e)for(var n=0;n<e.length;++n)t.vm.AssociatedPointsId.push(e[n].Id)});var u=!1;t.submit=function(){if(!u){u=!0;var r=/^(?:http:|https:)?\/\/keylol\.b0\.upaiyun\.com\/(.*?)(?:!.*)?$/i,a=t.inline.avatarImageFull.match(r);if(!a)return o.error("据点头像输入有误，请检查"),void(u=!1);t.vm.AvatarImage="keylol://avatars/"+a[1];var c=t.inline.backgroundImageFull.match(r);if(!c)return o.error("据点背景图输入有误，请检查"),void(u=!1);if(t.vm.BackgroundImage=c[1],"Game"===t.vm.Type&&!/^http:\/\/store\.steampowered\.com\/app\/(\d+)\//i.test(t.vm.StoreLink))return o.error("商店链接输入有误，请检查"),void(u=!1);t.vm.IdCode=t.vm.IdCode.toUpperCase(),s?n.put(i+"normal-point/"+t.vm.Id,t.vm).then(function(){o.success("据点编辑成功"),$.extend(s,t.vm),e()},function(t){400===t.status?o.error(t.data):404===t.status&&o.error("指定据点不存在"),u=!1}):n.post(i+"normal-point",t.vm).then(function(){o.success("据点创建成功"),u=!1,l()},function(t){400===t.status?o.error(t.data):o.error("未知错误",t),u=!1})}}}])}(),function(){"use strict";keylolApp.controller("EditorController",["$scope","close","utils","$http","union","$timeout","$location","notification","vm","articleTypes","$route",function(t,e,n,i,r,o,s,a,l,u,c){t.radioId=[n.uniqueId(),n.uniqueId(),n.uniqueId()],t.articleTypes=u,t.expanded=!1,t.lastSaveTime=null,t.inline={},t.selectedTypeIndex=0,r.$localStorage.editorDrafts||(r.$localStorage.editorDrafts={});var d=l?l.Id:"new",f=r.$localStorage.editorDrafts[d];if(f)t.vm=f.vm,t.lastSaveTime=f.time,t.inline.attachedPoints=f.attachedPoints,t.inline.voteForPoints=f.voteForPoints,t.selectedTypeIndex=f.selectedTypeIndex,a.success("本地草稿已加载");else{if(t.vm=$.extend({},l)||{Title:"",Content:"",Vote:null},t.vm.TypeName)for(var h=0;h<u.length;++h)if(u[h].name===t.vm.TypeName){t.selectedTypeIndex=h;break}t.vm.AttachedPoints&&(t.inline.attachedPoints=t.vm.AttachedPoints),t.vm.VoteForPointId&&(t.inline.voteForPoints=[{Id:t.vm.VoteForPointId,Name:t.vm.VoteForPointName}])}t.$watchCollection("inline.attachedPoints",function(e){if(t.vm.AttachedPointsId=[],e)for(var n=0;n<e.length;++n)t.vm.AttachedPointsId.push(e[n].Id)}),t.$watchCollection("inline.voteForPoints",function(e){t.vm.VoteForPointId=null,e&&e.length>0&&(t.vm.VoteForPointId=e[0].Id)}),t.$watch("selectedTypeIndex",function(e){t.vm.TypeName=u[e].name});var p;t.saveDraft=function(){o.cancel(p),t.lastSaveTime=moment(),r.$localStorage.editorDrafts[d]={vm:t.vm,time:t.lastSaveTime,selectedTypeIndex:t.selectedTypeIndex,attachedPoints:t.inline.attachedPoints,voteForPoints:t.inline.voteForPoints},p=o(t.saveDraft,3e4)},p=o(t.saveDraft,3e4),t.expand=function(e){t.expanded=!t.expanded,t.inline.showSelector({templateUrl:"components/popup/article-type-selector.html",controller:"ArticleTypeSelectorController",event:e,attachSide:"bottom",align:"left",offsetX:-6,inputs:{selectedIndex:t.selectedTypeIndex}}).then(function(t){return t.close}).then(function(e){t.expanded=!t.expanded,angular.isUndefined(e)||(t.selectedTypeIndex=e)})},t.cancel=function(){a.attention("关闭文章编辑器需要额外确认",[{action:"关闭",value:!0},{action:"取消"}]).then(function(n){n&&(t.saveDraft(),o.cancel(p),e())})};var m=!1;t.submit=function(){if(!m){if(m=!0,t.vm.AttachedPointsId.length>5)return a.attention("不能同时投稿多于5个据点"),void(m=!1);if(t.vm.Id){var n={};for(var u in t.vm)if("AttachedPointsId"!==u)t.vm.hasOwnProperty(u)&&t.vm[u]!=l[u]&&t.vm[u]!=l[u]&&(n[u]=t.vm[u]);else{for(var f=[],h=0;h<l.AttachedPoints.length;++h)f.push(l.AttachedPoints[h].Id);JSON.stringify(t.vm.AttachedPointsId)!=JSON.stringify(f)&&(n.AttachedPointsId=t.vm.AttachedPointsId)}if($.isEmptyObject(n))return delete r.$localStorage.editorDrafts[d],o.cancel(p),e(),void a.success("文章已发布");n.AttachedPointsId=t.vm.AttachedPointsId,n.VoteForPointId=t.vm.VoteForPointId,n.Vote=t.vm.Vote,i.put(apiEndpoint+"article/"+t.vm.Id,n).then(function(){delete r.$localStorage.editorDrafts[d],o.cancel(p),e(),c.reload(),a.success("文章已发布")},function(t){a.error("未知错误, 请尝试再次发布",t),m=!1})}else i.post(apiEndpoint+"article",t.vm).then(function(t){delete r.$localStorage.editorDrafts[d],o.cancel(p),e(),s.url("article/"+r.$localStorage.user.IdCode+"/"+t.data.SequenceNumberForAuthor),a.success("文章已发布")},function(t){a.error("未知错误, 请尝试再次发布",t),m=!1})}}}])}(),function(){"use strict";keylolApp.controller("LoginPasswordController",["$scope","close","$http","utils","union","apiEndpoint","window","notification","$element","$timeout",function(t,e,n,i,r,o,s,a,l,u){t.error={},t.errorDetect=i.modelErrorDetect,t.vm={EmailOrIdCode:"",Password:"",GeetestChallenge:"",GeetestSeccode:"",GeetestValidate:""};var c,d=i.createGeetest("float");t.geetestId=d.id,d.ready.then(function(t){u(function(){var e=$("#geetest-"+d.id,l);t.appendTo(e)})});var f=function(e){c=e.getValidate(),t.vm.GeetestChallenge=c.geetest_challenge,t.vm.GeetestSeccode=c.geetest_seccode,t.vm.GeetestValidate=c.geetest_validate};d.success.then(f),t.cancel=function(){e()},t.switchToLoginSteamWindow=function(){s.show({templateUrl:"components/windows/login-steam.html",controller:"LoginSteamController"}),e()};var h=!1;t.submit=function(){return h?void 0:(h=!0,t.error={},t.vm.EmailOrIdCode||(t.error["vm.EmailOrIdCode"]="Email or UIC cannot be empty."),t.vm.Password||(t.error["vm.Password"]="Password cannot be empty."),c||(t.error.authCode=!0),$.isEmptyObject(t.error)?void n.post(o+"login",t.vm).then(function(t){r.$localStorage.login=t.data,a.success("登录成功，欢迎回到其乐"),e()},function(e){switch(e.status){case 400:t.error=e.data.ModelState,c=null,d.refresh().then(f);break;default:a.error("未知错误",e)}h=!1}):void(h=!1))}}])}(),function(){"use strict";keylolApp.controller("LoginSteamController",["$scope","close","$http","apiEndpoint","window","union","$timeout","notification","utils",function(t,e,n,i,r,o,s,a,l){var u,c=$.connection["new"](),d=c.steamLoginHub;t.currentStation=0,t.utils=l,t.cancel=function(){e(),c.stop()},t.switchToLoginPasswordWindow=function(){r.show({templateUrl:"components/windows/login-password.html",controller:"LoginPasswordController"}),t.cancel()},d.client.NotifyCodeReceived=function(){t.$apply(function(){t.currentStation=1,n.post(i+"login/token/"+u,null).then(function(n){t.currentStation=2,o.$localStorage.login=n.data,c.stop(),s(function(){a.success("登录成功，欢迎回到其乐"),e()},1500)},function(t){a.error("未知错误",t)})})},c.start().then(function(){d.server.createToken().then(function(e){t.$apply(function(){u=e.Id,t.code=e.Code})})},function(){a.error("连接失败"),t.cancel()})}])}(),function(){"use strict";keylolApp.controller("PointListController",["$scope","close","$http","apiEndpoint","notification","window",function(t,e,n,i,r,o){t.cancel=function(){e()},t.inline={onPageChange:function(e){var o=20;n.get(i+"normal-point/list",{params:{skip:o*(e-1),take:o}}).then(function(n){t.inline.totalPages=Math.ceil(n.headers("X-Total-Record-Count")/o),t.inline.currentPage=e,t.points=n.data},function(t){r.error("未知错误",t)})},editPoint:function(t){o.show({templateUrl:"components/windows/create-point.html",controller:"CreatePointController",inputs:{vm:t}})}},t.inline.onPageChange(1)}])}(),function(){"use strict";keylolApp.controller("RegistrationController",["$scope","close","$http","utils","union","apiEndpoint","window","notification","$element","$timeout",function(t,e,n,i,r,o,s,a,l,u){t.vm={IdCode:"",UserName:"",Password:"",SteamBindingTokenId:"",AvatarImage:"",SteamProfileName:"",GeetestChallenge:"",GeetestSeccode:"",GeetestValidate:"",InvitationCode:r.invitationCode};var c,d,f=i.createGeetest("float");t.geetestId=f.id,f.ready.then(function(t){u(function(){var e=$("#geetest-"+f.id,l);t.appendTo(e)})});var h=function(e){d=e.getValidate(),t.vm.GeetestChallenge=d.geetest_challenge,t.vm.GeetestSeccode=d.geetest_seccode,t.vm.GeetestValidate=d.geetest_validate};f.success.then(h),t.error={},t.errorDetect=i.modelErrorDetect,t.cancel=function(){e(),c&&c.resolve()},t.showSteamConnectWindow=function(){s.show({templateUrl:"components/windows/steam-connect.html",controller:"SteamConnectController"}).then(function(e){e.close.then(function(e){e?(c=e.consume,t.vm.SteamBindingTokenId=e.tokenId,t.vm.SteamProfileName=e.steamProfileName,t.vm.AvatarImage="steam://avatars/"+e.steamAvatarHash):t.vm.SteamBindingTokenId=""})})},t.discardBinding=function(){t.vm.SteamBindingTokenId="",c&&c.resolve()};var p=!1;t.submit=function(){return p?void 0:(p=!0,t.error={},t.vm.IdCode=t.vm.IdCode.toUpperCase(),i.modelValidate.steamBindingTokenId(t.vm.SteamBindingTokenId,t.error,"vm.SteamBindingTokenId"),i.modelValidate.idCode(t.vm.IdCode,t.error,"vm.IdCode"),i.modelValidate.username(t.vm.UserName,t.error,"vm.UserName"),i.modelValidate.password(t.vm.Password,t.error,"vm.Password"),d||(t.error.authCode=!0),$.isEmptyObject(t.error)?void n.post(o+"user",t.vm).then(function(t){r.$localStorage.login=t.data,e(),c&&c.resolve()},function(e){switch(e.status){case 400:t.error=e.data.ModelState,d=null,f.refresh().then(h);break;default:a.error("未知错误",e)}p=!1}):void(p=!1))}}])}(),function(){"use strict";keylolApp.controller("SettingsController",["$scope","close","utils","$http","union","apiEndpoint","base64","Upload","$q","notification","$element","$timeout",function(t,e,n,i,r,o,s,a,l,u,c,d){t.error={},t.errorDetect=n.modelErrorDetect,t.page="profiles",t.uniqueIds={};for(var f=0;22>f;++f)t.uniqueIds[f]=n.uniqueId();t.union=r,t.files={},t.vm={ProfilePointBackgroundImage:"",Password:"",NewPassword:"",ConfirmPassword:""};var h={},p=function(e){$.extend(t.vm,{GamerTag:e.GamerTag,AvatarImage:e.AvatarImage,Email:e.Email,ProfilePointBackgroundImage:e.ProfilePointBackgroundImage,AutoShareOnAcquiringNewGame:e.AutoShareOnAcquiringNewGame,AutoShareOnAddingFavorite:e.AutoShareOnAddingFavorite,AutoShareOnAddingNewFriend:e.AutoShareOnAddingNewFriend,AutoShareOnAddingVideo:e.AutoShareOnAddingVideo,AutoShareOnCreatingGroup:e.AutoShareOnCreatingGroup,AutoShareOnJoiningGroup:e.AutoShareOnJoiningGroup,AutoShareOnPublishingReview:e.AutoShareOnPublishingReview,AutoShareOnUnlockingAchievement:e.AutoShareOnUnlockingAchievement,AutoShareOnUpdatingWishlist:e.AutoShareOnUpdatingWishlist,AutoShareOnUploadingScreenshot:e.AutoShareOnUploadingScreenshot,LockoutEnabled:e.LockoutEnabled,EmailNotifyOnAdvertisement:e.EmailNotifyOnAdvertisement,EmailNotifyOnArticleReplied:e.EmailNotifyOnArticleReplied,EmailNotifyOnCommentReplied:e.EmailNotifyOnCommentReplied,EmailNotifyOnEditorRecommended:e.EmailNotifyOnEditorRecommended,EmailNotifyOnMessageReceived:e.EmailNotifyOnMessageReceived,MessageNotifyOnArticleLiked:e.MessageNotifyOnArticleLiked,MessageNotifyOnArticleReplied:e.MessageNotifyOnArticleReplied,MessageNotifyOnCommentLiked:e.MessageNotifyOnCommentLiked,MessageNotifyOnCommentReplied:e.MessageNotifyOnCommentReplied,MessageNotifyOnEditorRecommended:e.MessageNotifyOnEditorRecommended,SteamId:e.SteamId,SteamId64:e.SteamId64,SteamProfileName:e.SteamProfileName,StatusClaim:e.StatusClaim,StaffClaim:e.StaffClaim}),$.extend(h,t.vm)},m=function(e){return t.vm[e]!==h[e]};p(r.$localStorage.user),i.get(o+"user/"+r.$localStorage.login.UserId,{params:{includeClaims:!0,includeSecurity:!0,includeProfilePointBackgroundImage:!0,includeSteam:!0,includeSteamBot:!0,includeMoreOptions:!0}}).then(function(t){var e=t.data;p(e),$.extend(r.$localStorage.user,e)});var g,v=n.createGeetest("float");t.geetestId=v.id,v.ready.then(function(t){d(function(){var e=$("#geetest-"+v.id,c);t.appendTo(e)})});var y=function(e){g=e.getValidate(),t.vm.GeetestChallenge=g.geetest_challenge,t.vm.GeetestSeccode=g.geetest_seccode,t.vm.GeetestValidate=g.geetest_validate};v.success.then(y),t.cancel=function(){e()},t.setPage=function(e){t.page=e},t.optionsInPageChanged=function(t){var e=[];switch(t){case"profiles":e=["GamerTag","Email","AvatarImage","ProfilePointBackgroundImage"];break;case"platform":e=["AutoShareOnAcquiringNewGame","AutoShareOnAddingFavorite","AutoShareOnAddingNewFriend","AutoShareOnAddingVideo","AutoShareOnCreatingGroup","AutoShareOnJoiningGroup","AutoShareOnPublishingReview","AutoShareOnUnlockingAchievement","AutoShareOnUpdatingWishlist","AutoShareOnUploadingScreenshot"];break;case"security":e=["LockoutEnabled","EmailNotifyOnAdvertisement","EmailNotifyOnArticleReplied","EmailNotifyOnCommentReplied","EmailNotifyOnEditorRecommended","EmailNotifyOnMessageReceived","NewPassword"];break;case"preferences":e=["EmailNotifyOnAdvertisement","EmailNotifyOnArticleReplied","EmailNotifyOnCommentReplied","EmailNotifyOnEditorRecommended","EmailNotifyOnMessageReceived","MessageNotifyOnArticleLiked","MessageNotifyOnArticleReplied","MessageNotifyOnCommentLiked","MessageNotifyOnCommentReplied","MessageNotifyOnEditorRecommended"]}return e.some(function(t){return m(t)})},t.optionsInPageError=function(e){var n=[];switch(e){case"profiles":n=["vm.GamerTag","vm.Email"];break;case"platform":break;case"security":n=["vm.Password","vm.NewPassword","vm.ConfirmPassword","authCode"];break;case"preferences":}return n.some(function(e){return t.error[e]})};var b=function(){var e=["profiles","platform","security","preferences"];for(var n in e)if(e.hasOwnProperty(n)&&t.optionsInPageError(e[n])){t.page=e[n];break}},A=!1;t.submit=function(){if(!A){if(A=!0,t.error={},n.modelValidate.gamerTag(t.vm.GamerTag,t.error,"vm.GamerTag"),(m("NewPassword")||m("LockoutEnabled"))&&(t.vm.Password||(t.error["vm.Password"]="Password cannot be empty."),g||(t.error.authCode=!0),t.vm.NewPassword&&n.modelValidate.password(t.vm.NewPassword,t.error,"vm.NewPassword")&&t.vm.NewPassword!==t.vm.ConfirmPassword&&(t.error["vm.ConfirmPassword"]="not match")),m("Email")&&(form.email.$invalid?t.error["vm.Email"]="Email is invalid.":t.vm.Email||(t.error["vm.Email"]="Email cannot be empty.")),!$.isEmptyObject(t.error))return b(),void(A=!1);var c={};for(var d in t.vm)t.vm.hasOwnProperty(d)&&m(d)&&(c[d]=t.vm[d]);if(!t.files.avatarImage&&!t.files.profilePointBackgroundImage&&$.isEmptyObject(c))return u.success("个人设定已更新"),void e();var f=function(){i.put(o+"user/"+r.$localStorage.login.UserId,c).then(function(){$.extend(r.$localStorage.user,c),u.success("个人设定已更新"),e()},function(e){switch(e.status){case 400:t.error=e.data.ModelState,g=null,v.refresh().then(y),b();break;default:u.error("未知错误",e)}A=!1})};if(t.files.avatarImage||t.files.profilePointBackgroundImage){u.process("图像正在上传");var h={bucket:"keylol","save-key":"{filemd5}{.suffix}",expiration:Math.round((new Date).getTime()/1e3)+90,"content-length-range":"0,5242880"},p="//v0.api.upyun.com/keylol",C=s.encode(JSON.stringify(h));i.post(o+"upload-signature",null,{params:{policy:C}}).then(function(e){var n={};t.files.avatarImage&&(n.avatarImage=a.upload({url:p,data:{file:t.files.avatarImage,policy:C,signature:e.data},withCredentials:!1}),n.avatarImage.then(function(t){c.AvatarImage="keylol://avatars/"+t.data.url},function(){u.error("头像上传失败。"),A=!1})),t.files.profilePointBackgroundImage&&(n.profilePointBackgroundImage=a.upload({url:p,data:{file:t.files.profilePointBackgroundImage,policy:C,signature:e.data},withCredentials:!1}),n.profilePointBackgroundImage.then(function(t){c.ProfilePointBackgroundImage=t.data.url},function(){u.error("个人据点横幅上传失败。"),A=!1})),l.all(n).then(function(){f()})},function(){u.error("文件上传验证失效。"),A=!1})}else f()}},t.logout=function(){u.attention("从当前账户登出",[{action:"登出",value:!0},{action:"取消"}]).then(function(t){t&&i["delete"](o+"login/current").then(function(){delete r.$localStorage.login,u.success("已登出当前账户"),e()},function(t){u.error("未知错误",t)})})}}])}(),function(){"use strict";keylolApp.controller("SteamConnectController",["$scope","close","$timeout","$q","notification","utils",function(t,e,n,i,r,o){var s,a,l=!1,u=$.connection["new"](),c=u.steamBindingHub;t.utils=o,t.currentStation=0,t.cancel=function(){e(a),l=!0,a||u.stop()},c.client.NotifySteamFriendAdded=function(){t.$apply(function(){0===t.currentStation&&(t.currentStation=1)})},c.client.NotifyCodeReceived=function(r,o){t.$apply(function(){t.currentStation=2;var c=i.defer();c.promise["finally"](function(){u.stop()}),a={tokenId:s,steamProfileName:r,steamAvatarHash:o,consume:c},n(function(){t.currentStation=3,n(function(){l||(e(a),l=!0)},1500)},200)})},u.start().then(function(){c.server.createToken().then(function(e){t.$apply(function(){e?(s=e.Id,t.botSteamId64=e.BotSteamId64,t.code=e.Code):(r.error("暂无可用机器人。"),t.cancel())})})},function(){r.error("连接失败。"),t.cancel()})}])}();