<div class="section-article-comments box-shadowed" ng-class="{archive: article.TypeName === '封'}" ng-controller="ArticleCommentsController">
    <h1 class="labeled-heading">{{article.TypeName !== '封'?"共" + article.totalComments + "则讨论":"封存文章的评论会被自动隐藏"}}</h1>
    <div class="comment" ng-if="pageElements.currPage == 1 && hotComments.length > 0 && article.TypeName !== '封'" ng-repeat="comment in hotComments track by comment.Id" popup="comment.showModerationPopup">
        <span class="floor">#{{comment.SequenceNumberForArticle}}</span>
        <point-link ng-if="comment.Commentator" type="'user'" avatar-url="comment.Commentator.AvatarImage" id-code="comment.Commentator.IdCode"></point-link>
        <article ng-switch="comment.Commentator" ng-class="{archived: !comment.Commentator || comment.Archived !== 'None'}">
            <div class="header">
                <point-link ng-switch-default class="name" type="'user'" point-name="'@' + comment.Commentator.UserName" id-code="comment.Commentator.IdCode"></point-link>
                <!--<span class="as-author" ng-if="comment.Commentator.isAuthor">[文章作者]</span>-->
                <span ng-switch-when="undefined" class="title">这则评论已被封存</span>
                <span ng-switch-default ng-if="comment.Archived !== 'None'" class="moderated">封存中</span>
                <span ng-if="comment.Warned" class="moderated">受到警告</span>
                <span ng-switch-default class="time" am-time-ago="comment.PublishTime"></span>
                <span ng-switch-default class="action" ng-if="union.$localStorage.user">
                    <span ng-if="!comment.cannotLike && article.Archived === 'None' && comment.Archived === 'None'" ng-switch="comment.Liked">
                        <a href="" ng-click="acknowledge(comment)" ng-switch-when="false">认可</a>
                        <a href="" ng-click="cancelAcknowledge(comment)" ng-switch-when="true">取消认可</a>
                        |
                    </span>
                    <a href="" ng-click="reply(comment.SequenceNumberForArticle)">回复</a>
                    <span ng-if="union.$localStorage.user.StaffClaim === 'operator' || comment.cannotLike">
                        |
                        <a href="" ng-if="comment.Archived === 'None'" ng-click="moderateComment($event, comment, 'Archived')">封存</a>
                        <a ng-if="comment.Archived === 'User' || (comment.Archived === 'Operator' && union.$localStorage.user.StaffClaim === 'operator')" href="" ng-click="moderateComment($event, comment, 'Archived', true)">撤销封存</a>
                        <span ng-if="union.$localStorage.user.StaffClaim === 'operator'">
                            |
                            <a href="" ng-click="moderateComment($event, comment, 'Warned', comment.Warned)">{{comment.Warned?"撤销":""}}警告</a></span>
                    </span>
                </span>
            </div>
            <div ng-switch-default class="content"><span bind-html-compile="comment.Content"></span><span class="hot-signal">HOT</span><span class="like-count" ng-if="comment.hasLike">+{{comment.LikeCount}}</span></div>
            <div ng-switch-when="undefined" class="content"><span>封存后只有作者与站务职员可以看到评论内容与作者信息</span></div>
        </article>
    </div>
    <div class="cut-off" ng-if="pageElements.currPage == 1 && hotComments.length > 0 && article.TypeName !== '封'"></div>
    <div ng-if="article.TypeName !== '封'" class="comment" ng-repeat="comment in comments track by comment.Id" id="comment-{{comment.SequenceNumberForArticle}}" popup="comment.showModerationPopup">
        <span class="floor">#{{comment.SequenceNumberForArticle}}</span>
        <point-link ng-if="comment.Commentator" type="'user'" avatar-url="comment.Commentator.AvatarImage" id-code="comment.Commentator.IdCode"></point-link>
        <article ng-switch="comment.Commentator" ng-class="{archived: !comment.Commentator || comment.Archived !== 'None'}">
            <div class="header">
                <point-link ng-switch-default class="name" type="'user'" point-name="'@' + comment.Commentator.UserName" id-code="comment.Commentator.IdCode"></point-link>
                <!--<span class="as-author" ng-if="comment.Commentator.isAuthor">[文章作者]</span>-->
                <span ng-switch-when="undefined" class="title">这则评论已被封存</span>
                <span ng-switch-default ng-if="comment.Archived !== 'None'" class="moderated">封存中</span>
                <span ng-if="comment.Warned" class="moderated">受到警告</span>
                <span ng-switch-default class="time" am-time-ago="comment.PublishTime"></span>
                <span ng-switch-default class="action" ng-if="union.$localStorage.user">
                    <span ng-if="!comment.cannotLike && article.Archived === 'None' && comment.Archived === 'None'" ng-switch="comment.Liked">
                        <a href="" ng-click="acknowledge(comment)" ng-switch-when="false">认可</a>
                        <a href="" ng-click="cancelAcknowledge(comment)" ng-switch-when="true">取消认可</a>
                        |
                    </span>
                    <a href="" ng-click="reply(comment.SequenceNumberForArticle)">回复</a>
                    <span ng-if="union.$localStorage.user.StaffClaim === 'operator' || comment.cannotLike">
                        |
                        <a href="" ng-if="comment.Archived === 'None'" ng-click="moderateComment($event, comment, 'Archived')">封存</a>
                        <a ng-if="comment.Archived === 'User' || (comment.Archived === 'Operator' && union.$localStorage.user.StaffClaim === 'operator')" href="" ng-click="moderateComment($event, comment, 'Archived', true)">撤销封存</a>
                        <span ng-if="union.$localStorage.user.StaffClaim === 'operator'">
                            |
                            <a href="" ng-click="moderateComment($event, comment, 'Warned', comment.Warned)">{{comment.Warned?"撤销":""}}警告</a>
                        </span>
                    </span>
                </span>
            </div>
            <div ng-switch-default class="content"><span bind-html-compile="comment.Content"></span><span class="like-count" ng-if="comment.hasLike">+{{comment.LikeCount}}</span></div>
            <div ng-switch-when="undefined" class="content"><span>封存后只有作者与站务职员可以看到评论内容与作者信息</span></div>
        </article>
    </div>
    <pagination ng-if="article.TypeName !== '封'" total="pageElements.totalPages" current="pageElements.currPage" on-page-changed="pageElements.changePage(oldPage, newPage)" page-href=""></pagination>
    <form ng-if="union.$localStorage.user && article.TypeName !== '封'" ng-submit="doComment()">
        <point-link type="'user'" avatar-url="user.AvatarImage" id-code="user.IdCode"></point-link>
        <button type="submit" class="border-button right-border" ng-disabled="submitLock">发表评论</button>
        <div class="textarea-container"><textarea placeholder="对作者的见解有什么见解？" ng-model="comment.currentComment" focus-me="textFocus"></textarea></div>
    </form>
    <div class="for-visitor" ng-if="!union.$localStorage.user && article.TypeName !== '封'">
        <div class="avatar-anchor">
            <img class="avatar-small" webp-src="{{avatarUrl|avatarUrl}}" alt="头像">
        </div>
        <div class="textarea-container">
            <div class="fake-textarea">
                <div class="action-container">
                    <a class="log-up" href="" ng-click="showRegistrationWindow()">
                        <img src="assets/images/steam-logo.png">
                        <h4>通过 Steam 账户</h4>
                        <h3 class="font-myriad-keylol">加入其乐社区</h3>
                    </a>
                    <a href="" class="log-in" ng-click="showLoginSteamWindow()">已注册用户登录</a>
                </div>
            </div>
        </div>
    </div>
</div>