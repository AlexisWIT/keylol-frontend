<div class="section-timeline" ng-controller="TimelineController">
    <div class="heading inverse" ng-class="{hasRightButton: union.$localStorage.user && data.rightButton}">
        <a href="" ng-click="data.rightButton.clickAction()" class="right-button box-shadowed" ng-if="union.$localStorage.user && data.rightButton">
            <img ng-src="{{data.rightButton.avatar}}" alt="{{data.rightButton.alt}}">
            <span class="font-myriad-keylol">文</span>
        </a>
        <div class="left-info box-shadowed card" popup="showFilter">
            <svg xmlns="http://www.w3.org/2000/svg" class="card-line">
                <rect x="6" width="5" height="100%"></rect>
                <circle cx="8.5" cy="50%" r="6.5" class="inverse"></circle>
                <circle cx="8.5" cy="50%" r="4"></circle>
            </svg>
            <div class="title">
                <h1 class="font-myriad-keylol">{{data.title.mainTitle}}</h1>
                <h2 class="font-myriad-keylol">{{data.title.subTitle}}</h2>
            </div>
            <span class="expand-button" ng-switch="expanded"
                  ng-click="expand($event)" ng-class="{expanded: expanded}" ng-if="data.hasExpand">
                <a>{{filterText()}}</a><span ng-switch-when="false">▾</span><span ng-switch-when="true">▴</span>
            </span>
            <div class="actions">
                <a href="" ng-repeat="action in data.actions" ng-click="action.onClick()" ng-class="{active: action.active}">{{action.text}}</a>
            </div>
        </div>
    </div>
    <div class="default" ng-if="data.activePoints">
        <img src="assets/images/clipart.png" class="clipart">
        <div class="description">
            <h1 class="font-myriad-keylol">{{data.noArticleText.main}}</h1>
            <h3>{{data.noArticleText.sub}}</h3>
        </div>
        <ul class="clearfix">
            <li ng-repeat="activePoint in data.activePoints track by activePoint.Id">
                <point-link type="'point'" avatar-url="activePoint.AvatarImage" id-code="activePoint.IdCode" new-page="true" ></point-link>
                <div class="title">
                    <p>
                        <point-link type="'point'" point-name="activePoint.mainName" id-code="activePoint.IdCode" new-page="true" ></point-link>
                    </p>
                    <p>
                        <span ng-if="activePoint.type">[{{activePoint.type}}]</span>
                        {{activePoint.subName}}
                    </p>
                </div>
            </li>
            <li class="search">
                <a href="" class="avatar-anchor" ng-click="clickToSearch()">
                    <img src="assets/images/search-inverse.png" class="avatar">
                </a>
                <div class="title">
                    <span class="fake-input" ng-click="clickToSearch()">探索更多</span>
                </div>
            </li>
        </ul>
    </div>
    <div class="entry" ng-repeat="entry in data.entries" ng-class="{'show': entry.show, 'disabled': entry.disabled}">
        <svg xmlns="http://www.w3.org/2000/svg" class="card-line-background">
            <rect x="6" width="5" height="100%"></rect>
        </svg>
        <div class="card box-shadowed" webp-background="{{entry.isMissive?'assets/images/Syuusouretsujitsu.png':''}}">
            <svg xmlns="http://www.w3.org/2000/svg" class="card-line">
                <rect x="6" width="5" height="100%"></rect>
                <circle cx="8.5" lol-cy="{{entry.sources?70:27}}" r="6.5" class="inverse"></circle>
                <circle cx="8.5" lol-cy="{{entry.sources?70:27}}" r="4"></circle>
            </svg>
            <div class="entry-source" ng-if="entry.sources">
                <span ng-switch="entry.sources.type">
                    <span ng-switch-when="point"><point-link ng-repeat="point in entry.sources.points" type="'point'" id-code="point.IdCode" point-name="'「' + utils.getPointFirstName(point) + '」'" new-page="true"></point-link>收到了新的投稿</span>
                    <span ng-switch-when="publish"><point-link type="'user'" point-name="'@' + entry.author.username" id-code="entry.author.idCode" new-page="true"></point-link> 发布了这篇文章</span>
                    <span ng-switch-when="like">
                        <span ng-repeat="user in entry.sources.userArray">
                            <point-link type="'user'" point-name="'@' + user.name" id-code="user.idCode" new-page="true"></point-link>
                            <span ng-if="!$last">、</span>
                        </span>认可这篇文章</span>
                </span>
            </div>
            <div class="entry-main" ng-class="{'has-sources': entry.sources}">
                <div class="entry-heading">
                    <div class="entry-author" ng-if="entry.author">
                        <point-link ng-if="!entry.author.isStaffTeam" type="'user'" avatar-url="entry.author.avatarUrl" id-code="entry.author.idCode" new-page="true"></point-link>
                        <span ng-if="entry.author.isStaffTeam" class="avatar-anchor">
                            <img class="avatar" alt="头像" webp-src="{{entry.author.avatarUrl|avatarUrl}}">
                        </span>
                        <h4>
                            <point-link ng-if="!entry.author.isStaffTeam" type="'user'" point-name="'@' + entry.author.username" id-code="entry.author.idCode" new-page="true"></point-link>
                            <span ng-if="entry.author.isStaffTeam">其乐职员团队</span>
                        </h4>
                    </div>
                    <h3>
                        <span class="entry-type font-myriad-keylol" ng-repeat="type in entry.types">{{type}}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="entry-new" ng-if="entry.isNew">
                            <circle cx="3.5" cy="3.5" r="3.5"></circle>
                        </svg>
                        <point-link ng-if="entry.voteForPoint" type="'point'" id-code="entry.voteForPoint.IdCode" point-name="'「' + utils.getPointFirstName(entry.voteForPoint) + '」'" new-page="true"></point-link>
                        <span ng-if="entry.fromArticle && !entry.isMissive"><a href="{{entry.fromArticle.href}}">《{{entry.fromArticle.text|maxLength:14}}》</a><span ng-if="entry.fromArticle.fromComment">中的评论</span></span>
                        <span ng-if="entry.isMissive">{{entry.missiveName}}</span>
                        <span ng-if="entry.pointInfo">{{entry.pointInfo.reader}} 名读者 / {{entry.pointInfo.article}} 篇文章</span>
                    </h3>
                </div>
                <a ng-if="entry.url && !entry.clickAction" ng-href="{{entry.url}}" target="_blank" class="entry-content clearfix" ng-class="{'one-line': !entry.hasThumbnail && !entry.isPoint && !entry.isUser, 'for-point': entry.isPoint || entry.isUser, 'free-height': entry.types[0] == '简评'}">
                    <div ng-if="entry.hasThumbnail" class="thumbnail" webp-background="{{entry.thumbnail|timelineThumbnailUrl}}"></div>
                    <div ng-if="entry.hasBackground" class="background" webp-background="{{entry.background|backgroundUrl}}"></div>
                    <div class="summary">
                        <h3 ng-if="entry.title">
                            <span ng-if="entry.types[0] !== '简评'">{{entry.title}}</span>
                            <vote-circle ng-if="entry.vote" vote="entry.vote" ></vote-circle>
                        </h3>
                        <p>{{entry.summary}}</p>
                    </div>
                    <div class="point-avatar" ng-if="entry.isPoint || entry.isUser">
                        <img class="avatar" webp-src="{{entry.pointAvatar|avatarUrl}}" alt="头像">
                    </div>
                </a>
                <a ng-if="entry.clickAction && !entry.url" href="" ng-click="entry.clickAction()" class="entry-content clearfix" ng-class="{'one-line': !entry.hasThumbnail && !entry.isPoint && !entry.isUser, 'for-point': entry.isPoint || entry.isUser, 'free-height': entry.types[0] == '简评'}">
                    <div ng-if="entry.hasThumbnail" class="thumbnail" webp-background="{{entry.thumbnail|timelineThumbnailUrl}}"></div>
                    <div ng-if="entry.hasBackground" class="background" webp-background="{{entry.background|backgroundUrl}}"></div>
                    <div class="summary">
                        <h3 ng-if="entry.title">
                            <span ng-if="entry.types[0] !== '简评'">{{entry.title}}</span>
                            <vote-circle ng-if="entry.vote" vote="entry.vote" ></vote-circle>
                        </h3>
                        <p>{{entry.summary}}</p>
                    </div>
                    <div class="point-avatar" ng-if="entry.isPoint || entry.isUser">
                        <img class="avatar" webp-src="{{entry.pointAvatar|avatarUrl}}" alt="头像">
                    </div>
                </a>
                <div ng-if="union.$localStorage.user" class="action" ng-switch="entry.subscribed">
                    <a ng-switch-when="false" ng-disabled="subscribeDisabled" ng-click="subscribe(entry)">订阅</a>
                    <a ng-switch-when="true" class="subscribed" ng-disabled="subscribeDisabled" ng-click="unsubscribe(entry)">已订阅</a>
                </div>
            </div>
            <footer ng-if="(entry.datetime || entry.count) || data.hasDeleteButton">
                <span class="counts" ng-if="entry.count"><span>[+1] {{entry.count.like}}</span><span>(···) {{entry.count.comment}}</span></span>
                <span class="datetime" am-time-ago="entry.datetime" ng-if="entry.datetime"></span>
                <a class="delete" ng-if="data.hasDeleteButton && !entry.isMissive" href="" ng-click="ignore(entry)">移除</a>
                <a class="delete" ng-if="data.hasDeleteButton && !entry.isMissive && !(entry.fromArticle.fromComment && entry.types[0] === '评论')" href="" ng-click="noMoreRemind(entry)">不再提醒</a>
            </footer>
        </div>
    </div>
    <div class="search-not-found" ng-if="data.searchNotFound">
        <img src="assets/images/hit-final.png">
        <h1 class="font-myriad-keylol">未能撞到结果</h1>
    </div>
    <svg xmlns="http://www.w3.org/2000/svg" ng-if="!data.searchNotFound && !data.activePoints && !data.loadingLock" class="card-end">
        <rect x="19" width="5" height="20" class="line"></rect>
        <rect x="14" y="20" width="15" height="5"></rect>
    </svg>
    <img class="loading" src="assets/images/timeline-loading.gif" ng-if="data.loadingLock">
</div>